import{b as _,e as I,r as l}from"./index-vVMH2w1Q.js";function y(e,t){return t==="red"?"red":t==="yellow"&&e==="green"?"yellow":e}function N(e){let t="green";const a=[];return e.runwayMonths<2?(t=y(t,"red"),a.push("Runway abaixo de 2 meses.")):e.runwayMonths<4&&(t=y(t,"yellow"),a.push("Runway entre 2 e 4 meses.")),typeof e.marginNet=="number"&&(e.marginNet<0?(t=y(t,"red"),a.push("Margem líquida negativa.")):e.marginNet<.1&&(t=y(t,"yellow"),a.push("Margem líquida abaixo do ideal."))),e.expenseMonth>e.revenueMonth&&(t=y(t,"yellow"),a.push("Despesas maiores que a receita no período.")),{status:t,reasons:a}}async function q(e){const{tenantId:t,periodStart:a,periodEnd:c}=e,r={tenantId:t};a&&(r.start=a),c&&(r.end=c);const{data:n}=await _.get("/pulse/summary",{params:r});if(!n.ok){const x=new Error(n.error||"Erro ao carregar resumo financeiro (Pulse).");throw x.traceId=n.traceId,x}if(!n.hasData)return null;const{kpis:s,period:h,inflows:d,outflows:w,balanceSeries:f,accounts:v,alerts:o}=n,S=s.closing_balance,p=s.cash_in,b=s.cash_out,u=s.net_cash,E=typeof s.runway_days=="number"&&s.runway_days>0?s.runway_days/30:0,i=p>0?u/p:void 0,m={cashBalance:S,revenueMonth:p,expenseMonth:b,runwayMonths:E,marginNet:i},M=N(m),g=[];return M.status==="red"?g.push("Atenção: saúde financeira crítica. Revise custos fixos e fluxo de caixa imediatamente."):M.status==="yellow"?g.push("Alerta: indicadores exigem atenção. Monitore de perto despesas e entradas de caixa."):g.push("Saúde financeira estável neste período analisado."),{tenantId:n.tenantId,periodStart:h.start,periodEnd:h.end,kpis:m,inflows:d,outflows:w,balanceSeries:f,accounts:v,alerts:o,projections:n.projections,insights:g,health:M,sources:n.meta?.sources,meta:{traceId:n.meta.traceId,latency_ms:n.meta.latency_ms}}}function A(e){if(!e||!e.kpis)return!0;const{cashBalance:t,revenueMonth:a,expenseMonth:c,runwayMonths:r}=e.kpis;return[t,a,c,r].every(s=>s==null||typeof s=="number"&&Math.abs(s)<1e-5)}function D(e){return e?.response?.status??e?.status??e?.cause?.status??e?.cause?.response?.status??void 0}function P(e){const{tenantId:t,periodStart:a,periodEnd:c}=e,{user:r}=I(),[n,s]=l.useState(null),[h,d]=l.useState(!0),[w,f]=l.useState(null),[v,o]=l.useState(!1),[S,p]=l.useState(0),b=l.useCallback(()=>{p(u=>u+1)},[]);return l.useEffect(()=>{if(!r)return;if(!t){s(null),o(!0),d(!1);return}let u=!0;async function E(){d(!0),f(null),o(!1);try{const i=await q({tenantId:t,periodStart:a,periodEnd:c});if(!u)return;!i||A(i)?(s(null),o(!0)):(s(i),o(!1))}catch(i){if(!u)return;const m=D(i);if(m===403||m===404){s(null),f(null),o(!0);return}f(i),s(null),o(!1)}finally{if(!u)return;d(!1)}}return E(),()=>{u=!1}},[t,a,c,S,r]),{data:n,loading:h,error:w,empty:v,refetch:b}}function F(e){if(!e)return;const t=e?.response?.status??e?.status;if(typeof t=="number")return t}function R(e){switch(F(e)){case 401:return{title:"Sua sessão expirou",message:"Entre novamente para continuar vendo seus dados financeiros.",ctaLabel:"Fazer login",ctaHref:"/login"};case 403:return{title:"Recurso não disponível no seu plano",message:"Este recurso faz parte de um plano superior do Momentum. Veja os planos disponíveis.",ctaLabel:"Ver planos",ctaHref:"/planos"};case 404:return{title:"Nenhum dado encontrado",message:"Não encontramos dados para este período. Tente outro filtro ou importe seus dados financeiros."};case 500:return{title:"Erro inesperado",message:"Ocorreu um erro interno. Já registramos isso. Tente novamente em alguns instantes."};default:return{title:"Algo não saiu como esperado",message:"Tivemos um problema para carregar essas informações. Tente novamente. Se persistir, fale com o suporte."}}}export{N as c,R as g,P as u};
