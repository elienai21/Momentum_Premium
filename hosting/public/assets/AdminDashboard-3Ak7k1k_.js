import{c as y,r as o,j as e,a as S,G as v}from"./index-vVMH2w1Q.js";import{C as N,B as M,b as A,c as D,f as R,g as _,p as T,d as I}from"./chart-nOlIXl9_.js";import{A as $}from"./AsyncPanel-eOZltgkh.js";import{g as z}from"./adminApi-BzfF_zuD.js";import{A as F}from"./activity-fRMxkKMR.js";import{U as P}from"./users-4PK_ZDvb.js";const U=[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]],B=y("chart-column",U);const L=[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]],O=y("dollar-sign",L);const V=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M12 16h.01",key:"1drbdi"}]],q=y("shield-alert",V),k="label";function C(t,s){typeof t=="function"?t(s):t&&(t.current=s)}function G(t,s){const a=t.options;a&&s&&Object.assign(a,s)}function w(t,s){t.labels=s}function E(t,s,a=k){const i=[];t.datasets=s.map(r=>{const c=t.datasets.find(x=>x[a]===r[a]);return!c||!r.data||i.includes(c)?{...r}:(i.push(c),Object.assign(c,r),c)})}function H(t,s=k){const a={labels:[],datasets:[]};return w(a,t.labels),E(a,t.datasets,s),a}function K(t,s){const{height:a=150,width:i=300,redraw:r=!1,datasetIdKey:c,type:x,data:d,options:u,plugins:f=[],fallbackContent:p,updateMode:l,...h}=t,b=o.useRef(null),n=o.useRef(null),g=()=>{b.current&&(n.current=new N(b.current,{type:x,data:H(d,c),options:u&&{...u},plugins:f}),C(s,n.current))},j=()=>{C(s,null),n.current&&(n.current.destroy(),n.current=null)};return o.useEffect(()=>{!r&&n.current&&u&&G(n.current,u)},[r,u]),o.useEffect(()=>{!r&&n.current&&w(n.current.config.data,d.labels)},[r,d.labels]),o.useEffect(()=>{!r&&n.current&&d.datasets&&E(n.current.config.data,d.datasets,c)},[r,d.datasets]),o.useEffect(()=>{n.current&&(r?(j(),setTimeout(g)):n.current.update(l))},[r,u,d.labels,d.datasets,l]),o.useEffect(()=>{n.current&&(j(),setTimeout(g))},[x]),o.useEffect(()=>(g(),()=>j()),[]),e.jsx("canvas",{ref:b,role:"img",height:a,width:i,...h,children:p})}const W=o.forwardRef(K);function J(t,s){return N.register(s),o.forwardRef((a,i)=>e.jsx(W,{...a,ref:i,type:t}))}const Q=J("bar",M);N.register(A,D,R,_,T,I);function ae(){const[t,s]=o.useState(null),[a,i]=o.useState(!0),{notify:r}=S();o.useEffect(()=>{c()},[]);const c=async()=>{try{i(!0);const l=await z();s(l)}catch(l){console.error(l),r({type:"error",message:"Erro ao carregar dados do admin."})}finally{i(!1)}},x=l=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:4}).format(l),d={labels:Object.keys(t?.dailyCost||{}).sort().slice(-14),datasets:[{label:"Custo Diário de IA ($)",data:Object.keys(t?.dailyCost||{}).sort().slice(-14).map(l=>t?.dailyCost[l]),backgroundColor:"rgba(124, 58, 237, 0.5)",borderColor:"rgba(124, 58, 237, 1)",borderWidth:1}]},u={responsive:!0,plugins:{legend:{position:"top",labels:{color:"#94a3b8"}},title:{display:!1}},scales:{y:{ticks:{color:"#94a3b8"},grid:{color:"rgba(255, 255, 255, 0.05)"}},x:{ticks:{color:"#94a3b8"},grid:{display:!1}}}},f=(t?.activeTenantsCount||0)*49,p=f>0?(f-(t?.totalEstimatedCost||0))/f*100:0;return e.jsxs("div",{className:"pt-24 pb-24 space-y-8 animate-in fade-in duration-500",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(q,{size:20,className:"text-violet-500"}),e.jsx("span",{className:"text-xs font-bold text-violet-500 uppercase tracking-widest font-display",children:"Admin Power Pack"})]}),e.jsx("h1",{className:"text-3xl font-bold text-slate-100 font-display",children:"Unit Economics"}),e.jsx("p",{className:"text-slate-400 font-display",children:"Monitoramento de custos de IA e saúde financeira."})]}),e.jsx("div",{className:"flex gap-2",children:e.jsx("div",{className:"px-3 py-1 bg-slate-800 rounded-full border border-slate-700 text-xs text-slate-400 font-mono",children:"v1.0.0"})})]}),e.jsxs($,{isLoading:a,error:null,isEmpty:!1,children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(m,{label:"Custo Total IA (30d)",value:x(t?.totalEstimatedCost||0),icon:O,trend:"needs_attn"}),e.jsx(m,{label:"Receita Est. (MRR)",value:`$${f.toFixed(2)}`,icon:F,trend:"neutral"}),e.jsx(m,{label:"Margem Bruta Est.",value:`${p.toFixed(1)}%`,icon:B,trend:p>70?"positive":"negative"}),e.jsx(m,{label:"Tokens Processados",value:new Intl.NumberFormat("en-US",{notation:"compact"}).format(t?.totalTokens||0),icon:P,trend:"neutral"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-2",children:e.jsxs(v,{className:"p-6 h-full border-slate-800 bg-slate-950/50",children:[e.jsx("h3",{className:"text-lg font-bold text-slate-200 mb-6 font-display",children:"Tendência de Custo Diário"}),e.jsx("div",{className:"h-[300px] w-full",children:t&&e.jsx(Q,{data:d,options:u})})]})}),e.jsx("div",{className:"lg:col-span-1",children:e.jsxs(v,{className:"p-0 h-full border-slate-800 bg-slate-950/50 overflow-hidden",children:[e.jsxs("div",{className:"p-4 border-b border-slate-800/50 bg-slate-900/50 flex justify-between items-center",children:[e.jsx("h3",{className:"text-sm font-bold text-slate-200 font-display uppercase tracking-wider",children:"Top Spenders"}),e.jsx("span",{className:"text-[10px] text-slate-500",children:"Últimos 30 dias"})]}),e.jsx("div",{className:"overflow-y-auto max-h-[350px]",children:e.jsx("table",{className:"w-full text-left text-xs",children:e.jsxs("tbody",{className:"divide-y divide-slate-800/50",children:[t?.topSpenders.map((l,h)=>e.jsxs("tr",{className:"hover:bg-slate-800/30 transition-colors",children:[e.jsx("td",{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"font-mono text-slate-500 text-[10px]",children:["#",h+1]}),e.jsxs("div",{children:[e.jsx("div",{className:"font-bold text-slate-200",children:l.name}),e.jsxs("div",{className:"text-[10px] text-slate-500",children:[l.plan," • ",l.tenantId.substring(0,6),"..."]})]})]})}),e.jsxs("td",{className:"p-4 text-right",children:[e.jsx("div",{className:"font-mono font-bold text-violet-400",children:x(l.cost)}),e.jsxs("div",{className:"text-[10px] text-slate-500",children:[(l.tokens/1e3).toFixed(1),"k toks"]})]})]},l.tenantId)),(!t?.topSpenders||t.topSpenders.length===0)&&e.jsx("tr",{children:e.jsx("td",{colSpan:2,className:"p-8 text-center text-slate-500",children:"Sem dados"})})]})})})]})})]})]})]})}function m({label:t,value:s,icon:a,trend:i}){const r={positive:"text-emerald-500",negative:"text-rose-500",neutral:"text-slate-400",needs_attn:"text-amber-500"};return e.jsxs(v,{className:"p-5 border-slate-800 bg-slate-950/50 flex flex-col justify-between h-32 relative overflow-hidden group",children:[e.jsx("div",{className:"absolute top-0 right-0 w-24 h-24 bg-violet-500/5 rounded-full blur-2xl -mr-8 -mt-8 pointer-events-none group-hover:bg-violet-500/10 transition-colors"}),e.jsxs("div",{className:"flex justify-between items-start relative z-10",children:[e.jsx("span",{className:"text-[10px] font-bold text-slate-500 uppercase tracking-widest font-display",children:t}),e.jsx(a,{size:16,className:"text-slate-600"})]}),e.jsx("div",{className:`text-2xl font-black font-display tracking-tight relative z-10 ${r[i]||"text-slate-200"}`,children:s})]})}export{ae as default};
