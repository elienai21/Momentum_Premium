import{c as _,m as O,r,b as j,a as T,f as D,j as e,G as b,M as F,n as H,g as Q,E as V,S as W}from"./index-yBjCuyq5.js";import{u as J,B as K}from"./useTenant-Dq0M87T7.js";import{A as L}from"./AsyncPanel-OzLCl5j3.js";import{S as M,I as X}from"./InviteMemberModal-BmgY2xLE.js";import{U}from"./user-B28uMnpN.js";import{P as Y}from"./plus-B0lAGzQi.js";import{C as Z}from"./clock-C16mpsVl.js";import{T as z}from"./trash-2-B738TgPz.js";import{C as ee}from"./credit-card-q0oH5HAB.js";import{U as se}from"./users-DW6yZrXV.js";import{R as te}from"./refresh-cw-BWaUnWcy.js";import{H as ae}from"./history-CqONSuSq.js";import"./rotate-ccw-DU9Bc9uM.js";const re=[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],le=_("settings",re);function ie(a=10){const c=O()?.token??null,[h,l]=r.useState([]),[p,d]=r.useState(!1),[u,m]=r.useState(null),o=r.useCallback(async()=>{if(c){d(!0),m(null);try{const x=await j.get(`/billing/usage-logs?limit=${a}`);l(x.data.logs||[])}catch(x){m(x instanceof Error?x:new Error("Erro ao carregar logs"))}finally{d(!1)}}},[c,a]);return r.useEffect(()=>{o()},[o]),{logs:h,isLoading:p,error:u,refetch:o}}function ne(){const{notify:a}=T(),{tenant:n}=D(),[c,h]=r.useState(!0),[l,p]=r.useState({members:[],invites:[]}),[d,u]=r.useState(!1),[m,o]=r.useState(null),x=async()=>{try{h(!0);const s=await j.get("/tenants/members");p(s.data.data)}catch(s){console.error(s),a({type:"error",message:"Erro ao carregar equipe."})}finally{h(!1)}};r.useEffect(()=>{x()},[]);const N=async s=>{if(window.confirm("Tem certeza que deseja remover este membro?"))try{o(s),await j.delete(`/tenants/members/${s}`),a({type:"success",message:"Membro removido com sucesso."}),p(i=>({...i,members:i.members.filter(y=>y.id!==s)}))}catch(i){a({type:"error",message:i.response?.data?.message||"Erro ao remover membro."})}finally{o(null)}},f=async s=>{if(window.confirm("Cancelar este convite?"))try{o(s),await j.delete(`/tenants/invites/${s}`),a({type:"success",message:"Convite cancelado."}),p(i=>({...i,invites:i.invites.filter(y=>y.id!==s)}))}catch{a({type:"error",message:"Erro ao cancelar convite."})}finally{o(null)}},g=s=>s===n?.ownerUid;return e.jsxs("div",{className:"space-y-6 animate-in fade-in duration-300",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-bold text-slate-800 dark:text-slate-200 font-display flex items-center gap-2",children:[e.jsx(U,{size:20,className:"text-primary"}),"Gestão de Equipe"]}),e.jsx("p",{className:"text-sm text-slate-500 font-display",children:"Gerencie quem tem acesso ao workspace da empresa."})]}),e.jsxs("button",{onClick:()=>u(!0),className:"bg-primary hover:bg-primary/90 text-white px-4 py-2 rounded-xl text-sm font-bold shadow-glow transition-all flex items-center gap-2 font-display",children:[e.jsx(Y,{size:16}),"Convidar Membro"]})]}),e.jsxs(L,{isLoading:c,isEmpty:l.members.length===0&&l.invites.length===0,error:null,children:[l.invites.length>0&&e.jsxs("div",{className:"space-y-3 mb-6",children:[e.jsxs("h4",{className:"text-[10px] font-bold text-slate-400 uppercase tracking-widest font-display flex items-center gap-2",children:[e.jsx(Z,{size:12})," Convites Pendentes"]}),e.jsx("div",{className:"grid gap-3",children:l.invites.map(s=>e.jsxs(b,{className:"p-4 flex items-center justify-between border-slate-200/50 dark:border-white/5",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-slate-100 dark:bg-slate-800 flex items-center justify-center text-slate-400",children:e.jsx(F,{size:18})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-bold text-slate-700 dark:text-slate-300 font-display",children:s.email}),e.jsxs("div",{className:"flex items-center gap-2 text-[11px] text-slate-400",children:[e.jsx("span",{className:"capitalize",children:s.role}),e.jsx("span",{className:"w-1 h-1 rounded-full bg-slate-300 dark:bg-slate-600"}),e.jsxs("span",{children:["Enviado em ",new Date(s.createdAt).toLocaleDateString()]})]})]})]}),e.jsx("button",{onClick:()=>f(s.id),disabled:m===s.id,className:"p-2 text-slate-400 hover:text-error hover:bg-error/10 rounded-lg transition-all",title:"Cancelar convite",children:e.jsx(z,{size:16})})]},s.id))})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h4",{className:"text-[10px] font-bold text-slate-400 uppercase tracking-widest font-display flex items-center gap-2",children:[e.jsx(M,{size:12})," Membros Ativos"]}),e.jsx("div",{className:"grid gap-3",children:l.members.map(s=>e.jsxs(b,{className:"p-4 flex items-center justify-between border-slate-200/50 dark:border-white/5",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-primary to-secondary flex items-center justify-center text-white text-sm font-bold shadow-sm",children:s.name?s.name.charAt(0).toUpperCase():s.email?.charAt(0).toUpperCase()||"U"}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-bold text-slate-700 dark:text-slate-300 font-display flex items-center gap-2",children:[s.name||s.email?.split("@")[0],g(s.id)&&e.jsx("span",{className:"px-1.5 py-0.5 rounded-full bg-primary/10 text-primary text-[9px] uppercase",children:"Dono"}),s.id===l.members.find(i=>i.email===n?.ownerEmail)?.id&&e.jsx("span",{className:"text-xs text-slate-400",children:"(Você)"})]}),e.jsx("p",{className:"text-[11px] text-slate-400 font-display",children:s.email})]})]}),!g(s.id)&&e.jsx("button",{onClick:()=>N(s.id),disabled:m===s.id,className:"p-2 text-slate-400 hover:text-error hover:bg-error/10 rounded-lg transition-all",title:"Remover membro",children:e.jsx(z,{size:16})})]},s.id))})]})]}),d&&e.jsx(X,{onClose:()=>u(!1),onSuccess:x})]})}function P(a){return new Intl.NumberFormat("pt-BR").format(a)}function A(a){if(!a)return"N/A";const n=new Date(a);return Number.isNaN(n.getTime())?"N/A":n.toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric"})}const ve=()=>{const[a,n]=H(),{notify:c}=T(),h=a.get("tab")||"billing",[l,p]=r.useState(h),{credits:d,isLoading:u,refetch:m}=Q(),{logs:o,isLoading:x}=ie(10),{tenantId:N}=D(),f=J(N),[g,s]=r.useState(""),[i,y]=r.useState(""),[k,C]=r.useState(!1);r.useEffect(()=>{f&&s(f?.name||"")},[f]);const I=t=>{p(t),n({tab:t})},R=async()=>{C(!0);try{await new Promise(t=>setTimeout(t,500)),console.log("Profile saved:",{profileName:g,profileRole:i})}finally{C(!1)}},$=async()=>{try{const t=await j.get("/billing/portal");if(t.data.code==="requires_setup"||t.data.error&&!t.data.url){c({type:"info",message:"Sua conta ainda não possui faturas geradas. Entre em contato com o suporte."});return}t.data.url&&window.open(t.data.url,"_blank")}catch(t){console.warn("Billing portal error:",t),t?.response?.data?.code==="NO_STRIPE_CUSTOMER"&&c({type:"info",message:"Sua conta ainda não possui faturas geradas."})}},v=d?.monthlyQuota||0,S=d?.available||0,w=v>0?Math.min(100,Math.max(0,S/v*100)):0,E=(d?.planNormalized||f?.plan||"Starter").toUpperCase(),q=A(d?.renewsAt),B=d?.periodSource==="stripe"?"Ciclo de Faturamento":"Ciclo de 30 dias",G=[{id:"profile",label:"Perfil",icon:U},{id:"billing",label:"Plano & Créditos",icon:ee},{id:"team",label:"Equipe",icon:se}];return e.jsxs("div",{className:"pt-24 space-y-8 pb-24 fade-in","aria-live":"polite",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold text-slate-800 dark:text-slate-200 font-display flex items-center gap-2",children:[e.jsx(le,{size:24,className:"text-primary"}),"Configurações"]}),e.jsx("p",{className:"text-slate-500 dark:text-slate-400 font-display text-sm",children:"Gerencie seu perfil, plano e créditos de IA."})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:e.jsx(oe,{label:E,color:"success"})})]}),e.jsx("div",{className:"flex gap-2 border-b border-slate-200 dark:border-slate-800 pb-1",children:G.map(t=>e.jsxs("button",{onClick:()=>I(t.id),className:`flex items-center gap-2 px-4 py-2.5 rounded-t-lg text-sm font-bold transition-all font-display ${l===t.id?"bg-white dark:bg-slate-800 text-primary border-b-2 border-primary shadow-sm":"text-slate-500 dark:text-slate-400 hover:text-slate-700 dark:hover:text-slate-200 hover:bg-slate-100 dark:hover:bg-slate-800/50"}`,children:[e.jsx(t.icon,{size:16}),t.label]},t.id))}),l==="profile"&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 animate-in fade-in duration-300",children:[e.jsxs(b,{className:"p-6 border border-slate-200/50 dark:border-white/5",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-gradient-to-br from-primary to-secondary flex items-center justify-center text-white text-lg font-bold shadow-glow",children:g?.charAt(0)?.toUpperCase()||"U"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-slate-800 dark:text-slate-200 font-display",children:"Dados do Perfil"}),e.jsx("p",{className:"text-xs text-slate-400 font-display",children:"Atualize suas informações pessoais"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"text-[10px] uppercase font-bold text-slate-400 tracking-widest font-display",children:"Nome Completo"}),e.jsx("input",{type:"text",value:g,onChange:t=>s(t.target.value),className:"w-full bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-xl px-4 py-3 text-sm font-display focus:ring-2 focus:ring-primary/20 focus:border-primary transition-all",placeholder:"Seu nome"})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"text-[10px] uppercase font-bold text-slate-400 tracking-widest font-display",children:"Cargo"}),e.jsx("input",{type:"text",value:i,onChange:t=>y(t.target.value),className:"w-full bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-xl px-4 py-3 text-sm font-display focus:ring-2 focus:ring-primary/20 focus:border-primary transition-all",placeholder:"Ex: Diretor Financeiro"})]}),e.jsx("button",{onClick:R,disabled:k,className:"w-full py-3 rounded-xl bg-primary hover:bg-primary/90 text-white font-bold text-sm transition-all shadow-glow disabled:opacity-50 font-display",children:k?"Salvando...":"Salvar Alterações"})]})]}),e.jsxs(b,{className:"p-6 border border-slate-200/50 dark:border-white/5",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(K,{size:18,className:"text-primary"}),e.jsx("h3",{className:"font-bold text-slate-800 dark:text-slate-200 font-display",children:"Dados da Organização"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-[9px] uppercase font-bold text-slate-400 tracking-widest font-display",children:"Nome do Tenant"}),e.jsx("p",{className:"text-slate-700 dark:text-slate-200 font-bold text-sm font-display",children:f?.name||"Minha Empresa"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-[9px] uppercase font-bold text-slate-400 tracking-widest font-display",children:"Workspace ID"}),e.jsx("code",{className:"text-[11px] bg-slate-100 dark:bg-slate-800 px-1.5 py-0.5 rounded text-slate-500 dark:text-slate-400 font-mono block truncate",children:N||"---"})]})]})]})]}),l==="billing"&&e.jsxs("div",{className:"space-y-6 animate-in fade-in duration-300",children:[e.jsxs("div",{className:"glass rounded-xl p-8 relative overflow-hidden border border-primary/20 group",children:[e.jsx("div",{className:"absolute top-0 right-0 w-64 h-64 bg-primary/20 rounded-full blur-[80px] -mr-16 -mt-16 pointer-events-none opacity-60 group-hover:opacity-100 transition-opacity"}),e.jsxs("div",{className:"relative z-10 flex flex-col md:flex-row items-start md:items-center justify-between gap-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 rounded-xl bg-primary/20 text-primary shadow-glow",children:e.jsx(M,{size:24})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-[10px] font-bold text-slate-400 uppercase tracking-widest font-display",children:"Seu Plano"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xl font-bold text-slate-800 dark:text-slate-200 font-display",children:E}),e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-success/20 text-success text-[10px] font-bold uppercase",children:"Ativo"})]}),e.jsxs("p",{className:"text-xs text-slate-400 mt-1 font-display",children:["Renova em: ",q]})]})]}),e.jsxs("button",{onClick:$,className:"bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 text-slate-600 dark:text-slate-300 px-5 py-2.5 rounded-lg text-sm font-bold hover:bg-slate-50 dark:hover:bg-slate-700 transition-all shadow-sm flex items-center gap-2 font-display",children:["Gerenciar Assinatura",e.jsx(V,{size:16})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"flex h-6 w-6 items-center justify-center rounded bg-primary/20 text-primary shadow-glow",children:e.jsx(W,{size:14})}),e.jsx("h3",{className:"text-lg font-bold text-slate-800 dark:text-slate-200 font-display",children:"Créditos de IA"})]}),e.jsxs(b,{className:"p-6 border border-slate-200/50 dark:border-white/5",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-300 font-bold font-display",children:"Uso no Período"}),e.jsx("p",{className:"text-[11px] text-slate-400 italic font-display",children:B})]}),e.jsx("button",{onClick:()=>m(),className:"p-2 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-800 text-slate-400 hover:text-primary transition-colors",children:e.jsx(te,{size:16,className:u?"animate-spin":""})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-end justify-between",children:[e.jsxs("span",{className:"text-4xl font-black text-slate-800 dark:text-slate-200 tracking-tighter font-display",children:[P(S),e.jsx("span",{className:"text-lg font-normal text-slate-400 ml-1",children:"restantes"})]}),e.jsxs("span",{className:"text-xs font-bold text-slate-500 bg-slate-100 dark:bg-slate-800 px-2 py-1 rounded-md font-display",children:["Cota: ",P(v)]})]}),e.jsx("div",{className:"h-5 w-full bg-slate-200 dark:bg-slate-800 rounded-full overflow-hidden p-1 shadow-inner",children:e.jsx("div",{className:`h-full rounded-full transition-all duration-1000 ease-out ${w>40?"bg-gradient-to-r from-primary to-secondary":w>15?"bg-warning":"bg-error"}`,style:{width:`${w}%`}})})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ae,{size:16,className:"text-slate-500"}),e.jsx("h3",{className:"text-[10px] font-bold text-slate-600 dark:text-slate-400 uppercase tracking-widest font-display",children:"Histórico de Uso"})]}),e.jsx(L,{isLoading:x,error:null,isEmpty:o.length===0,emptyTitle:"Sem registros",emptyDescription:"Nenhum consumo de créditos registrado ainda.",children:e.jsx(b,{className:"p-0 overflow-hidden border border-slate-200/50 dark:border-white/5",children:e.jsxs("table",{className:"w-full text-xs",children:[e.jsx("thead",{className:"bg-slate-50 dark:bg-white/5 border-b border-slate-200 dark:border-white/5",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-[9px] font-bold uppercase text-slate-400 tracking-widest font-display",children:"Tipo"}),e.jsx("th",{className:"px-4 py-3 text-left text-[9px] font-bold uppercase text-slate-400 tracking-widest font-display",children:"Fonte"}),e.jsx("th",{className:"px-4 py-3 text-right text-[9px] font-bold uppercase text-slate-400 tracking-widest font-display",children:"Créditos"}),e.jsx("th",{className:"px-4 py-3 text-right text-[9px] font-bold uppercase text-slate-400 tracking-widest font-display",children:"Data"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-100 dark:divide-white/5",children:o.map(t=>e.jsxs("tr",{className:"hover:bg-primary/5 transition-colors",children:[e.jsx("td",{className:"px-4 py-3 font-bold text-slate-800 dark:text-slate-200 font-display",children:t.type}),e.jsx("td",{className:"px-4 py-3 text-slate-500 dark:text-slate-400 font-display",children:t.source}),e.jsxs("td",{className:"px-4 py-3 text-right font-black text-error font-display",children:["-",t.creditsConsumed]}),e.jsx("td",{className:"px-4 py-3 text-right text-slate-400 font-display",children:A(t.createdAt)})]},t.id))})]})})})]})]}),l==="team"&&e.jsx(ne,{})]})},oe=({label:a,color:n="slate"})=>{const c={slate:"bg-white dark:bg-slate-800 border-slate-200 dark:border-slate-700 text-slate-500 dark:text-slate-400",success:"bg-emerald-50 dark:bg-emerald-900/20 border-emerald-100 dark:border-emerald-800 text-emerald-600 dark:text-emerald-400"};return e.jsxs("div",{className:`px-3 py-1 rounded-full border text-[11px] font-bold flex items-center gap-2 shadow-sm font-display ${c[n]}`,children:[e.jsx("span",{className:`w-1.5 h-1.5 rounded-full ${n==="success"?"bg-emerald-500":"bg-slate-400"}`}),a]})};export{ve as default};
