import{c as E,a as F,r as s,j as e,G as y,C as M,g as P,b as v}from"./index-CDF0DbQ4.js";import{S as A}from"./SectionHeader-CGDkteUz.js";import{B as g}from"./Badge-BdguWUD2.js";import{F as U}from"./funnel-BH5mLsCK.js";import{S as V}from"./search-DBnEqGph.js";import{C as q}from"./circle-check-big-jxNx9aao.js";const G=[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]],H=E("download",G),W=()=>{const{notify:N}=F(),[r,w]=s.useState(""),[n,C]=s.useState(""),[m,k]=s.useState(""),[c,S]=s.useState(""),[i,T]=s.useState(""),[d,R]=s.useState(""),[b,L]=s.useState({categories:[],cards:[]}),[u,B]=s.useState([]),[h,f]=s.useState(!0),D=s.useMemo(()=>({from:r||null,to:n||null,category:m||null,type:c||null,card:i||null,q:d||null}),[r,n,m,c,i,d]);async function j(){f(!0);try{const[t,a]=await Promise.all([v.get("/portal/forecast",{params:{from:r||"",to:n||""}}),v.post("/portal/transactions/filter",D)]),x=t.data,l=a.data;L(x?.meta||{categories:[],cards:[]}),B(l?.transactions||[])}catch{N({type:"error",message:"Não foi possível carregar o extrato. Tente novamente."})}finally{f(!1)}}s.useEffect(()=>{j()},[]);function z(){const t=`data,descricao,categoria,tipo,valor
`,a=u.map(o=>[o.date,o.description,o.category,o.type,String(o.amount)].join(",")),x=new Blob([t+a.join(`
`)],{type:"text/csv;charset=utf-8;"}),l=URL.createObjectURL(x),p=document.createElement("a");p.href=l,p.download="transacoes.csv",p.click(),URL.revokeObjectURL(l)}return e.jsxs("div",{className:"space-y-8 transition-colors duration-300","aria-live":"polite",children:[e.jsx(A,{title:"Transações",subtitle:"Filtre, pesquise e exporte seu extrato completo.",actions:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:j,disabled:h,className:"bg-momentum-accent hover:bg-momentum-accent/90 text-white px-4 py-2 rounded-lg text-sm font-medium transition-all shadow-momentum-glow flex items-center gap-2 disabled:opacity-70",children:h?"Carregando...":e.jsxs(e.Fragment,{children:[e.jsx(U,{size:16})," Aplicar filtros"]})}),e.jsxs("button",{onClick:z,className:"bg-white hover:bg-slate-50 dark:bg-slate-800 dark:hover:bg-slate-700 text-momentum-text border border-momentum-border px-4 py-2 rounded-lg text-sm font-medium transition-all flex items-center gap-2",children:[e.jsx(H,{size:16})," Exportar CSV"]})]})}),e.jsx(y,{className:"p-6",children:e.jsxs("div",{className:"grid gap-6 md:grid-cols-6 items-end",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs font-semibold text-momentum-muted uppercase tracking-wider",children:"Período (De)"}),e.jsx("input",{type:"date",value:r,onChange:t=>w(t.target.value),className:"w-full bg-momentum-bg/50 border border-momentum-border rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-momentum-accent outline-none transition-all text-momentum-text"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs font-semibold text-momentum-muted uppercase tracking-wider",children:"Período (Até)"}),e.jsx("input",{type:"date",value:n,onChange:t=>C(t.target.value),className:"w-full bg-momentum-bg/50 border border-momentum-border rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-momentum-accent outline-none transition-all text-momentum-text"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs font-semibold text-momentum-muted uppercase tracking-wider",children:"Categoria"}),e.jsxs("select",{value:m,onChange:t=>k(t.target.value),className:"w-full bg-momentum-bg/50 border border-momentum-border rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-momentum-accent outline-none transition-all text-momentum-text",children:[e.jsx("option",{value:"",children:"Todas"}),b.categories.map(t=>e.jsx("option",{value:t,children:t},t))]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs font-semibold text-momentum-muted uppercase tracking-wider",children:"Tipo"}),e.jsxs("select",{value:c,onChange:t=>S(t.target.value),className:"w-full bg-momentum-bg/50 border border-momentum-border rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-momentum-accent outline-none transition-all text-momentum-text",children:[e.jsx("option",{value:"",children:"Todos"}),e.jsx("option",{value:"credit",children:"Crédito"}),e.jsx("option",{value:"debit",children:"Débito"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs font-semibold text-momentum-muted uppercase tracking-wider",children:"Cartão"}),e.jsxs("select",{value:i,onChange:t=>T(t.target.value),className:"w-full bg-momentum-bg/50 border border-momentum-border rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-momentum-accent outline-none transition-all text-momentum-text",children:[e.jsx("option",{value:"",children:"Todos"}),b.cards.map(t=>e.jsx("option",{value:t,children:t},t))]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs font-semibold text-momentum-muted uppercase tracking-wider",children:"Busca"}),e.jsxs("div",{className:"relative",children:[e.jsx(V,{className:"absolute left-3 top-2.5 text-momentum-muted",size:16}),e.jsx("input",{value:d,onChange:t=>R(t.target.value),type:"text",placeholder:"Descrição, categoria, cartão...",className:"w-full pl-10 bg-momentum-bg/50 border border-momentum-border rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-momentum-accent outline-none transition-all text-momentum-text"})]})]})]})}),e.jsxs(y,{className:"p-0 overflow-hidden",children:[e.jsxs("div",{className:"p-6 border-b border-momentum-border flex items-center justify-between",children:[e.jsx("h3",{className:"font-bold text-lg text-momentum-text",children:"Transações"}),e.jsxs(g,{variant:"neutral",children:[u.length," registros"]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm text-left",children:[e.jsx("thead",{className:"bg-momentum-muted/5 text-momentum-muted font-semibold uppercase text-xs tracking-wider border-b border-momentum-border",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4",children:"Data"}),e.jsx("th",{className:"px-6 py-4",children:"Descrição"}),e.jsx("th",{className:"px-6 py-4",children:"Categoria"}),e.jsx("th",{className:"px-6 py-4",children:"Tipo"}),e.jsx("th",{className:"px-6 py-4 text-right",children:"Valor"})]})}),e.jsx("tbody",{className:"divide-y divide-momentum-border",children:u.map((t,a)=>e.jsxs("tr",{className:"transition hover:bg-momentum-accent/5",children:[e.jsx("td",{className:"px-6 py-4 font-medium text-momentum-text",children:t.date}),e.jsx("td",{className:"px-6 py-4 text-momentum-muted",children:t.description}),e.jsx("td",{className:"px-6 py-4",children:e.jsx(g,{variant:"neutral",className:"bg-momentum-bg/50 border-momentum-border",children:t.category})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs(g,{variant:t.type==="credit"?"success":"danger",className:"gap-1.5",children:[t.type==="credit"?e.jsx(q,{size:10}):e.jsx(M,{size:10}),t.type==="credit"?"Crédito":"Débito"]})}),e.jsx("td",{className:P("px-6 py-4 text-right font-bold",t.type==="credit"?"text-momentum-success":"text-momentum-danger"),children:Math.abs(t.amount||0).toLocaleString("pt-BR",{style:"currency",currency:"BRL"})})]},a))})]})})]})]})};export{W as default};
