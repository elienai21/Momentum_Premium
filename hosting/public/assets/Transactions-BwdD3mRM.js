import{b as D,r as s,j as e,a as f}from"./index-tXm_M6ea.js";const P=()=>{const{notify:N}=D(),[n,v]=s.useState(""),[i,w]=s.useState(""),[d,C]=s.useState(""),[x,S]=s.useState(""),[p,T]=s.useState(""),[h,R]=s.useState(""),[u,k]=s.useState({categories:[],cards:[]}),[m,L]=s.useState([]),[j,g]=s.useState(!0),E=s.useMemo(()=>({from:n||null,to:i||null,category:d||null,type:x||null,card:p||null,q:h||null}),[n,i,d,x,p,h]);async function b(){g(!0);try{const[t,a]=await Promise.all([f.get("/portal/forecast",{params:{from:n||"",to:i||""}}),f.post("/portal/transactions/filter",E)]),o=t.data,l=a.data;k(o?.meta||{categories:[],cards:[]}),L(l?.transactions||[])}catch{N({type:"error",message:"Não foi possível carregar o extrato. Tente novamente."})}finally{g(!1)}}s.useEffect(()=>{b()},[]);function y(){const t=`data,descricao,categoria,tipo,valor
`,a=m.map(r=>[r.date,r.description,r.category,r.type,String(r.amount)].join(",")),o=new Blob([t+a.join(`
`)],{type:"text/csv;charset=utf-8;"}),l=URL.createObjectURL(o),c=document.createElement("a");c.href=l,c.download="transacoes.csv",c.click(),URL.revokeObjectURL(l)}return e.jsxs("main",{className:"p-6 space-y-6","aria-live":"polite",children:[e.jsxs("header",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-semibold text-slate-900 dark:text-slate-50",children:"Transações"}),e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:"Filtre, pesquise e exporte seu extrato completo."})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:b,className:"btn primary text-xs px-3 py-2",children:j?"Carregando...":"Aplicar filtros"}),e.jsx("button",{onClick:y,className:"btn neutral text-xs px-3 py-2",children:"Exportar CSV"})]})]}),e.jsxs("section",{className:"card p-4",children:[e.jsxs("div",{className:"grid gap-3 md:grid-cols-6",children:[[["Período (de)",n,v,"date"],["Período (até)",i,w,"date"]].map(([t,a,o,l],c)=>e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("label",{className:"text-sm opacity-70",children:t}),e.jsx("input",{value:a,onChange:r=>o(r.target.value),type:l,className:"glass border border-white/10 rounded-lg px-3 py-2"})]},c)),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("label",{className:"text-sm opacity-70",children:"Categoria"}),e.jsxs("select",{value:d,onChange:t=>C(t.target.value),className:"glass border border-white/10 rounded-lg px-3 py-2",children:[e.jsx("option",{value:"",children:"Todas"}),u.categories.map(t=>e.jsx("option",{value:t,children:t},t))]})]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("label",{className:"text-sm opacity-70",children:"Tipo"}),e.jsxs("select",{value:x,onChange:t=>S(t.target.value),className:"glass border border-white/10 rounded-lg px-3 py-2",children:[e.jsx("option",{value:"",children:"Todos"}),e.jsx("option",{value:"credit",children:"Crédito"}),e.jsx("option",{value:"debit",children:"Débito"})]})]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("label",{className:"text-sm opacity-70",children:"Cartão"}),e.jsxs("select",{value:p,onChange:t=>T(t.target.value),className:"glass border border-white/10 rounded-lg px-3 py-2",children:[e.jsx("option",{value:"",children:"Todos"}),u.cards.map(t=>e.jsx("option",{value:t,children:t},t))]})]}),e.jsxs("div",{className:"flex flex-col gap-1 md:col-span-2",children:[e.jsx("label",{className:"text-sm opacity-70",children:"Busca"}),e.jsx("input",{value:h,onChange:t=>R(t.target.value),type:"text",placeholder:"Descrição, categoria, cartão...",className:"glass border border-white/10 rounded-lg px-3 py-2"})]})]}),e.jsxs("div",{className:"mt-3 flex flex-wrap gap-2 items-center",children:[e.jsx("button",{onClick:b,className:"btn primary hover:-translate-y-px transition-all duration-300",children:j?"Carregando...":"Aplicar"}),e.jsx("button",{onClick:y,className:"btn neutral hover:-translate-y-px transition-all duration-300",children:"Exportar CSV"})]})]}),e.jsxs("section",{className:"card p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3 gap-2",children:[e.jsx("h3",{className:"font-semibold",children:"Transações"}),e.jsxs("span",{className:"text-xs text-[var(--text-2)]",children:[m.length," registros"]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full border border-white/10 rounded-xl",children:[e.jsx("thead",{className:"text-[var(--text-2)]",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left px-4 py-2 border-b border-white/10",children:"Data"}),e.jsx("th",{className:"text-left px-4 py-2 border-b border-white/10",children:"Descrição"}),e.jsx("th",{className:"text-left px-4 py-2 border-b border-white/10",children:"Categoria"}),e.jsx("th",{className:"text-left px-4 py-2 border-b border-white/10",children:"Tipo"}),e.jsx("th",{className:"text-right px-4 py-2 border-b border-white/10",children:"Valor"})]})}),e.jsx("tbody",{children:m.map((t,a)=>e.jsxs("tr",{className:"transition hover:bg-[rgba(110,52,255,0.05)]",children:[e.jsx("td",{className:"px-4 py-2 border-b border-white/10",children:t.date}),e.jsx("td",{className:"px-4 py-2 border-b border-white/10",children:t.description}),e.jsx("td",{className:"px-4 py-2 border-b border-white/10",children:t.category}),e.jsx("td",{className:"px-4 py-2 border-b border-white/10",children:e.jsx("span",{className:`px-2 py-1 rounded-full border text-xs ${t.type==="credit"?"border-emerald-400/40 text-emerald-300":"border-rose-400/40 text-rose-300"}`,children:t.type==="credit"?"Crédito":"Débito"})}),e.jsx("td",{className:`px-4 py-2 border-b border-white/10 text-right ${t.type==="credit"?"text-emerald-400":"text-rose-400"}`,children:Math.abs(t.amount||0).toLocaleString("pt-BR",{style:"currency",currency:"BRL"})})]},a))})]})})]})]})};export{P as default};
