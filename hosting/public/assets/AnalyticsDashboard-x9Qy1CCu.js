import{a as o,j as e,C as U,L as ae,P as ne,c as re,d as oe,e as ie,A as ce,p as le,f as de,g as me,D as ue,i as pe}from"./charts--kFkiaCp.js";import{c as xe,j as fe,h as he,k as ge,r as be,f as R,b as _,a as ve,G as I,I as je}from"./index-CETmOTzF.js";import{L as K,d as Z,w as ye,m as we,x as Ne,R as ke,T as Y,W as Ce,y as Se,z as Re,G as Ae}from"./icons-Bc7DOyy3.js";import{S as Pe}from"./SectionHeader-DkKv0CWh.js";import{S as O}from"./StatsCard-B55lZtJ5.js";import{A as Le}from"./AsyncPanel-DLrco2Ud.js";import{u as Me}from"./vendor-DnLjH3oN.js";import"./query-BGhlxTj0.js";import"./firebase-dP-Dck55.js";async function Te(j){return(await _.post("/advisor/session",{messages:[{role:"user",content:j}]})).data}const ze=()=>{const{user:j,loading:m}=xe(),[k,l]=o.useState([{role:"assistant",text:"Ol√°! Sou seu consultor financeiro Momentum. Como posso ajudar com sua an√°lise hoje?"}]),[y,E]=o.useState(!1),w=o.useRef(null),{features:A,voiceProfiles:B}=fe(),N=he(),{speak:P}=ge(),L=A??{voiceTier:"none",voiceTTS:!1,voiceSTT:!1},M=B??[],T=be(L.voiceTier,M,"advisor");if(m)return e.jsxs("div",{className:"p-8 flex flex-col items-center justify-center gap-4 text-momentum-muted italic",children:[e.jsx(K,{className:"animate-spin",size:20}),e.jsx("span",{className:"text-xs font-bold uppercase tracking-widest",children:"Conectando Advisor..."})]});if(!j||!N)return null;async function C(){const r=(w.current?.value||"").trim();if(!(!r||y)){w.current&&(w.current.value=""),l(f=>[...f,{role:"user",text:r},{role:"assistant",text:"Processando an√°lise estrat√©gica..."}]),E(!0);try{const x=(await Te(r)).reply?.answer||"Sem resposta no momento. Tente reformular sua pergunta.";l(u=>u.slice(0,-1).concat({role:"assistant",text:x})),L.voiceTTS&&await P({text:x,voice:T,profile:"aconselhamento"})}catch(f){console.error("Advisor Error:",f),l(x=>x.slice(0,-1).concat({role:"assistant",text:"Erro ao processar resposta. Tente novamente."}))}finally{E(!1)}}}return e.jsxs("div",{className:"flex flex-col h-full bg-transparent",children:[e.jsxs("header",{className:"p-6 border-b border-momentum-border/50",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("div",{className:"p-1.5 rounded-lg bg-momentum-accent/10 text-momentum-accent",children:e.jsx(Z,{size:16})}),e.jsx("h3",{className:"text-sm font-bold text-momentum-text uppercase tracking-widest leading-none",children:"AI Advisor"})]}),e.jsx("p",{className:"text-[10px] text-momentum-muted font-medium uppercase tracking-wider leading-relaxed",children:"Intelig√™ncia Financeira Momentum em Tempo Real"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6 space-y-4 scroll-smooth scrollbar-none",children:[k.map((r,f)=>e.jsx("div",{className:R("flex w-full animate-in fade-in slide-in-from-bottom-2 duration-300",r.role==="user"?"justify-end":"justify-start"),children:e.jsxs("div",{className:R("flex gap-3 max-w-[90%]",r.role==="user"?"flex-row-reverse":"flex-row"),children:[e.jsx("div",{className:R("h-6 w-6 rounded-full flex items-center justify-center shrink-0 mt-1 shadow-sm",r.role==="assistant"?"bg-momentum-accent text-white":"bg-white border border-momentum-border text-momentum-text"),children:r.role==="assistant"?e.jsx(ye,{size:12}):e.jsx(we,{size:12})}),e.jsx("div",{className:R("px-3 py-2.5 rounded-2xl text-[13px] leading-relaxed shadow-sm",r.role==="assistant"?"bg-slate-50 dark:bg-slate-900/50 text-momentum-text rounded-tl-none border border-momentum-border/30":"bg-momentum-accent text-white rounded-tr-none shadow-momentum-glow"),children:e.jsx("div",{dangerouslySetInnerHTML:{__html:r.text.replace(/\//g,"<br/>")}})})]})},f)),y&&e.jsx("div",{className:"flex justify-start animate-pulse",children:e.jsxs("div",{className:"flex gap-2 items-center text-[10px] font-bold text-momentum-accent uppercase tracking-widest pl-10",children:[e.jsx(K,{className:"animate-spin",size:12}),"Analisando hist√≥rico..."]})})]}),e.jsxs("div",{className:"p-6 border-t border-momentum-border/50 bg-white/30 backdrop-blur-sm",children:[e.jsxs("div",{className:"relative group",children:[e.jsx("textarea",{ref:w,placeholder:"Pergunte sobre tend√™ncias...",className:"w-full bg-white dark:bg-slate-900/50 border border-slate-300 dark:border-white/10 rounded-xl px-4 py-3 pr-12 text-sm text-momentum-text placeholder:text-momentum-muted focus:outline-none focus:ring-2 focus:ring-momentum-accent/20 focus:border-momentum-accent transition-all resize-none min-h-[48px] max-h-32 shadow-inner",onKeyDown:r=>{r.key==="Enter"&&!r.shiftKey&&(r.preventDefault(),C())}}),e.jsx("button",{onClick:C,disabled:y,className:"absolute right-2 bottom-2 h-8 w-8 rounded-lg flex items-center justify-center bg-momentum-accent text-white shadow-momentum-glow hover:scale-105 active:scale-95 transition-all disabled:opacity-50 disabled:scale-100",children:y?e.jsx(K,{size:16,className:"animate-spin"}):e.jsx(Ne,{size:16})})]}),e.jsx("p",{className:"text-[9px] text-momentum-muted text-center mt-3 uppercase font-bold tracking-tighter opacity-60",children:"Powered by Momentum Intelligence Layer"})]})]})};function Ie(){const[j,m]=o.useState(()=>typeof document<"u"&&(document.body.classList.contains("dark")||document.body.getAttribute("data-theme")==="dark")?"dark":"light");return o.useEffect(()=>{const k=new MutationObserver(()=>{const l=document.body.classList.contains("dark")||document.body.getAttribute("data-theme")==="dark";m(l?"dark":"light")});return k.observe(document.body,{attributes:!0,attributeFilter:["class","data-theme"]}),()=>k.disconnect()},[]),j}U.register(ae,ne,re,oe,ie,ce,le,de,me,ue,pe);const Oe=()=>{const m=Ie()==="dark";Me();const{notify:k}=ve(),[l,y]=o.useState({balance:0,income:0,expense:0}),[E,w]=o.useState({categories:[],cards:[]}),[A,B]=o.useState([]),[N,P]=o.useState(!0),[L,M]=o.useState(!1),T=o.useRef(null),C=o.useRef(null),r=o.useRef(null),f=o.useRef(null),x=getComputedStyle(document.documentElement),u=[x.getPropertyValue("--chart-1").trim()||"#10b981",x.getPropertyValue("--chart-2").trim()||"#f43f5e",x.getPropertyValue("--chart-3").trim()||"#8b5cf6",x.getPropertyValue("--chart-4").trim()||"#f59e0b",x.getPropertyValue("--chart-5").trim()||"#3b82f6"],z=m?"#94a3b8":"#64748b";function H(s,i,h=3){const t=s.filter(n=>n!==null&&n>0),a=t.length;let p,c;if(a<3)p=.4,c=.02;else if(a<6){p=.25;const n=t.slice(-3).reduce((g,v)=>g+v,0)/3,d=t.slice(0,Math.min(3,t.length)).reduce((g,v)=>g+v,0)/Math.min(3,t.length);c=d>0?(n-d)/d/a:.02}else{p=.15;const n=[.1,.15,.2,.25,.3],d=t.slice(-5);let g=0,v=0;d.forEach(($,G)=>{const X=n[G]||.3;g+=$*X,v+=X});const se=g/v,W=t.slice(-6,-3).reduce(($,G)=>$+G,0)/3;c=W>0?(se-W)/W/3:.01}c=Math.max(-.15,Math.min(.15,c));const b=t.length>0?t.slice(-3).reduce((n,d)=>n+d,0)/Math.min(3,t.length):5e3,S=[...s.map(()=>null)],V=[...s.map(()=>null)],F=[...s.map(()=>null)],q=[...i];if(t.length>0){const n=s.length-1;S[n]=t[t.length-1],V[n]=t[t.length-1],F[n]=t[t.length-1]}const Q=["Jan","Fev","Mar","Abr","Mai","Jun","Jul","Ago","Set","Out","Nov","Dez"],te=i.length>0?Q.indexOf(i[i.length-1]?.substring(0,3)):new Date().getMonth();for(let n=1;n<=h;n++){const d=b*Math.pow(1+c,n),g=d*p*(1+n*.1);S.push(Math.round(d)),V.push(Math.round(d+g)),F.push(Math.round(Math.max(0,d-g)));const v=(te+n)%12;q.push(`${Q[v]} (Proj)`)}return{forecastValues:S,upper:V,lower:F,extendedMonths:q}}async function D(){P(!0);try{const i=(await _.get("/portal/forecast")).data,h=i?.kpis||{balance:0,income:0,expense:0};y(h),w(i?.meta||{categories:[],cards:[]});const t=i?.charts||{months:[],incomeSeries:[],expenseSeries:[],forecastIncome:[],forecastExpense:[],confidenceUpper:[],confidenceLower:[],categories:[]};let a;if(!t.forecastIncome||t.forecastIncome.length===0){const b=H(t.incomeSeries,t.months,3),S=H(t.expenseSeries,t.months,3);a={...t,months:b.extendedMonths,incomeSeries:[...t.incomeSeries,...Array(3).fill(null)],expenseSeries:[...t.expenseSeries,...Array(3).fill(null)],forecastIncome:b.forecastValues,forecastExpense:S.forecastValues,confidenceUpper:b.upper,confidenceLower:b.lower}}else a=t;ee(a);const p=(h.balance||0)!==0||(h.income||0)!==0||(h.expense||0)!==0,c=(a.months?.length||0)>0||(a.categories?.length||0)>0;M(p||c)}catch(s){console.error("Analytics Load Error:",s),M(!1)}finally{P(!1)}}async function J(){try{const{data:s}=await _.get("/portal/insights/cache").catch(()=>({data:[]}));B(Array.isArray(s)?s:[])}catch{}}function ee(s){const i=T.current?.getContext("2d"),h=C.current?.getContext("2d");if(!i||!h)return;r.current?.destroy(),f.current?.destroy();const t=i.createLinearGradient(0,0,0,280);t.addColorStop(0,m?"rgba(139, 92, 246, 0.15)":"rgba(139, 92, 246, 0.1)"),t.addColorStop(1,"rgba(139, 92, 246, 0)"),r.current=new U(i,{type:"line",data:{labels:s.months,datasets:[{label:"Limite Superior",data:s.confidenceUpper,borderColor:"transparent",backgroundColor:t,fill:"+1",pointRadius:0,tension:.4,order:3},{label:"Limite Inferior",data:s.confidenceLower,borderColor:"transparent",backgroundColor:"transparent",fill:!1,pointRadius:0,tension:.4,order:4},{label:"Receitas",data:s.incomeSeries,borderColor:u[0],backgroundColor:m?"rgba(16, 185, 129, 0.1)":"rgba(16, 185, 129, 0.05)",borderWidth:2.5,tension:.4,fill:!0,pointRadius:4,pointBackgroundColor:u[0],order:1},{label:"Despesas",data:s.expenseSeries,borderColor:u[1],backgroundColor:"transparent",borderWidth:2.5,tension:.4,pointRadius:4,pointBackgroundColor:u[1],order:2},{label:"Receitas (Proj)",data:s.forecastIncome,borderColor:u[0],backgroundColor:"transparent",borderWidth:2,borderDash:[6,4],tension:.4,pointRadius:3,pointStyle:"circle",pointBackgroundColor:m?"#1e293b":"#ffffff",pointBorderColor:u[0],pointBorderWidth:2,order:1},{label:"Despesas (Proj)",data:s.forecastExpense,borderColor:u[1],backgroundColor:"transparent",borderWidth:2,borderDash:[6,4],tension:.4,pointRadius:3,pointStyle:"circle",pointBackgroundColor:m?"#1e293b":"#ffffff",pointBorderColor:u[1],pointBorderWidth:2,order:2}]},options:{responsive:!0,maintainAspectRatio:!1,interaction:{mode:"index",intersect:!1},plugins:{legend:{display:!0,position:"top",align:"end",labels:{color:z,boxWidth:12,usePointStyle:!0,font:{size:10,weight:"bold"},filter:a=>!a.text?.includes("Limite")}},tooltip:{backgroundColor:"rgba(15, 23, 42, 0.95)",padding:14,cornerRadius:10,titleFont:{size:12,weight:"bold"},bodyFont:{size:11},callbacks:{label:a=>{const p=a.raw;if(p===null)return"";const c=p.toLocaleString("pt-BR",{style:"currency",currency:"BRL"}),b=a.dataset.label?.includes("Proj");return`${a.dataset.label}: ${c}${b?" ‚ö°":""}`}}}},scales:{y:{grid:{color:m?"rgba(226, 232, 240, 0.05)":"rgba(0, 0, 0, 0.05)"},ticks:{color:z,font:{size:10},callback:a=>`R$ ${(Number(a)/1e3).toFixed(0)}k`}},x:{grid:{display:!1},ticks:{color:z,font:{size:10,weight:"bold"},callback:function(a,p){const c=s.months[p];return c?.includes("(Proj)")?`üìà ${c.replace(" (Proj)","")}`:c}}}}}}),f.current=new U(h,{type:"doughnut",data:{labels:s.categories.map(a=>a.category),datasets:[{data:s.categories.map(a=>a.amount),backgroundColor:u,borderColor:"transparent",hoverOffset:4}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"bottom",labels:{color:z,usePointStyle:!0,pointStyle:"circle",font:{size:10}}}},cutout:"70%"}})}return o.useEffect(()=>{D()},[]),o.useEffect(()=>{N||J()},[N]),e.jsxs("div",{className:"space-y-8 pb-20 fade-in",children:[e.jsx(Pe,{title:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Y,{size:24,className:"text-momentum-accent"}),e.jsx("span",{children:"Analytics Financeiro"})]}),subtitle:"Vis√£o estrat√©gica de fluxos, categorias e sa√∫de do neg√≥cio.",actions:e.jsxs("button",{onClick:D,className:"flex items-center gap-2 px-3 py-1.5 rounded-lg border border-momentum-border hover:bg-white transition-all text-xs font-bold text-momentum-muted hover:text-momentum-text",children:[e.jsx(ke,{size:14,className:R(N&&"animate-spin")}),"Sincronizar"]})}),e.jsxs("div",{className:"grid gap-8 md:grid-cols-[1fr_360px]",children:[e.jsx("div",{className:"space-y-8",children:e.jsx(Le,{isLoading:N,isEmpty:!L,emptyTitle:"Sem Dados",emptyDescription:"Conecte suas finan√ßas para gerar insights.",onRetry:D,children:e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-6 font-bold",children:[e.jsx(O,{label:"Saldo Projetado",value:l.balance.toLocaleString("pt-BR",{style:"currency",currency:"BRL"}),icon:Ce,trend:l.balanceTrend?{value:l.balanceTrend,direction:l.balanceTrend.includes("+")?"up":"down"}:void 0}),e.jsx(O,{label:"Receita Mensal",value:l.income.toLocaleString("pt-BR",{style:"currency",currency:"BRL"}),variant:"success",icon:Y}),e.jsx(O,{label:"Despesa Mensal",value:l.expense.toLocaleString("pt-BR",{style:"currency",currency:"BRL"}),variant:"danger",icon:Se})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-8",children:[e.jsxs(I,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-6",children:[e.jsx(Re,{size:18,className:"text-momentum-accent"}),e.jsx("h3",{className:"text-sm font-bold text-momentum-text uppercase tracking-widest",children:"Tend√™ncia (6 Meses)"})]}),e.jsx("div",{className:"h-[280px]",children:e.jsx("canvas",{ref:T})})]}),e.jsxs(I,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-6",children:[e.jsx(Ae,{size:18,className:"text-momentum-accent"}),e.jsx("h3",{className:"text-sm font-bold text-momentum-text uppercase tracking-widest",children:"Categorias"})]}),e.jsx("div",{className:"h-[280px]",children:e.jsx("canvas",{ref:C})})]})]}),e.jsxs(I,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Z,{size:18,className:"text-momentum-accent"}),e.jsx("h3",{className:"text-sm font-bold text-momentum-text uppercase tracking-widest",children:"Insights Estrat√©gicos"})]}),e.jsx("button",{onClick:J,className:"text-[10px] font-bold text-momentum-accent uppercase hover:underline",children:"Atualizar IA"})]}),e.jsx("div",{className:"grid gap-4 sm:grid-cols-2",children:A.length?A.map((s,i)=>e.jsx(je,{title:"An√°lise Relevante",description:s,severity:"info"},i)):e.jsx("div",{className:"col-span-full py-8 text-center text-sm text-momentum-muted italic border-2 border-dashed border-momentum-border rounded-2xl",children:"Nenhum insight dispon√≠vel no momento."})})]})]})})}),e.jsx("div",{className:"hidden md:block",children:e.jsx(I,{className:"p-0 overflow-hidden sticky top-8 border-none shadow-2xl",children:e.jsx(ze,{})})})]})]})};export{Oe as AnalyticsDashboard,Oe as default};
