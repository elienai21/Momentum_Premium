import{c as E,i as _,r as a,b as A,s as B,o as I,v as M,w as F,a as G,f as O,x as H,j as e,G as f,E as q,S as Q}from"./index-CDF0DbQ4.js";import{A as V}from"./AsyncPanel-1CPXaLuI.js";import{U as W}from"./user-R-Jdmox2.js";import{C as J}from"./credit-card-b3S2OhYo.js";import{B as K}from"./building-2-DFyRNOWZ.js";import{R as X}from"./refresh-cw-CZqQlwpN.js";import{H as Y}from"./history-D6y4heRL.js";const Z=[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],ee=E("settings",Z);const se=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]],te=E("shield",se);function ae(t=10){const l=_()?.token??null,[x,i]=a.useState([]),[o,n]=a.useState(!1),[h,m]=a.useState(null),d=a.useCallback(async()=>{if(l){n(!0),m(null);try{const c=await A.get(`/billing/usage-logs?limit=${t}`);i(c.data.logs||[])}catch(c){m(c instanceof Error?c:new Error("Erro ao carregar logs"))}finally{n(!1)}}},[l,t]);return a.useEffect(()=>{d()},[d]),{logs:x,isLoading:o,error:h,refetch:d}}function re(t){const[r,l]=a.useState(null);return a.useEffect(()=>{async function x(){try{const i=B(I,"tenants",t),o=await M(i);o.exists()&&l(o.data())}catch(i){console.error("Erro ao carregar tenant:",i)}}x()},[t]),r}function C(t){return new Intl.NumberFormat("pt-BR").format(t)}function P(t){if(!t)return"N/A";const r=new Date(t);return Number.isNaN(r.getTime())?"N/A":r.toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric"})}const me=()=>{const[t,r]=F(),{notify:l}=G(),x=t.get("tab")||"billing",[i,o]=a.useState(x),{credits:n,isLoading:h,refetch:m}=O(),{logs:d,isLoading:c}=ae(10),{tenantId:y}=H(),p=re(y),[u,j]=a.useState(""),[N,T]=a.useState(""),[v,w]=a.useState(!1);a.useEffect(()=>{p&&j(p?.name||"")},[p]);const z=s=>{o(s),r({tab:s})},L=async()=>{w(!0);try{await new Promise(s=>setTimeout(s,500)),console.log("Profile saved:",{profileName:u,profileRole:N})}finally{w(!1)}},R=async()=>{try{const s=await A.get("/billing/portal");if(s.data.code==="requires_setup"||s.data.error&&!s.data.url){l({type:"info",message:"Sua conta ainda não possui faturas geradas. Entre em contato com o suporte."});return}s.data.url&&window.open(s.data.url,"_blank")}catch(s){console.warn("Billing portal error:",s),s?.response?.data?.code==="NO_STRIPE_CUSTOMER"&&l({type:"info",message:"Sua conta ainda não possui faturas geradas."})}},b=n?.monthlyQuota||0,k=n?.available||0,g=b>0?Math.min(100,Math.max(0,k/b*100)):0,S=(n?.planNormalized||p?.plan||"Starter").toUpperCase(),D=P(n?.renewsAt),U=n?.periodSource==="stripe"?"Ciclo de Faturamento":"Ciclo de 30 dias",$=[{id:"profile",label:"Perfil",icon:W},{id:"billing",label:"Plano & Créditos",icon:J}];return e.jsxs("div",{className:"pt-24 space-y-8 pb-24 fade-in","aria-live":"polite",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold text-slate-800 dark:text-slate-200 font-display flex items-center gap-2",children:[e.jsx(ee,{size:24,className:"text-primary"}),"Configurações"]}),e.jsx("p",{className:"text-slate-500 dark:text-slate-400 font-display text-sm",children:"Gerencie seu perfil, plano e créditos de IA."})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:e.jsx(le,{label:S,color:"success"})})]}),e.jsx("div",{className:"flex gap-2 border-b border-slate-200 dark:border-slate-800 pb-1",children:$.map(s=>e.jsxs("button",{onClick:()=>z(s.id),className:`flex items-center gap-2 px-4 py-2.5 rounded-t-lg text-sm font-bold transition-all font-display ${i===s.id?"bg-white dark:bg-slate-800 text-primary border-b-2 border-primary shadow-sm":"text-slate-500 dark:text-slate-400 hover:text-slate-700 dark:hover:text-slate-200 hover:bg-slate-100 dark:hover:bg-slate-800/50"}`,children:[e.jsx(s.icon,{size:16}),s.label]},s.id))}),i==="profile"&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 animate-in fade-in duration-300",children:[e.jsxs(f,{className:"p-6 border border-slate-200/50 dark:border-white/5",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-gradient-to-br from-primary to-secondary flex items-center justify-center text-white text-lg font-bold shadow-glow",children:u?.charAt(0)?.toUpperCase()||"U"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-slate-800 dark:text-slate-200 font-display",children:"Dados do Perfil"}),e.jsx("p",{className:"text-xs text-slate-400 font-display",children:"Atualize suas informações pessoais"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"text-[10px] uppercase font-bold text-slate-400 tracking-widest font-display",children:"Nome Completo"}),e.jsx("input",{type:"text",value:u,onChange:s=>j(s.target.value),className:"w-full bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-xl px-4 py-3 text-sm font-display focus:ring-2 focus:ring-primary/20 focus:border-primary transition-all",placeholder:"Seu nome"})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"text-[10px] uppercase font-bold text-slate-400 tracking-widest font-display",children:"Cargo"}),e.jsx("input",{type:"text",value:N,onChange:s=>T(s.target.value),className:"w-full bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-xl px-4 py-3 text-sm font-display focus:ring-2 focus:ring-primary/20 focus:border-primary transition-all",placeholder:"Ex: Diretor Financeiro"})]}),e.jsx("button",{onClick:L,disabled:v,className:"w-full py-3 rounded-xl bg-primary hover:bg-primary/90 text-white font-bold text-sm transition-all shadow-glow disabled:opacity-50 font-display",children:v?"Salvando...":"Salvar Alterações"})]})]}),e.jsxs(f,{className:"p-6 border border-slate-200/50 dark:border-white/5",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(K,{size:18,className:"text-primary"}),e.jsx("h3",{className:"font-bold text-slate-800 dark:text-slate-200 font-display",children:"Dados da Organização"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-[9px] uppercase font-bold text-slate-400 tracking-widest font-display",children:"Nome do Tenant"}),e.jsx("p",{className:"text-slate-700 dark:text-slate-200 font-bold text-sm font-display",children:p?.name||"Minha Empresa"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-[9px] uppercase font-bold text-slate-400 tracking-widest font-display",children:"Workspace ID"}),e.jsx("code",{className:"text-[11px] bg-slate-100 dark:bg-slate-800 px-1.5 py-0.5 rounded text-slate-500 dark:text-slate-400 font-mono block truncate",children:y||"---"})]})]})]})]}),i==="billing"&&e.jsxs("div",{className:"space-y-6 animate-in fade-in duration-300",children:[e.jsxs("div",{className:"glass rounded-xl p-8 relative overflow-hidden border border-primary/20 group",children:[e.jsx("div",{className:"absolute top-0 right-0 w-64 h-64 bg-primary/20 rounded-full blur-[80px] -mr-16 -mt-16 pointer-events-none opacity-60 group-hover:opacity-100 transition-opacity"}),e.jsxs("div",{className:"relative z-10 flex flex-col md:flex-row items-start md:items-center justify-between gap-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 rounded-xl bg-primary/20 text-primary shadow-glow",children:e.jsx(te,{size:24})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-[10px] font-bold text-slate-400 uppercase tracking-widest font-display",children:"Seu Plano"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xl font-bold text-slate-800 dark:text-slate-200 font-display",children:S}),e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-success/20 text-success text-[10px] font-bold uppercase",children:"Ativo"})]}),e.jsxs("p",{className:"text-xs text-slate-400 mt-1 font-display",children:["Renova em: ",D]})]})]}),e.jsxs("button",{onClick:R,className:"bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 text-slate-600 dark:text-slate-300 px-5 py-2.5 rounded-lg text-sm font-bold hover:bg-slate-50 dark:hover:bg-slate-700 transition-all shadow-sm flex items-center gap-2 font-display",children:["Gerenciar Assinatura",e.jsx(q,{size:16})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"flex h-6 w-6 items-center justify-center rounded bg-primary/20 text-primary shadow-glow",children:e.jsx(Q,{size:14})}),e.jsx("h3",{className:"text-lg font-bold text-slate-800 dark:text-slate-200 font-display",children:"Créditos de IA"})]}),e.jsxs(f,{className:"p-6 border border-slate-200/50 dark:border-white/5",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-300 font-bold font-display",children:"Uso no Período"}),e.jsx("p",{className:"text-[11px] text-slate-400 italic font-display",children:U})]}),e.jsx("button",{onClick:()=>m(),className:"p-2 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-800 text-slate-400 hover:text-primary transition-colors",children:e.jsx(X,{size:16,className:h?"animate-spin":""})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-end justify-between",children:[e.jsxs("span",{className:"text-4xl font-black text-slate-800 dark:text-slate-200 tracking-tighter font-display",children:[C(k),e.jsx("span",{className:"text-lg font-normal text-slate-400 ml-1",children:"restantes"})]}),e.jsxs("span",{className:"text-xs font-bold text-slate-500 bg-slate-100 dark:bg-slate-800 px-2 py-1 rounded-md font-display",children:["Cota: ",C(b)]})]}),e.jsx("div",{className:"h-5 w-full bg-slate-200 dark:bg-slate-800 rounded-full overflow-hidden p-1 shadow-inner",children:e.jsx("div",{className:`h-full rounded-full transition-all duration-1000 ease-out ${g>40?"bg-gradient-to-r from-primary to-secondary":g>15?"bg-warning":"bg-error"}`,style:{width:`${g}%`}})})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Y,{size:16,className:"text-slate-500"}),e.jsx("h3",{className:"text-[10px] font-bold text-slate-600 dark:text-slate-400 uppercase tracking-widest font-display",children:"Histórico de Uso"})]}),e.jsx(V,{isLoading:c,error:null,isEmpty:d.length===0,emptyTitle:"Sem registros",emptyDescription:"Nenhum consumo de créditos registrado ainda.",children:e.jsx(f,{className:"p-0 overflow-hidden border border-slate-200/50 dark:border-white/5",children:e.jsxs("table",{className:"w-full text-xs",children:[e.jsx("thead",{className:"bg-slate-50 dark:bg-white/5 border-b border-slate-200 dark:border-white/5",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-[9px] font-bold uppercase text-slate-400 tracking-widest font-display",children:"Tipo"}),e.jsx("th",{className:"px-4 py-3 text-left text-[9px] font-bold uppercase text-slate-400 tracking-widest font-display",children:"Fonte"}),e.jsx("th",{className:"px-4 py-3 text-right text-[9px] font-bold uppercase text-slate-400 tracking-widest font-display",children:"Créditos"}),e.jsx("th",{className:"px-4 py-3 text-right text-[9px] font-bold uppercase text-slate-400 tracking-widest font-display",children:"Data"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-100 dark:divide-white/5",children:d.map(s=>e.jsxs("tr",{className:"hover:bg-primary/5 transition-colors",children:[e.jsx("td",{className:"px-4 py-3 font-bold text-slate-800 dark:text-slate-200 font-display",children:s.type}),e.jsx("td",{className:"px-4 py-3 text-slate-500 dark:text-slate-400 font-display",children:s.source}),e.jsxs("td",{className:"px-4 py-3 text-right font-black text-error font-display",children:["-",s.creditsConsumed]}),e.jsx("td",{className:"px-4 py-3 text-right text-slate-400 font-display",children:P(s.createdAt)})]},s.id))})]})})})]})]})]})},le=({label:t,color:r="slate"})=>{const l={slate:"bg-white dark:bg-slate-800 border-slate-200 dark:border-slate-700 text-slate-500 dark:text-slate-400",success:"bg-emerald-50 dark:bg-emerald-900/20 border-emerald-100 dark:border-emerald-800 text-emerald-600 dark:text-emerald-400"};return e.jsxs("div",{className:`px-3 py-1 rounded-full border text-[11px] font-bold flex items-center gap-2 shadow-sm font-display ${l[r]}`,children:[e.jsx("span",{className:`w-1.5 h-1.5 rounded-full ${r==="success"?"bg-emerald-500":"bg-slate-400"}`}),t]})};export{me as default};
