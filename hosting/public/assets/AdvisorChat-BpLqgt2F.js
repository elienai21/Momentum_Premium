import{c as g,h as _,e as L,r as t,i as $,k as D,l as V,j as e,L as S,a as P}from"./index-Cs_F5hSh.js";const R=[["path",{d:"M12 8V4H8",key:"hb8ula"}],["rect",{width:"16",height:"12",x:"4",y:"8",rx:"2",key:"enze0r"}],["path",{d:"M2 14h2",key:"vft8re"}],["path",{d:"M20 14h2",key:"4cs60a"}],["path",{d:"M15 13v2",key:"1xurst"}],["path",{d:"M9 13v2",key:"rq6x2g"}]],v=g("bot",R);const H=[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]],K=g("send",H);const q=[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]],B=g("user",q);async function U(l){return(await P.post("/advisor/session",{messages:l})).data}function J({onClose:l}){const{features:b,voiceProfiles:T}=_(),r=b||{advisor:!0,voiceTTS:!1,voiceSTT:!1},A=L(),[p,n]=t.useState([{role:"assistant",content:"Olá! Sou seu Advisor Momentum. Me conte o que está tirando o sono do seu caixa hoje."}]),[m,c]=t.useState(""),[h,y]=t.useState(!1),[d,j]=t.useState("idle"),u=t.useRef(null),{speak:F,speaking:M,stop:C}=$({voiceId:D(T,"advisor")}),{start:E,stop:z,transcript:f,error:w}=V();t.useEffect(()=>{f&&c(f)},[f]),t.useEffect(()=>{u.current&&(u.current.scrollTop=u.current.scrollHeight)},[p]);const N=async()=>{const s=m.trim();if(!s||h)return;const x=[...p,{role:"user",content:s}];n(x),c(""),y(!0);try{if(!A){n(a=>[...a,{role:"assistant",content:"Você precisa estar autenticado para usar o Advisor. Faça login e tente novamente."}]);return}const o=await U(x.map(a=>({role:a.role,content:a.content}))),i={role:"assistant",content:o.reply};n(a=>[...a,i]),r.voiceTTS&&await F(o.reply)}catch(o){o?.code==="NO_CREDITS"?n(i=>[...i,{role:"assistant",content:"Você ficou sem créditos de IA neste plano. Atualize seu plano ou aguarde a renovação dos créditos para continuar usando o Advisor."}]):n(i=>[...i,{role:"assistant",content:o?.message||"Erro ao processar resposta."}])}finally{y(!1)}},I=s=>{s.key==="Enter"&&!s.shiftKey&&(s.preventDefault(),N())},O=()=>{r.voiceSTT&&(d==="idle"?(c(""),j("listening"),E()):(j("processing"),z()))},k=d==="listening";return e.jsxs("section",{className:"flex flex-col h-full bg-white rounded-2xl border border-slate-200 shadow-sm overflow-hidden",children:[e.jsxs("header",{className:"flex items-center justify-between px-4 py-3 border-b border-slate-100 bg-slate-50",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-8 w-8 rounded-full bg-emerald-100 flex items-center justify-center",children:e.jsx(v,{className:"h-4 w-4 text-emerald-700"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-sm font-semibold text-slate-900",children:"CFO Advisor"}),e.jsx("p",{className:"text-xs text-slate-500",children:"Pergunte sobre caixa, runway e cenários"})]})]}),l&&e.jsx("button",{onClick:l,className:"text-xs text-slate-500 hover:text-slate-700",children:"Fechar"})]}),e.jsx("div",{ref:u,className:"flex-1 overflow-y-auto px-4 py-3 space-y-3 bg-slate-50/60",children:p.map((s,x)=>e.jsxs("div",{className:`flex gap-2 ${s.role==="assistant"?"items-start":"items-start justify-end"}`,children:[s.role==="assistant"?e.jsx("div",{className:"h-7 w-7 rounded-full bg-emerald-100 flex items-center justify-center mt-0.5",children:e.jsx(v,{className:"h-4 w-4 text-emerald-700"})}):e.jsx("div",{className:"h-7 w-7 rounded-full bg-slate-200 flex items-center justify-center mt-0.5",children:e.jsx(B,{className:"h-4 w-4 text-slate-700"})}),e.jsx("div",{className:`max-w-[80%] rounded-2xl px-3 py-2 text-xs whitespace-pre-wrap ${s.role==="assistant"?"bg-white border border-slate-200 text-slate-800":"bg-emerald-600 text-white"}`,children:s.content})]},x))}),e.jsxs("footer",{className:"border-t border-slate-100 p-3 space-y-2 bg-white",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("button",{type:"button",onClick:O,disabled:!r.voiceSTT,"aria-pressed":k,"aria-label":r.voiceSTT?k?"Parar captura de voz":"Iniciar captura de voz":"Entrada de voz indisponível no seu plano",className:`inline-flex items-center gap-2 px-3 py-1.5 rounded-full text-[11px] font-medium shadow-sm transition ${d==="listening"?"bg-red-500 text-white":"bg-slate-100 text-slate-700"} ${r.voiceSTT?"":"opacity-50 cursor-not-allowed"}`,children:d==="listening"?e.jsxs(e.Fragment,{children:[e.jsx(S,{className:"h-3 w-3 animate-spin"}),"Ouvindo..."]}):e.jsxs(e.Fragment,{children:[e.jsx(v,{className:"h-3 w-3"}),"Falar em voz alta"]})}),M&&e.jsx("button",{type:"button",onClick:C,className:"text-[11px] text-slate-500 hover:text-slate-700",children:"Parar áudio"})]}),w&&e.jsx("p",{className:"text-[11px] text-amber-700 bg-amber-50 border border-amber-200 rounded px-2 py-1",children:w}),e.jsxs("div",{className:"flex items-end gap-2",children:[e.jsxs("div",{className:"flex-1 flex flex-col gap-1",children:[e.jsx("label",{className:"sr-only",htmlFor:"advisor-input",children:"Mensagem para o CFO Advisor"}),e.jsx("textarea",{id:"advisor-input",className:"flex-1 text-xs rounded-xl border border-slate-200 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-emerald-500/40 focus:border-emerald-500 resize-none min-h-[48px] max-h-[80px]",placeholder:"Digite ou fale com seu CFO Virtual...",value:m,onChange:s=>c(s.target.value),onKeyDown:I})]}),e.jsx("button",{type:"button",onClick:()=>void N(),disabled:h||!m.trim(),className:"inline-flex items-center justify-center h-9 w-9 rounded-full bg-emerald-600 text-white disabled:opacity-50 disabled:cursor-not-allowed hover:bg-emerald-700 transition",children:h?e.jsx(S,{className:"h-4 w-4 animate-spin"}):e.jsx(K,{className:"h-4 w-4"})})]}),e.jsx("p",{className:"text-[10px] text-slate-400",children:"O Advisor usa IA para analisar seus dados financeiros e sugerir ações."})]})]})}export{J as A};
