import{c,b as g,r as l,j as e,X as _,L as A,f as D,G as H}from"./index-CnecHh6o.js";import{B as z}from"./building-2-Cs7Oi7i7.js";import{U as $}from"./user-QyTa_Opp.js";import{S as q}from"./SectionHeader-DUnCG6vt.js";import{S as w}from"./StatsCard-C_NEOUKV.js";import{B as C}from"./Badge-BfV7Ne6X.js";import{A as O}from"./AsyncPanel-C3U6zNBS.js";import{R as V}from"./refresh-cw-CAK1KFWO.js";import{T}from"./trending-up-BjP5eInK.js";import{C as L}from"./circle-dollar-sign-Di5tmUAS.js";import{S as G}from"./search-qZKTdwq4.js";const F=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],M=c("chevron-down",F);const W=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],E=c("chevron-right",W);const X=[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-6a2 2 0 0 1 2.582 0l7 6A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"r6nss1"}]],P=c("house",X);const J=[["line",{x1:"19",x2:"5",y1:"5",y2:"19",key:"1x9vlm"}],["circle",{cx:"6.5",cy:"6.5",r:"2.5",key:"4mh3h7"}],["circle",{cx:"17.5",cy:"17.5",r:"2.5",key:"1mdrzq"}]],K=c("percent",J);const Q=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],Y=c("plus",Q);const Z=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],ee=c("save",Z);async function se(t=30){return(await g.get(`/realestate/portfolio-summary?days=${t}`)).data.summary}async function U(){return(await g.get("/realestate/buildings")).data.buildings}async function te(){return(await g.get("/realestate/units")).data.units}async function ae(){return(await g.get("/realestate/owners")).data.owners}async function le(t){return(await g.post("/realestate/units",t)).data.unit}function re({onClose:t,onSuccess:x}){const[u,k]=l.useState([]),[b,S]=l.useState([]),[m,h]=l.useState(!1),[v,p]=l.useState(!1),[r,o]=l.useState({code:"",name:"",buildingId:"",ownerId:""});l.useEffect(()=>{async function a(){h(!0);try{const[i,j]=await Promise.all([U(),ae()]);k(i),S(j)}catch(i){console.error("Erro ao carregar selects:",i)}finally{h(!1)}}a()},[]);const d=async a=>{if(a.preventDefault(),!(!r.code||!r.ownerId)){p(!0);try{await le({code:r.code,name:r.name,buildingId:r.buildingId||void 0,ownerId:r.ownerId,active:!0}),x(),t()}catch(i){console.error("Erro ao salvar unidade:",i),alert("Erro ao salvar unidade. Verifique os dados.")}finally{p(!1)}}};return e.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4 bg-slate-900/60 backdrop-blur-sm animate-in fade-in duration-300",children:e.jsxs("div",{className:"bg-white w-full max-w-lg rounded-3xl shadow-2xl overflow-hidden border border-slate-200",children:[e.jsxs("div",{className:"px-8 py-6 border-b border-slate-100 flex items-center justify-between bg-slate-50/50",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-slate-900 text-white flex items-center justify-center",children:e.jsx(ie,{size:20})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-slate-900 tracking-tight",children:"Nova Propriedade"}),e.jsx("p",{className:"text-xs text-slate-500 font-medium",children:"Cadastre uma nova unidade ao seu portfólio."})]})]}),e.jsx("button",{onClick:t,className:"p-2 hover:bg-slate-200 rounded-full transition-colors text-slate-400",children:e.jsx(_,{size:20})})]}),e.jsxs("form",{onSubmit:d,className:"p-8 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs("label",{className:"text-[10px] uppercase font-bold text-slate-400 tracking-widest flex items-center gap-1.5",children:[e.jsx(P,{size:12})," Código da Unidade"]}),e.jsx("input",{required:!0,type:"text",placeholder:"Ex: 1204-A",value:r.code,onChange:a=>o(i=>({...i,code:a.target.value})),className:"w-full bg-slate-50 border border-slate-200 rounded-xl px-4 py-3 text-sm focus:ring-2 focus:ring-blue-500/20 outline-none transition-all font-bold"})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"text-[10px] uppercase font-bold text-slate-400 tracking-widest",children:"Nome Amigável"}),e.jsx("input",{type:"text",placeholder:"Ex: Brera Moema",value:r.name,onChange:a=>o(i=>({...i,name:a.target.value})),className:"w-full bg-slate-50 border border-slate-200 rounded-xl px-4 py-3 text-sm focus:ring-2 focus:ring-blue-500/20 outline-none transition-all"})]})]}),e.jsxs("div",{className:"space-y-4 pt-2",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs("label",{className:"text-[10px] uppercase font-bold text-slate-400 tracking-widest flex items-center gap-1.5",children:[e.jsx(z,{size:12})," Edifício (Opcional)"]}),m?e.jsx("div",{className:"h-12 bg-slate-100 animate-pulse rounded-xl"}):e.jsxs("select",{value:r.buildingId,onChange:a=>o(i=>({...i,buildingId:a.target.value})),className:"w-full bg-slate-50 border border-slate-200 rounded-xl px-4 py-3 text-sm focus:ring-2 focus:ring-blue-500/20 outline-none transition-all appearance-none cursor-pointer",children:[e.jsx("option",{value:"",children:"Nenhum (Propriedade Avulsa)"}),u.map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))]})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs("label",{className:"text-[10px] uppercase font-bold text-slate-400 tracking-widest flex items-center gap-1.5",children:[e.jsx($,{size:12})," Proprietário"]}),m?e.jsx("div",{className:"h-12 bg-slate-100 animate-pulse rounded-xl"}):e.jsxs("select",{required:!0,value:r.ownerId,onChange:a=>o(i=>({...i,ownerId:a.target.value})),className:"w-full bg-slate-50 border border-slate-200 rounded-xl px-4 py-3 text-sm focus:ring-2 focus:ring-blue-500/20 outline-none transition-all appearance-none cursor-pointer",children:[e.jsx("option",{value:"",disabled:!0,children:"Selecione um proprietário..."}),b.map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))]})]})]}),e.jsxs("div",{className:"pt-4 flex items-center gap-3",children:[e.jsx("button",{type:"button",onClick:t,className:"flex-1 py-3.5 rounded-2xl bg-slate-100 text-slate-600 font-bold text-sm hover:bg-slate-200 transition-all active:scale-95",children:"Cancelar"}),e.jsxs("button",{type:"submit",disabled:v||!r.code||!r.ownerId,className:"flex-[2] py-3.5 rounded-2xl bg-blue-600 text-white font-bold text-sm hover:bg-blue-700 shadow-lg shadow-blue-500/20 transition-all active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:[v?e.jsx(A,{size:18,className:"animate-spin"}):e.jsx(ee,{size:18}),"Salvar Propriedade"]})]})]})]})})}function ie({size:t}){return e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),e.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]})}const B=t=>t==null?"R$ 0,00":t.toLocaleString("pt-BR",{style:"currency",currency:"BRL"});function be(){const[t,x]=l.useState(null),[u,k]=l.useState([]),[b,S]=l.useState([]),[m,h]=l.useState(!0),[v,p]=l.useState(null),[r,o]=l.useState(""),[d,a]=l.useState({avulsas:!0}),[i,j]=l.useState(!1),N=l.useCallback(async()=>{h(!0),p(null);try{const[s,n,f]=await Promise.all([se(30),U(),te()]);x(s),k(n),S(f)}catch(s){console.error("[RealEstateDashboard] Erro:",s),p("Falha ao carregar dados do portfólio.")}finally{h(!1)}},[]);l.useEffect(()=>{N()},[N]);const I=s=>{a(n=>({...n,[s]:!n[s]}))},R=l.useMemo(()=>{const s=r.toLowerCase();return u.filter(n=>n.name.toLowerCase().includes(s))},[u,r]),y=l.useMemo(()=>{const s={};return b.forEach(n=>{const f=n.buildingId||"avulsas";s[f]||(s[f]=[]),s[f].push(n)}),s},[b]);return e.jsxs("div",{className:"space-y-8 pb-24 fade-in",children:[e.jsx(q,{title:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(z,{size:24,className:"text-blue-500"}),e.jsx("span",{className:"tracking-tight",children:"Portfólio Imobiliário V2"})]}),subtitle:"Gestão centralizada por edifícios e propriedades individuais.",actions:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:N,className:"bg-white hover:bg-slate-50 text-slate-600 border border-slate-200 px-4 py-2 rounded-xl text-sm font-bold transition-all shadow-sm flex items-center gap-2 active:scale-95",children:e.jsx(V,{size:14,className:D(m&&"animate-spin")})}),e.jsxs("button",{onClick:()=>j(!0),className:"bg-slate-900 border border-slate-800 text-white px-4 py-2 rounded-xl text-sm font-bold transition-all shadow-lg flex items-center gap-2 hover:bg-slate-800 active:scale-95",children:[e.jsx(Y,{size:16})," Nova Propriedade"]})]})}),i&&e.jsx(re,{onClose:()=>j(!1),onSuccess:N}),e.jsx(O,{isLoading:m,error:v,isEmpty:!t,children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx(w,{label:"Receita Bruta (30d)",value:B(t?.totals?.grossRevenue),icon:T,variant:"default"}),e.jsx(w,{label:"Unidades Ativas",value:t?.totals?.activeUnits?.toString()||"0",icon:P,variant:"default"}),e.jsx(w,{label:"Lucro Operacional",value:B(t?.totals?.netRevenue),icon:L,variant:"success"}),e.jsx(w,{label:"Booking Volume",value:t?.totals?.staysCount?.toString()||"0",icon:K,variant:"default"})]})}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsxs("h3",{className:"text-lg font-bold text-slate-800 flex items-center gap-2",children:["Edifícios & Ativos",e.jsx(C,{variant:"neutral",children:u.length})]}),e.jsxs("div",{className:"relative w-full md:w-80",children:[e.jsx(G,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-slate-400"}),e.jsx("input",{type:"text",placeholder:"Buscar edifício...",value:r,onChange:s=>o(s.target.value),className:"w-full bg-white border border-slate-200 rounded-xl pl-10 pr-4 py-2 text-sm focus:ring-2 focus:ring-blue-500/20 transition-all outline-none"})]})]}),e.jsxs("div",{className:"space-y-4",children:[R.map(s=>e.jsxs("div",{className:"group",children:[e.jsxs("button",{onClick:()=>I(s.id),className:"w-full flex items-center justify-between p-4 bg-white border border-slate-200 rounded-2xl hover:border-blue-300 transition-all shadow-sm group-hover:shadow-md",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-blue-50 flex items-center justify-center text-blue-600",children:e.jsx(z,{size:24})}),e.jsxs("div",{className:"text-left leading-tight",children:[e.jsx("h4",{className:"font-bold text-slate-900",children:s.name}),e.jsx("p",{className:"text-xs text-slate-500",children:s.address||"Sem endereço cadastrado"})]})]}),e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("div",{className:"hidden md:block text-right",children:[e.jsx("p",{className:"text-[10px] uppercase font-bold text-slate-400 tracking-widest",children:"Unidades"}),e.jsx("p",{className:"font-bold text-slate-700",children:y[s.id]?.length||0})]}),d[s.id]?e.jsx(M,{className:"text-slate-400"}):e.jsx(E,{className:"text-slate-400"})]})]}),d[s.id]&&e.jsx("div",{className:"mt-2 ml-6 pl-6 border-l-2 border-slate-100 space-y-2 animate-in slide-in-from-top-2 duration-300",children:y[s.id]?.map(n=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-slate-50/50 rounded-xl border border-slate-100/50 hover:bg-slate-50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(C,{variant:n.active?"success":"neutral",children:n.code}),e.jsx("span",{className:"text-sm font-medium text-slate-700",children:n.name||"Sem nome"})]}),e.jsx("button",{className:"text-xs font-bold text-blue-600 hover:text-blue-700",children:"DETALHES"})]},n.id))||e.jsx("p",{className:"text-xs text-slate-400 italic",children:"Nenhuma unidade vinculada."})})]},s.id)),e.jsxs("div",{className:"group",children:[e.jsxs("button",{onClick:()=>I("avulsas"),className:"w-full flex items-center justify-between p-4 bg-slate-50 border border-dashed border-slate-300 rounded-2xl hover:border-slate-400 transition-all shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-slate-200 flex items-center justify-center text-slate-500",children:e.jsx(P,{size:24})}),e.jsxs("div",{className:"text-left leading-tight",children:[e.jsx("h4",{className:"font-bold text-slate-700 tracking-tight",children:"Propriedades Avulsas"}),e.jsx("p",{className:"text-xs text-slate-500 italic",children:"Unidades sem edifício vinculado"})]})]}),e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("div",{className:"hidden md:block text-right",children:[e.jsx("p",{className:"text-[10px] uppercase font-bold text-slate-400 tracking-widest",children:"Contagem"}),e.jsx("p",{className:"font-bold text-slate-600",children:y.avulsas?.length||0})]}),d.avulsas?e.jsx(M,{className:"text-slate-400"}):e.jsx(E,{className:"text-slate-400"})]})]}),d.avulsas&&e.jsx("div",{className:"mt-2 ml-6 pl-6 border-l-2 border-slate-100 space-y-2 animate-in slide-in-from-top-2 duration-300",children:y.avulsas?.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-white rounded-xl border border-slate-100 hover:shadow-sm transition-all",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(C,{variant:s.active?"success":"neutral",children:s.code}),e.jsx("span",{className:"text-sm font-medium text-slate-700",children:s.name||"Sem nome"})]}),e.jsx("button",{className:"text-xs font-bold text-blue-600 hover:text-blue-700",children:"DETALHES"})]},s.id))})]})]})]}),t?.potentialCharges&&e.jsx(H,{className:"p-6 border-slate-200 shadow-xl shadow-slate-200/40",children:e.jsxs("div",{className:"flex flex-col md:flex-row items-center justify-between gap-6",children:[e.jsxs("div",{className:"space-y-1 text-center md:text-left",children:[e.jsxs("h3",{className:"text-lg font-bold text-slate-900 tracking-tight flex items-center gap-2 justify-center md:justify-start",children:[e.jsx(L,{className:"text-emerald-500",size:20}),"Billing Preview"]}),e.jsxs("p",{className:"text-sm text-slate-500 max-w-lg",children:["Estimativa mensal baseada na volumetria atual do seu portfólio (",t.totals.activeOwners," proprietários e ",t.totals.activeUnits," unidades)."]})]}),e.jsxs("div",{className:"flex items-center gap-8 bg-white p-3 rounded-2xl border border-slate-100 shadow-sm",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-[10px] uppercase font-bold text-slate-400 tracking-widest",children:"Base Mensal"}),e.jsx("p",{className:"text-xl font-black text-slate-900 tracking-tighter",children:B(t.potentialCharges.total)})]}),e.jsx(E,{size:20,className:"text-slate-200"}),e.jsx("button",{className:"px-5 py-2.5 bg-blue-600 text-white rounded-xl font-bold text-sm shadow-lg shadow-blue-500/20 hover:bg-blue-700 active:scale-95 transition-all",children:"Upgrade Pro"})]})]})})]})}export{be as default};
