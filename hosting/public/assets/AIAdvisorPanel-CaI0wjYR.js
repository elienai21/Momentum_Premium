import{d as w,r as c,h as j,e as y,i as T,k as N,j as e,a as A}from"./index-tXm_M6ea.js";async function S(n){return(await A.post("/advisor/session",{messages:[{role:"user",content:n}]})).data}const E=()=>{const{user:n,loading:i}=w(),[m,l]=c.useState([{role:"assistant",text:"Ol�! Sou seu consultor financeiro com IA. Como posso ajudar hoje?"}]),[t,x]=c.useState(!1),r=c.useRef(null),{features:h,voiceProfiles:b}=j(),v=y(),{speak:f}=T(),d=h??{voiceTier:"none",voiceTTS:!1,voiceSTT:!1},g=b??[],u=N(d.voiceTier,g,"advisor");if(i)return e.jsx("div",{className:"p-4 text-xs text-slate-400",children:"Conectando ao Advisor..."});if(!n||!v)return null;async function p(){const a=(r.current?.value||"").trim();if(!(!a||t)){r.current&&(r.current.value=""),l(s=>[...s,{role:"user",text:a},{role:"assistant",text:"Pensando�"}]),x(!0);try{const o=(await S(a)).reply?.answer||"Sem resposta no momento. Tente reformular sua pergunta.";l(k=>k.slice(0,-1).concat({role:"assistant",text:o})),d.voiceTTS&&await f({text:o,voice:u,profile:"aconselhamento"})}catch(s){console.error("Erro no advisorSend:",s),l(o=>o.slice(0,-1).concat({role:"assistant",text:"Erro ao processar resposta. Tente novamente em instantes."}))}finally{x(!1)}}}return e.jsxs("aside",{className:["rounded-3xl p-4 md:p-5 flex flex-col gap-3 shadow-xl","border border-slate-200 bg-white/95 text-slate-900","dark:border-white/8 dark:bg-[radial-gradient(circle_at_top,_rgba(15,23,42,0.92),_rgba(3,7,18,0.98))] dark:text-[var(--text-1)] dark:backdrop-blur-xl",i?"opacity-60 pointer-events-none":""].filter(Boolean).join(" "),children:[e.jsxs("header",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-semibold tracking-wide text-[var(--brand-1)]/90 uppercase",children:"Momentum AI Advisor"}),e.jsx("div",{className:"text-sm text-slate-600 dark:text-white/80",children:"Fa�a perguntas em linguagem natural sobre seu neg�cio."})]}),e.jsxs("div",{className:"flex flex-col items-end text-[10px] text-slate-500 dark:text-white/60",children:[e.jsxs("span",{children:["Voz:"," ",d.voiceTTS?u:"desativada"]}),t&&e.jsx("span",{className:"animate-pulse",children:"Pensando�"})]})]}),e.jsxs("div",{className:"text-[11px] text-slate-600 dark:text-white/70 flex items-center gap-2",children:[e.jsx("span",{className:`h-2 w-2 rounded-full ${t?"bg-[var(--brand-2)] animate-ping":"bg-emerald-500"}`}),t?"Analisando seus dados e hist�rico financeiro�":"Pronto para responder perguntas sobre caixa, margem, cen�rios e riscos."]}),e.jsx("div",{className:"flex-1 overflow-y-auto space-y-2 pr-1 text-sm scrollbar-thin scrollbar-thumb-[var(--brand-1)]/40","aria-live":"polite",children:m.map((a,s)=>e.jsxs("div",{className:["rounded-xl border px-3 py-2 backdrop-blur-sm text-sm",a.role==="user"?"border-emerald-100 bg-emerald-50 text-slate-900 dark:border-cyan-400/20 dark:bg-cyan-400/5 dark:text-[var(--text-1)]":"border-slate-200 bg-slate-50 text-slate-900 dark:border-white/8 dark:bg-white/5 dark:text-[var(--text-1)]"].join(" "),children:[e.jsx("span",{className:"opacity-70 mr-1",children:(a.role==="user","??")}),e.jsx("span",{className:"align-middle",dangerouslySetInnerHTML:{__html:a.text.replace(/\//g,"<br/>")}})]},s))}),e.jsxs("div",{className:"flex gap-2 mt-1",children:[e.jsx("textarea",{ref:r,placeholder:"Digite sua pergunta para o Advisor�",className:"flex-1 rounded-xl border border-slate-300 bg-white p-2 min-h-[44px] max-h-[120px] text-sm text-slate-900 placeholder:text-slate-400 resize-none focus:outline-none focus:ring-2 focus:ring-[var(--brand-1)]/40 dark:border-white/10 dark:bg-black/20 dark:text-white dark:placeholder:text-white/40",onKeyDown:a=>{a.key==="Enter"&&!a.shiftKey&&(a.preventDefault(),p())}}),e.jsx("button",{onClick:p,disabled:t,className:["rounded-xl px-3 py-2 text-sm font-medium transition-all","border border-slate-900/10 bg-slate-900 text-white hover:bg-black hover:-translate-y-px hover:shadow-lg","disabled:opacity-50 disabled:cursor-not-allowed","dark:border-white/10 dark:bg-white/10 dark:text-white dark:hover:bg-white/15"].join(" "),children:t?"�":"Enviar"})]})]})};export{E as A};
