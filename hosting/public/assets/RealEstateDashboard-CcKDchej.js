import{m as T,r as x,j as e,L as I,n as A,o as O,q as V,p as k,s as B}from"./index-tXm_M6ea.js";const D="realEstate_statements";function _(t){if(!t)return"Mês não definido";const[l,j]=t.split("-"),r=Number(j),m=["","Jan","Fev","Mar","Abr","Mai","Jun","Jul","Ago","Set","Out","Nov","Dez"];return!isNaN(r)&&r>=1&&r<=12?`${m[r]}/${l}`:t}function d(t){return t?t.toLocaleString("pt-BR",{style:"currency",currency:"BRL",minimumFractionDigits:2}):"R$ 0,00"}function H(){const{tenantId:t}=T(),[l,j]=x.useState([]),[r,m]=x.useState(!0),[p,v]=x.useState(null);x.useEffect(()=>{let s=!0;async function i(){m(!0),v(null);try{if(!t)throw new Error("tenantId ausente");const n=A(O,"tenants",t,D),h=V(n,k("month","desc")),b=await B(h);if(!s)return;const N=[];b.docs.forEach(a=>{const o=a.data()||{},f=String(o.month??a.id),g=o.ownerId?String(o.ownerId):void 0,y=typeof o.ownerShareRate=="number"?Number(o.ownerShareRate):1;(Array.isArray(o.units)?o.units:[]).forEach((c,F)=>{const R=Number(c.grossRevenue??0),E=Number(c.cleaningFees??0),C=Number(c.platformFees??0),S=Number(c.otherCosts??0),M=typeof c.netRevenue=="number"?Number(c.netRevenue):R-(E+C+S),P=M*y,L=M-P;N.push({id:`${a.id}:${F}`,month:f,unitCode:c.unitCode,ownerName:g,ownerId:g,grossRevenue:R,cleaningFees:E,platformFees:C,otherCosts:S,ownerPayout:P,realEstatePayouts:L})})}),j(N)}catch(n){console.error("[RealEstate] erro ao carregar dados:",n),v(n?.message||"Não foi possível carregar os dados de Real Estate.")}finally{if(!s)return;m(!1)}}return i(),()=>{s=!1}},[t]);const u=x.useMemo(()=>{if(!l.length)return{totalGross:0,totalOwner:0,totalHouse:0,totalCosts:0,avgMargin:0};let s=0,i=0,n=0,h=0;for(const a of l){const o=a.grossRevenue??0,f=a.ownerPayout??0,g=a.realEstatePayouts??0,y=(a.cleaningFees??0)+(a.platformFees??0)+(a.otherCosts??0);s+=o,i+=f,n+=g,h+=y}const b=n,N=s>0?b/s:0;return{totalGross:s,totalOwner:i,totalHouse:n,totalCosts:h,avgMargin:N}},[l]),w=l.length>0;return e.jsxs("div",{className:"flex flex-col gap-6 p-4 md:p-6",children:[e.jsx("header",{className:"flex flex-col gap-2 md:flex-row md:items-center md:justify-between",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg md:text-xl font-semibold text-slate-50",children:"Real Estate · Performance por Imóvel"}),e.jsx("p",{className:"text-xs md:text-sm text-slate-400 max-w-xl",children:"Visão consolidada dos repasses aos proprietários, receita bruta e payout da Vivare por unidade e por mês."})]})}),r&&e.jsx("div",{className:"flex h-40 items-center justify-center rounded-2xl border border-slate-800 bg-slate-950/40",children:e.jsxs("div",{className:"flex flex-col items-center gap-2 text-slate-300",children:[e.jsx(I,{className:"h-5 w-5 animate-spin text-emerald-400"}),e.jsx("span",{className:"text-xs",children:"Carregando dados de Real Estate..."})]})}),p&&!r&&e.jsx("div",{className:"rounded-2xl border border-rose-500/40 bg-rose-950/30 p-4 text-sm text-rose-100",children:p}),!r&&!p&&!w&&e.jsxs("div",{className:"rounded-2xl border border-slate-800 bg-slate-950/40 p-6 text-sm text-slate-200",children:[e.jsx("p",{className:"font-medium mb-1",children:"Nenhum dado de Real Estate encontrado."}),e.jsxs("p",{className:"text-xs text-slate-400 max-w-xl",children:["Cadastre documentos na coleção"," ",e.jsxs("code",{className:"rounded bg-slate-900 px-1.5 py-0.5 text-[10px]",children:["tenants/",t,"/realEstate_statements"]})," ","para começar a acompanhar o desempenho dos imóveis."]})]}),w&&!r&&!p&&e.jsxs(e.Fragment,{children:[e.jsxs("section",{className:"grid grid-cols-1 gap-4 md:grid-cols-4",children:[e.jsxs("div",{className:"rounded-2xl border border-slate-800 bg-slate-950/60 p-4",children:[e.jsx("p",{className:"text-[11px] font-medium text-slate-400 uppercase tracking-[0.16em]",children:"Receita Bruta"}),e.jsx("p",{className:"mt-2 text-lg font-semibold text-slate-50",children:d(u.totalGross)}),e.jsx("p",{className:"mt-1 text-[11px] text-slate-500",children:"Soma de todos os meses carregados."})]}),e.jsxs("div",{className:"rounded-2xl border border-slate-800 bg-slate-950/60 p-4",children:[e.jsx("p",{className:"text-[11px] font-medium text-slate-400 uppercase tracking-[0.16em]",children:"Repasses para Proprietários"}),e.jsx("p",{className:"mt-2 text-lg font-semibold text-slate-50",children:d(u.totalOwner)}),e.jsx("p",{className:"mt-1 text-[11px] text-slate-500",children:"Total pago aos donos dos imóveis."})]}),e.jsxs("div",{className:"rounded-2xl border border-slate-800 bg-slate-950/60 p-4",children:[e.jsx("p",{className:"text-[11px] font-medium text-slate-400 uppercase tracking-[0.16em]",children:"Payout Vivare"}),e.jsx("p",{className:"mt-2 text-lg font-semibold text-emerald-400",children:d(u.totalHouse)}),e.jsx("p",{className:"mt-1 text-[11px] text-slate-500",children:"Receita líquida da operação de hospedagem."})]}),e.jsxs("div",{className:"rounded-2xl border border-slate-800 bg-slate-950/60 p-4",children:[e.jsx("p",{className:"text-[11px] font-medium text-slate-400 uppercase tracking-[0.16em]",children:"Margem Média Vivare"}),e.jsxs("p",{className:"mt-2 text-lg font-semibold text-slate-50",children:[(u.avgMargin*100).toFixed(1),"%"]}),e.jsx("p",{className:"mt-1 text-[11px] text-slate-500",children:"Payout Vivare ÷ Receita Bruta."})]})]}),e.jsxs("section",{className:"rounded-2xl border border-slate-800 bg-slate-950/60 p-4",children:[e.jsxs("div",{className:"mb-3 flex items-center justify-between gap-2",children:[e.jsx("h2",{className:"text-sm font-semibold text-slate-50",children:"Meses consolidados"}),e.jsxs("p",{className:"text-[11px] text-slate-500",children:[l.length," registro(s) carregado(s)"]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-left text-xs text-slate-300",children:[e.jsx("thead",{className:"border-b border-slate-800/80 text-[11px] uppercase tracking-[0.16em] text-slate-500",children:e.jsxs("tr",{children:[e.jsx("th",{className:"py-2 pr-4",children:"Mês"}),e.jsx("th",{className:"py-2 px-4",children:"Unidade"}),e.jsx("th",{className:"py-2 px-4",children:"Proprietário"}),e.jsx("th",{className:"py-2 px-4",children:"Receita bruta"}),e.jsx("th",{className:"py-2 px-4",children:"Taxas / custos"}),e.jsx("th",{className:"py-2 px-4",children:"Repasse proprietário"}),e.jsx("th",{className:"py-2 px-4",children:"Payout Vivare"})]})}),e.jsx("tbody",{children:l.map(s=>{const i=(s.cleaningFees??0)+(s.platformFees??0)+(s.otherCosts??0);return e.jsxs("tr",{className:"border-b border-slate-900/60 last:border-0",children:[e.jsx("td",{className:"py-2 pr-4 text-slate-100 whitespace-nowrap",children:_(s.month)}),e.jsx("td",{className:"py-2 px-4 whitespace-nowrap",children:s.unitCode||"-"}),e.jsx("td",{className:"py-2 px-4 whitespace-nowrap",children:s.ownerName||"-"}),e.jsx("td",{className:"py-2 px-4",children:d(s.grossRevenue)}),e.jsx("td",{className:"py-2 px-4",children:d(i)}),e.jsx("td",{className:"py-2 px-4",children:d(s.ownerPayout)}),e.jsx("td",{className:"py-2 px-4 text-emerald-300",children:d(s.realEstatePayouts)})]},s.id)})})]})})]})]})]})}export{H as default};
