import{c as Z,r as i,d as ee,a as te,j as e,h as se,T as O,G as v,S as ae,I as ne,b as U}from"./index-BTNo5FuH.js";import{A as re}from"./AIAdvisorPanel-BRsdCRan.js";import{C as M,L as oe,P as ie,a as ce,b as le,c as de,A as me,p as ue,d as pe,e as he,D as ge,i as fe}from"./chart-BJ99D5hM.js";import{S as be}from"./SectionHeader-DnszYlyI.js";import{S as L}from"./StatsCard-DiJlIrpb.js";import{A as xe}from"./AsyncPanel-Cf5Mn7yC.js";import{R as ye}from"./refresh-cw-Bn7CzMyt.js";import{W as je}from"./wallet-DHicTw3g.js";import{T as ve}from"./trending-down-BBkVauuA.js";import{C as Ce}from"./chart-line-5U7TVW1J.js";import"./send-BRIr9Mhu.js";import"./user-B8BGejm7.js";import"./rotate-ccw-C1koxpwt.js";const Se=[["path",{d:"M21 12c.552 0 1.005-.449.95-.998a10 10 0 0 0-8.953-8.951c-.55-.055-.998.398-.998.95v8a1 1 0 0 0 1 1z",key:"pzmjnu"}],["path",{d:"M21.21 15.89A10 10 0 1 1 8 2.83",key:"k2fpak"}]],ke=Z("chart-pie",Se);function Ne(){const[P,p]=i.useState(()=>typeof document<"u"&&(document.body.classList.contains("dark")||document.body.getAttribute("data-theme")==="dark")?"dark":"light");return i.useEffect(()=>{const C=new MutationObserver(()=>{const h=document.body.classList.contains("dark")||document.body.getAttribute("data-theme")==="dark";p(h?"dark":"light")});return C.observe(document.body,{attributes:!0,attributeFilter:["class","data-theme"]}),()=>C.disconnect()},[]),P}M.register(oe,ie,ce,le,de,me,ue,pe,he,ge,fe);const Fe=()=>{const p=Ne()==="dark";ee();const{notify:C}=te(),[h,H]=i.useState({balance:0,income:0,expense:0}),[Re,J]=i.useState({categories:[],cards:[]}),[I,K]=i.useState([]),[y,z]=i.useState(!0),[q,B]=i.useState(!1),E=i.useRef(null),D=i.useRef(null),T=i.useRef(null),V=i.useRef(null),b=getComputedStyle(document.documentElement),d=[b.getPropertyValue("--chart-1").trim()||"#10b981",b.getPropertyValue("--chart-2").trim()||"#f43f5e",b.getPropertyValue("--chart-3").trim()||"#8b5cf6",b.getPropertyValue("--chart-4").trim()||"#f59e0b",b.getPropertyValue("--chart-5").trim()||"#3b82f6"],j=p?"#94a3b8":"#64748b";function W(s,r,m=3){const t=s.filter(n=>n!==null&&n>0),a=t.length;let l,o;if(a<3)l=.4,o=.02;else if(a<6){l=.25;const n=t.slice(-3).reduce((u,f)=>u+f,0)/3,c=t.slice(0,Math.min(3,t.length)).reduce((u,f)=>u+f,0)/Math.min(3,t.length);o=c>0?(n-c)/c/a:.02}else{l=.15;const n=[.1,.15,.2,.25,.3],c=t.slice(-5);let u=0,f=0;c.forEach((w,A)=>{const G=n[A]||.3;u+=w*G,f+=G});const Y=u/f,R=t.slice(-6,-3).reduce((w,A)=>w+A,0)/3;o=R>0?(Y-R)/R/3:.01}o=Math.max(-.15,Math.min(.15,o));const g=t.length>0?t.slice(-3).reduce((n,c)=>n+c,0)/Math.min(3,t.length):5e3,x=[...s.map(()=>null)],k=[...s.map(()=>null)],N=[...s.map(()=>null)],$=[...r];if(t.length>0){const n=s.length-1;x[n]=t[t.length-1],k[n]=t[t.length-1],N[n]=t[t.length-1]}const _=["Jan","Fev","Mar","Abr","Mai","Jun","Jul","Ago","Set","Out","Nov","Dez"],X=r.length>0?_.indexOf(r[r.length-1]?.substring(0,3)):new Date().getMonth();for(let n=1;n<=m;n++){const c=g*Math.pow(1+o,n),u=c*l*(1+n*.1);x.push(Math.round(c)),k.push(Math.round(c+u)),N.push(Math.round(Math.max(0,c-u)));const f=(X+n)%12;$.push(`${_[f]} (Proj)`)}return{forecastValues:x,upper:k,lower:N,extendedMonths:$}}async function S(){z(!0);try{const r=(await U.get("/portal/forecast")).data,m=r?.kpis||{balance:0,income:0,expense:0};H(m),J(r?.meta||{categories:[],cards:[]});const t=r?.charts||{months:[],incomeSeries:[],expenseSeries:[],forecastIncome:[],forecastExpense:[],confidenceUpper:[],confidenceLower:[],categories:[]};let a;if(!t.forecastIncome||t.forecastIncome.length===0){const g=W(t.incomeSeries,t.months,3),x=W(t.expenseSeries,t.months,3);a={...t,months:g.extendedMonths,incomeSeries:[...t.incomeSeries,...Array(3).fill(null)],expenseSeries:[...t.expenseSeries,...Array(3).fill(null)],forecastIncome:g.forecastValues,forecastExpense:x.forecastValues,confidenceUpper:g.upper,confidenceLower:g.lower}}else a=t;Q(a);const l=(m.balance||0)!==0||(m.income||0)!==0||(m.expense||0)!==0,o=(a.months?.length||0)>0||(a.categories?.length||0)>0;B(l||o)}catch(s){console.error("Analytics Load Error:",s),B(!1)}finally{z(!1)}}async function F(){try{const{data:s}=await U.get("/portal/insights/cache").catch(()=>({data:[]}));K(Array.isArray(s)?s:[])}catch{}}function Q(s){const r=E.current?.getContext("2d"),m=D.current?.getContext("2d");if(!r||!m)return;T.current?.destroy(),V.current?.destroy();const t=r.createLinearGradient(0,0,0,280);t.addColorStop(0,p?"rgba(139, 92, 246, 0.15)":"rgba(139, 92, 246, 0.1)"),t.addColorStop(1,"rgba(139, 92, 246, 0)"),T.current=new M(r,{type:"line",data:{labels:s.months,datasets:[{label:"Limite Superior",data:s.confidenceUpper,borderColor:"transparent",backgroundColor:t,fill:"+1",pointRadius:0,tension:.4,order:3},{label:"Limite Inferior",data:s.confidenceLower,borderColor:"transparent",backgroundColor:"transparent",fill:!1,pointRadius:0,tension:.4,order:4},{label:"Receitas",data:s.incomeSeries,borderColor:d[0],backgroundColor:p?"rgba(16, 185, 129, 0.1)":"rgba(16, 185, 129, 0.05)",borderWidth:2.5,tension:.4,fill:!0,pointRadius:4,pointBackgroundColor:d[0],order:1},{label:"Despesas",data:s.expenseSeries,borderColor:d[1],backgroundColor:"transparent",borderWidth:2.5,tension:.4,pointRadius:4,pointBackgroundColor:d[1],order:2},{label:"Receitas (Proj)",data:s.forecastIncome,borderColor:d[0],backgroundColor:"transparent",borderWidth:2,borderDash:[6,4],tension:.4,pointRadius:3,pointStyle:"circle",pointBackgroundColor:p?"#1e293b":"#ffffff",pointBorderColor:d[0],pointBorderWidth:2,order:1},{label:"Despesas (Proj)",data:s.forecastExpense,borderColor:d[1],backgroundColor:"transparent",borderWidth:2,borderDash:[6,4],tension:.4,pointRadius:3,pointStyle:"circle",pointBackgroundColor:p?"#1e293b":"#ffffff",pointBorderColor:d[1],pointBorderWidth:2,order:2}]},options:{responsive:!0,maintainAspectRatio:!1,interaction:{mode:"index",intersect:!1},plugins:{legend:{display:!0,position:"top",align:"end",labels:{color:j,boxWidth:12,usePointStyle:!0,font:{size:10,weight:"bold"},filter:a=>!a.text?.includes("Limite")}},tooltip:{backgroundColor:"rgba(15, 23, 42, 0.95)",padding:14,cornerRadius:10,titleFont:{size:12,weight:"bold"},bodyFont:{size:11},callbacks:{label:a=>{const l=a.raw;if(l===null)return"";const o=l.toLocaleString("pt-BR",{style:"currency",currency:"BRL"}),g=a.dataset.label?.includes("Proj");return`${a.dataset.label}: ${o}${g?" ‚ö°":""}`}}}},scales:{y:{grid:{color:p?"rgba(226, 232, 240, 0.05)":"rgba(0, 0, 0, 0.05)"},ticks:{color:j,font:{size:10},callback:a=>`R$ ${(Number(a)/1e3).toFixed(0)}k`}},x:{grid:{display:!1},ticks:{color:j,font:{size:10,weight:"bold"},callback:function(a,l){const o=s.months[l];return o?.includes("(Proj)")?`üìà ${o.replace(" (Proj)","")}`:o}}}}}}),V.current=new M(m,{type:"doughnut",data:{labels:s.categories.map(a=>a.category),datasets:[{data:s.categories.map(a=>a.amount),backgroundColor:d,borderColor:"transparent",hoverOffset:4}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"bottom",labels:{color:j,usePointStyle:!0,pointStyle:"circle",font:{size:10}}}},cutout:"70%"}})}return i.useEffect(()=>{S()},[]),i.useEffect(()=>{y||F()},[y]),e.jsxs("div",{className:"space-y-8 pb-20 fade-in",children:[e.jsx(be,{title:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(O,{size:24,className:"text-momentum-accent"}),e.jsx("span",{children:"Analytics Financeiro"})]}),subtitle:"Vis√£o estrat√©gica de fluxos, categorias e sa√∫de do neg√≥cio.",actions:e.jsxs("button",{onClick:S,className:"flex items-center gap-2 px-3 py-1.5 rounded-lg border border-momentum-border hover:bg-white transition-all text-xs font-bold text-momentum-muted hover:text-momentum-text",children:[e.jsx(ye,{size:14,className:se(y&&"animate-spin")}),"Sincronizar"]})}),e.jsxs("div",{className:"grid gap-8 md:grid-cols-[1fr_360px]",children:[e.jsx("div",{className:"space-y-8",children:e.jsx(xe,{isLoading:y,isEmpty:!q,emptyTitle:"Sem Dados",emptyDescription:"Conecte suas finan√ßas para gerar insights.",onRetry:S,children:e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-6 font-bold",children:[e.jsx(L,{label:"Saldo Projetado",value:h.balance.toLocaleString("pt-BR",{style:"currency",currency:"BRL"}),icon:je,trend:h.balanceTrend?{value:h.balanceTrend,direction:h.balanceTrend.includes("+")?"up":"down"}:void 0}),e.jsx(L,{label:"Receita Mensal",value:h.income.toLocaleString("pt-BR",{style:"currency",currency:"BRL"}),variant:"success",icon:O}),e.jsx(L,{label:"Despesa Mensal",value:h.expense.toLocaleString("pt-BR",{style:"currency",currency:"BRL"}),variant:"danger",icon:ve})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-8",children:[e.jsxs(v,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-6",children:[e.jsx(Ce,{size:18,className:"text-momentum-accent"}),e.jsx("h3",{className:"text-sm font-bold text-momentum-text uppercase tracking-widest",children:"Tend√™ncia (6 Meses)"})]}),e.jsx("div",{className:"h-[280px]",children:e.jsx("canvas",{ref:E})})]}),e.jsxs(v,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-6",children:[e.jsx(ke,{size:18,className:"text-momentum-accent"}),e.jsx("h3",{className:"text-sm font-bold text-momentum-text uppercase tracking-widest",children:"Categorias"})]}),e.jsx("div",{className:"h-[280px]",children:e.jsx("canvas",{ref:D})})]})]}),e.jsxs(v,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ae,{size:18,className:"text-momentum-accent"}),e.jsx("h3",{className:"text-sm font-bold text-momentum-text uppercase tracking-widest",children:"Insights Estrat√©gicos"})]}),e.jsx("button",{onClick:F,className:"text-[10px] font-bold text-momentum-accent uppercase hover:underline",children:"Atualizar IA"})]}),e.jsx("div",{className:"grid gap-4 sm:grid-cols-2",children:I.length?I.map((s,r)=>e.jsx(ne,{title:"An√°lise Relevante",description:s,severity:"info"},r)):e.jsx("div",{className:"col-span-full py-8 text-center text-sm text-momentum-muted italic border-2 border-dashed border-momentum-border rounded-2xl",children:"Nenhum insight dispon√≠vel no momento."})})]})]})})}),e.jsx("div",{className:"hidden md:block",children:e.jsx(v,{className:"p-0 overflow-hidden sticky top-8 border-none shadow-2xl",children:e.jsx(re,{})})})]})]})};export{Fe as AnalyticsDashboard,Fe as default};
