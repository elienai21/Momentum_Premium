import{r as s,j as e,h as u,R as W,G as b,T as P,B as J}from"./index-sZ5pzLG8.js";import{C as D,b as X,c as Y,P as Z,L as ee,g as te,p as ae,d as se}from"./chart-BJ99D5hM.js";import{C as I}from"./CfoApi-_2ZsdfZM.js";import{U as ne}from"./UpgradeRequiredModal-pL8jNcdH.js";import{S as re}from"./SectionHeader-Dy6jrYS0.js";import{S as g}from"./StatsCard-BNiXgSc7.js";import{A as oe}from"./AsyncPanel-NQt8qWDx.js";import{R as h}from"./refresh-cw-BejIcNON.js";import{T as M}from"./triangle-alert-CK_v1SL5.js";import"./rotate-ccw-3VMdqQvO.js";D.register(X,Y,Z,ee,te,ae,se);const F=o=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(o);function he(){const[o,f]=s.useState("simple"),[l,m]=s.useState(!1),[j,n]=s.useState(null),p=s.useRef(null),x=s.useRef(null),[c,L]=s.useState(0),[i,T]=s.useState(0),[v,O]=s.useState(0),[w,B]=s.useState(0),[y,U]=s.useState(0),[N,_]=s.useState(0),[a,k]=s.useState(null),[G,C]=s.useState(!1),[R,z]=s.useState(null);function E(t,d){const S=t?.status,r=t?.message||"";if(S===403&&r.startsWith("UPGRADE_REQUIRED")){const A=r.split(":"),K=A[1]||(d==="advanced"?"cfo_simulator_advanced":"cfo_simulator"),Q=A[2];z({feature:K,plan:Q}),C(!0),n(d==="advanced"?"Cenário premium.":"Recurso premium.");return}n(r||"Erro na simulação.")}const $=async()=>{m(!0),n(null);try{const t=await I.simulate({incDeltaPct:c,expDeltaPct:i,oneOffExpense:v}),d=t.monthlyProjection||Array.from({length:6}).map((S,r)=>({month:r+1,balance:t.result.net*(r+1)}));k({ok:!0,baseline:{avgIncome:t.base.income,avgExpense:t.base.expense,runwayMonths:0},projected:{avgIncome:t.result.newIncome,avgExpense:t.result.newExpense,runwayMonths:0,netCashFlow:t.result.net},deltas:{runwayImpact:0,cashImpact:t.result.net-(t.base.income-t.base.expense)},monthlyProjection:d})}catch(t){E(t,"simple")}finally{m(!1)}},q=async()=>{m(!0),n(null);try{const t=await I.simulateAdvanced({recurringExpensesDelta:w,growthRateIncome:y/100,oneTimeExpense:N});k(t)}catch(t){E(t,"advanced")}finally{m(!1)}};s.useEffect(()=>{if(!p.current||!a)return;x.current?.destroy();const t=p.current.getContext("2d");if(t)return x.current=new D(t,{type:"line",data:V,options:H}),()=>x.current?.destroy()},[a]);const V={labels:["Mês 1","Mês 2","Mês 3","Mês 4","Mês 5","Mês 6"],datasets:[{label:"Saldo Projetado",data:a?.monthlyProjection?.map(t=>t.balance)||[],borderColor:"rgb(16, 185, 129)",backgroundColor:"rgba(16, 185, 129, 0.1)",fill:!0,tension:.4}]},H={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{mode:"index",intersect:!1,backgroundColor:"rgba(15, 23, 42, 0.9)",titleFont:{size:12},bodyFont:{size:12},padding:12,cornerRadius:8}},scales:{y:{grid:{color:"rgba(226, 232, 240, 0.1)"},ticks:{color:"#94a3b8",font:{size:10}}},x:{grid:{display:!1},ticks:{color:"#94a3b8",font:{size:10}}}}};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-8 pb-20 fade-in",children:[e.jsx(re,{title:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(W,{className:"w-5 h-5 text-momentum-accent"}),e.jsx("span",{children:"Simulador CFO"})]}),subtitle:"Projete cenários e analise o impacto no runway e fluxo de caixa.",actions:e.jsxs("div",{className:"flex bg-white/50 dark:bg-slate-900/50 p-1 rounded-xl border border-momentum-border backdrop-blur-sm",children:[e.jsx("button",{onClick:()=>{f("simple"),n(null)},className:u("px-4 py-1.5 text-xs font-bold uppercase tracking-wider rounded-lg transition-all",o==="simple"?"bg-momentum-accent text-white shadow-sm":"text-momentum-muted hover:text-momentum-text"),children:"Rápido"}),e.jsx("button",{onClick:()=>{f("advanced"),n(null)},className:u("px-4 py-1.5 text-xs font-bold uppercase tracking-wider rounded-lg transition-all",o==="advanced"?"bg-momentum-accent text-white shadow-sm":"text-momentum-muted hover:text-momentum-text"),children:"Avançado"})]})}),e.jsxs("div",{className:"grid lg:grid-cols-3 gap-8",children:[e.jsx("div",{className:"lg:col-span-1 space-y-6",children:e.jsxs(b,{className:"p-6",children:[e.jsx("h3",{className:"text-sm font-bold text-momentum-text uppercase tracking-widest mb-6",children:"Parâmetros do Cenário"}),o==="simple"?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("label",{className:"text-[10px] font-bold text-momentum-muted uppercase tracking-wider",children:"Variação Receita"}),e.jsxs("span",{className:u("text-xs font-bold",c>=0?"text-momentum-success":"text-momentum-danger"),children:[c>0?"+":"",c,"%"]})]}),e.jsx("input",{type:"range",min:"-50",max:"50",step:"5",value:c,onChange:t=>L(Number(t.target.value)),className:"w-full h-2 bg-slate-200 dark:bg-slate-700 rounded-lg appearance-none cursor-pointer accent-momentum-accent"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("label",{className:"text-[10px] font-bold text-momentum-muted uppercase tracking-wider",children:"Variação Despesas"}),e.jsxs("span",{className:u("text-xs font-bold",i<=0?"text-momentum-success":"text-momentum-danger"),children:[i>0?"+":"",i,"%"]})]}),e.jsx("input",{type:"range",min:"-50",max:"50",step:"5",value:i,onChange:t=>T(Number(t.target.value)),className:"w-full h-2 bg-slate-200 dark:bg-slate-700 rounded-lg appearance-none cursor-pointer accent-rose-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-bold text-momentum-muted uppercase tracking-wider block mb-2",children:"Gasto Extra (BRL)"}),e.jsx("input",{type:"number",value:v,onChange:t=>O(Number(t.target.value)),className:"w-full bg-slate-50 dark:bg-slate-800/50 border border-momentum-border rounded-xl px-4 py-2.5 text-sm transition-all focus:ring-2 focus:ring-momentum-accent/20",placeholder:"Ex: 5000"})]}),e.jsx("button",{onClick:$,disabled:l,className:"w-full py-3 bg-momentum-accent text-white rounded-xl font-bold text-xs uppercase tracking-widest hover:bg-momentum-accent/90 disabled:opacity-50 transition-all flex justify-center items-center gap-2 shadow-momentum-glow",children:l?e.jsx(h,{className:"animate-spin h-4 w-4"}):"Simular Agora"})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-bold text-momentum-muted uppercase tracking-wider block mb-2",children:"Custo Recorrente (BRL/mês)"}),e.jsx("input",{type:"number",value:w,onChange:t=>B(Number(t.target.value)),className:"w-full bg-slate-50 dark:bg-slate-800/50 border border-momentum-border rounded-xl px-4 py-2.5 text-sm transition-all focus:ring-2 focus:ring-momentum-accent/20",placeholder:"Ex: 2500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-bold text-momentum-muted uppercase tracking-wider block mb-2",children:"Crescimento Receita (% mensal)"}),e.jsx("input",{type:"number",value:y,onChange:t=>U(Number(t.target.value)),className:"w-full bg-slate-50 dark:bg-slate-800/50 border border-momentum-border rounded-xl px-4 py-2.5 text-sm transition-all focus:ring-2 focus:ring-momentum-accent/20",placeholder:"Ex: 10"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-bold text-momentum-muted uppercase tracking-wider block mb-2",children:"Capex/Investimento (BRL)"}),e.jsx("input",{type:"number",value:N,onChange:t=>_(Number(t.target.value)),className:"w-full bg-slate-50 dark:bg-slate-800/50 border border-momentum-border rounded-xl px-4 py-2.5 text-sm transition-all focus:ring-2 focus:ring-momentum-accent/20",placeholder:"Ex: 15000"})]}),e.jsx("button",{onClick:q,disabled:l,className:"w-full py-3 bg-momentum-accent text-white rounded-xl font-bold text-xs uppercase tracking-widest hover:bg-momentum-accent/90 disabled:opacity-50 transition-all flex justify-center items-center gap-2 shadow-momentum-glow",children:l?e.jsx(h,{className:"animate-spin h-4 w-4"}):"Projetar Impacto"})]}),j&&e.jsxs("div",{className:"mt-6 p-4 bg-rose-50 dark:bg-rose-900/20 border border-rose-200 dark:border-rose-500/20 rounded-xl flex items-start gap-3",children:[e.jsx(M,{className:"h-4 w-4 text-rose-500 shrink-0 mt-0.5"}),e.jsx("span",{className:"text-xs text-rose-700 dark:text-rose-300 font-medium",children:j})]})]})}),e.jsx("div",{className:"lg:col-span-2 space-y-8",children:e.jsx(oe,{isLoading:l,isEmpty:!a,emptyTitle:"Pronto para Simular",emptyDescription:"Ajuste os parâmetros ao lado para visualizar o impacto financeiro futuro.",emptyIcon:e.jsx(P,{className:"opacity-40"}),className:"border-none bg-transparent shadow-none",children:a&&e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"grid sm:grid-cols-3 gap-6",children:[e.jsx(g,{label:"Runway Projetado",value:`${a.projected.runwayMonths.toFixed(1)} meses`,icon:P,variant:a.projected.runwayMonths<3?"danger":"success",trend:{value:`${a.deltas.runwayImpact>=0?"+":""}${a.deltas.runwayImpact.toFixed(1)} meses`,direction:a.deltas.runwayImpact>=0?"up":"down"}}),e.jsx(g,{label:"Margem Líquida Proj.",value:F(a.projected.netCashFlow),icon:h,variant:a.projected.netCashFlow>=0?"success":"danger"}),e.jsx(g,{label:"Novo Burn Rate",value:F(a.projected.avgExpense),icon:M})]}),e.jsxs(b,{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h3",{className:"text-sm font-bold text-momentum-text uppercase tracking-widest",children:"Saldo Acumulado (6 Meses)"}),e.jsx(J,{variant:"success",children:"Simulação Ativa"})]}),e.jsx("div",{className:"h-[300px] w-full",children:e.jsx("canvas",{ref:p})})]}),e.jsxs(b,{className:"p-6 border-l-4 border-l-momentum-accent bg-momentum-accent/5",children:[e.jsx("h4",{className:"text-xs font-bold text-momentum-accent uppercase tracking-widest mb-2",children:"Resumo da Análise"}),e.jsxs("p",{className:"text-sm text-momentum-text leading-relaxed",children:["Neste cenário, seu runway seria ajustado de ",e.jsxs("span",{className:"font-bold",children:[a.baseline.runwayMonths," meses"]})," para ",e.jsxs("span",{className:"font-bold",children:[a.projected.runwayMonths.toFixed(1)," meses"]}),".",a.projected.netCashFlow>0?" A operação se tornaria geradora de caixa sustentável.":" Atenção: o fluxo de caixa permaneceria negativo, exigindo monitoramento."]})]})]})})})]})]}),e.jsx(ne,{open:G,onClose:()=>C(!1),feature:R?.feature,plan:R?.plan})]})}export{he as default};
