import{c as _,m as F,r,b as L,a as M,f as U,j as e,G as y,M as H,n as C,o as V,g as J,E as Q,S as W}from"./index-sZ5pzLG8.js";import{u as K,B as X}from"./useTenant-pcgbF3D7.js";import{A as I}from"./AsyncPanel-NQt8qWDx.js";import{S as R,I as Y}from"./InviteMemberModal-Bl0iWxsW.js";import{U as $}from"./user-B-qeH-DS.js";import{P as Z}from"./plus-DanuC4Kd.js";import{C as ee}from"./clock-Cwd2yzjZ.js";import{T as P}from"./trash-2-CrbOPzkl.js";import{C as se}from"./credit-card-BYX3T8Dm.js";import{U as te}from"./users-D1Q4gDPd.js";import{R as ae}from"./refresh-cw-BejIcNON.js";import{H as re}from"./history-TPuEa2CF.js";import"./rotate-ccw-3VMdqQvO.js";const le=[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],ie=_("settings",le);function ne(a=10){const x=F()?.token??null,[g,i]=r.useState([]),[m,c]=r.useState(!1),[b,u]=r.useState(null),o=r.useCallback(async()=>{if(x){c(!0),u(null);try{const f=await L.get(`/billing/usage-logs?limit=${a}`);i(f.data.logs||[])}catch(f){u(f instanceof Error?f:new Error("Erro ao carregar logs"))}finally{c(!1)}}},[x,a]);return r.useEffect(()=>{o()},[o]),{logs:g,isLoading:m,error:b,refetch:o}}function oe(){const{notify:a}=M(),{tenant:n}=U(),[x,g]=r.useState(!0),[i,m]=r.useState({members:[],invites:[]}),[c,b]=r.useState(!1),[u,o]=r.useState(null),[f,j]=r.useState(null),h=async()=>{try{g(!0);const s=await C("/api/tenants/members");if(!s.ok)throw new Error("Erro ao carregar");const l=await s.json();m(l.data)}catch(s){console.error(s),a({type:"error",message:"Erro ao carregar equipe."})}finally{g(!1)}};r.useEffect(()=>{h()},[]);const N=async s=>{if(window.confirm("Tem certeza que deseja remover este membro?"))try{if(o(s),!(await C(`/api/tenants/members/${s}`,{method:"DELETE"})).ok)throw new Error("Erro ao remover");a({type:"success",message:"Membro removido com sucesso."}),m(d=>({...d,members:d.members.filter(p=>p.id!==s)}))}catch{a({type:"error",message:"Erro ao remover membro."})}finally{o(null)}},w=async s=>{if(window.confirm("Cancelar este convite?"))try{if(o(s),!(await C(`/api/tenants/invites/${s}`,{method:"DELETE"})).ok)throw new Error("Erro ao cancelar");a({type:"success",message:"Convite cancelado."}),m(d=>({...d,invites:d.invites.filter(p=>p.id!==s)}))}catch{a({type:"error",message:"Erro ao cancelar convite."})}finally{o(null)}},k=async(s,l)=>{try{j(s),await C(`/api/tenants/members/${s}`,{method:"PATCH",body:JSON.stringify({role:l})}),a({type:"success",message:"Cargo atualizado com sucesso."}),m(d=>({...d,members:d.members.map(p=>p.id===s?{...p,role:l}:p)}))}catch{a({type:"error",message:"Erro ao atualizar cargo."})}finally{j(null)}},v=s=>s===n?.ownerUid;return e.jsxs("div",{className:"space-y-6 animate-in fade-in duration-300",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-bold text-slate-800 dark:text-slate-200 font-display flex items-center gap-2",children:[e.jsx($,{size:20,className:"text-primary"}),"Gestão de Equipe"]}),e.jsx("p",{className:"text-sm text-slate-500 font-display",children:"Gerencie quem tem acesso ao workspace da empresa."})]}),e.jsxs("button",{onClick:()=>b(!0),className:"bg-primary hover:bg-primary/90 text-white px-4 py-2 rounded-xl text-sm font-bold shadow-glow transition-all flex items-center gap-2 font-display",children:[e.jsx(Z,{size:16}),"Convidar Membro"]})]}),e.jsxs(I,{isLoading:x,isEmpty:i.members.length===0&&i.invites.length===0,error:null,children:[i.invites.length>0&&e.jsxs("div",{className:"space-y-3 mb-6",children:[e.jsxs("h4",{className:"text-[10px] font-bold text-slate-400 uppercase tracking-widest font-display flex items-center gap-2",children:[e.jsx(ee,{size:12})," Convites Pendentes"]}),e.jsx("div",{className:"grid gap-3",children:i.invites.map(s=>e.jsxs(y,{className:"p-4 flex items-center justify-between border-slate-200/50 dark:border-white/5",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-slate-100 dark:bg-slate-800 flex items-center justify-center text-slate-400",children:e.jsx(H,{size:18})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-bold text-slate-700 dark:text-slate-300 font-display",children:s.email}),e.jsxs("div",{className:"flex items-center gap-2 text-[11px] text-slate-400",children:[e.jsx("span",{className:"capitalize",children:s.role}),e.jsx("span",{className:"w-1 h-1 rounded-full bg-slate-300 dark:bg-slate-600"}),e.jsxs("span",{children:["Enviado em ",new Date(s.createdAt).toLocaleDateString()]})]})]})]}),e.jsx("button",{onClick:()=>w(s.id),disabled:u===s.id,className:"p-2 text-slate-400 hover:text-error hover:bg-error/10 rounded-lg transition-all",title:"Cancelar convite",children:e.jsx(P,{size:16})})]},s.id))})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h4",{className:"text-[10px] font-bold text-slate-400 uppercase tracking-widest font-display flex items-center gap-2",children:[e.jsx(R,{size:12})," Membros Ativos"]}),e.jsx("div",{className:"grid gap-3",children:i.members.map(s=>e.jsxs(y,{className:"p-4 flex items-center justify-between border-slate-200/50 dark:border-white/5",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-primary to-secondary flex items-center justify-center text-white text-sm font-bold shadow-sm",children:s.name?s.name.charAt(0).toUpperCase():s.email?.charAt(0).toUpperCase()||"U"}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-bold text-slate-700 dark:text-slate-300 font-display flex items-center gap-2",children:[s.name||s.email?.split("@")[0],v(s.id)&&e.jsx("span",{className:"px-1.5 py-0.5 rounded-full bg-primary/10 text-primary text-[9px] uppercase font-bold",children:"Dono"}),s.id===i.members.find(l=>l.email===n?.ownerEmail)?.id&&e.jsx("span",{className:"text-xs text-slate-400",children:"(Você)"})]}),e.jsx("p",{className:"text-[11px] text-slate-400 font-display",children:s.email})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[!v(s.id)&&e.jsxs("select",{value:s.role||"member",onChange:l=>k(s.id,l.target.value),disabled:f===s.id,className:"text-xs bg-slate-100 dark:bg-slate-800 border border-slate-300 dark:border-slate-600 rounded-lg px-2 py-1.5 text-slate-700 dark:text-slate-300 focus:ring-2 focus:ring-primary/50 focus:outline-none transition-all cursor-pointer disabled:opacity-50 disabled:cursor-wait",children:[e.jsx("option",{value:"admin",children:"Admin"}),e.jsx("option",{value:"member",children:"Membro"}),e.jsx("option",{value:"viewer",children:"Visualizador"})]}),!v(s.id)&&e.jsx("button",{onClick:()=>N(s.id),disabled:u===s.id,className:"p-2 text-slate-400 hover:text-error hover:bg-error/10 rounded-lg transition-all",title:"Remover membro",children:e.jsx(P,{size:16})})]})]},s.id))})]})]}),c&&e.jsx(Y,{onClose:()=>b(!1),onSuccess:h})]})}function T(a){return new Intl.NumberFormat("pt-BR").format(a)}function D(a){if(!a)return"N/A";const n=new Date(a);return Number.isNaN(n.getTime())?"N/A":n.toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric"})}const we=()=>{const[a,n]=V(),{notify:x}=M(),g=a.get("tab")||"billing",[i,m]=r.useState(g),{credits:c,isLoading:b,refetch:u}=J(),{logs:o,isLoading:f}=ne(10),{tenantId:j}=U(),h=K(j),[N,w]=r.useState(""),[k,v]=r.useState(""),[s,l]=r.useState(!1);r.useEffect(()=>{h&&w(h?.name||"")},[h]);const d=t=>{m(t),n({tab:t})},p=async()=>{l(!0);try{await new Promise(t=>setTimeout(t,500)),console.log("Profile saved:",{profileName:N,profileRole:k})}finally{l(!1)}},q=async()=>{try{const t=await L.get("/billing/portal");if(t.data.code==="requires_setup"||t.data.error&&!t.data.url){x({type:"info",message:"Sua conta ainda não possui faturas geradas. Entre em contato com o suporte."});return}t.data.url&&window.open(t.data.url,"_blank")}catch(t){console.warn("Billing portal error:",t),t?.response?.data?.code==="NO_STRIPE_CUSTOMER"&&x({type:"info",message:"Sua conta ainda não possui faturas geradas."})}},S=c?.monthlyQuota||0,z=c?.available||0,E=S>0?Math.min(100,Math.max(0,z/S*100)):0,A=(c?.planNormalized||h?.plan||"Starter").toUpperCase(),B=D(c?.renewsAt),G=c?.periodSource==="stripe"?"Ciclo de Faturamento":"Ciclo de 30 dias",O=[{id:"profile",label:"Perfil",icon:$},{id:"billing",label:"Plano & Créditos",icon:se},{id:"team",label:"Equipe",icon:te}];return e.jsxs("div",{className:"pt-24 space-y-8 pb-24 fade-in","aria-live":"polite",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold text-slate-800 dark:text-slate-200 font-display flex items-center gap-2",children:[e.jsx(ie,{size:24,className:"text-primary"}),"Configurações"]}),e.jsx("p",{className:"text-slate-500 dark:text-slate-400 font-display text-sm",children:"Gerencie seu perfil, plano e créditos de IA."})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:e.jsx(de,{label:A,color:"success"})})]}),e.jsx("div",{className:"flex gap-2 border-b border-slate-200 dark:border-slate-800 pb-1",children:O.map(t=>e.jsxs("button",{onClick:()=>d(t.id),className:`flex items-center gap-2 px-4 py-2.5 rounded-t-lg text-sm font-bold transition-all font-display ${i===t.id?"bg-white dark:bg-slate-800 text-primary border-b-2 border-primary shadow-sm":"text-slate-500 dark:text-slate-400 hover:text-slate-700 dark:hover:text-slate-200 hover:bg-slate-100 dark:hover:bg-slate-800/50"}`,children:[e.jsx(t.icon,{size:16}),t.label]},t.id))}),i==="profile"&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 animate-in fade-in duration-300",children:[e.jsxs(y,{className:"p-6 border border-slate-200/50 dark:border-white/5",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-gradient-to-br from-primary to-secondary flex items-center justify-center text-white text-lg font-bold shadow-glow",children:N?.charAt(0)?.toUpperCase()||"U"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-slate-800 dark:text-slate-200 font-display",children:"Dados do Perfil"}),e.jsx("p",{className:"text-xs text-slate-400 font-display",children:"Atualize suas informações pessoais"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"text-[10px] uppercase font-bold text-slate-400 tracking-widest font-display",children:"Nome Completo"}),e.jsx("input",{type:"text",value:N,onChange:t=>w(t.target.value),className:"w-full bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-xl px-4 py-3 text-sm font-display focus:ring-2 focus:ring-primary/20 focus:border-primary transition-all",placeholder:"Seu nome"})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"text-[10px] uppercase font-bold text-slate-400 tracking-widest font-display",children:"Cargo"}),e.jsx("input",{type:"text",value:k,onChange:t=>v(t.target.value),className:"w-full bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-xl px-4 py-3 text-sm font-display focus:ring-2 focus:ring-primary/20 focus:border-primary transition-all",placeholder:"Ex: Diretor Financeiro"})]}),e.jsx("button",{onClick:p,disabled:s,className:"w-full py-3 rounded-xl bg-primary hover:bg-primary/90 text-white font-bold text-sm transition-all shadow-glow disabled:opacity-50 font-display",children:s?"Salvando...":"Salvar Alterações"})]})]}),e.jsxs(y,{className:"p-6 border border-slate-200/50 dark:border-white/5",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(X,{size:18,className:"text-primary"}),e.jsx("h3",{className:"font-bold text-slate-800 dark:text-slate-200 font-display",children:"Dados da Organização"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-[9px] uppercase font-bold text-slate-400 tracking-widest font-display",children:"Nome do Tenant"}),e.jsx("p",{className:"text-slate-700 dark:text-slate-200 font-bold text-sm font-display",children:h?.name||"Minha Empresa"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-[9px] uppercase font-bold text-slate-400 tracking-widest font-display",children:"Workspace ID"}),e.jsx("code",{className:"text-[11px] bg-slate-100 dark:bg-slate-800 px-1.5 py-0.5 rounded text-slate-500 dark:text-slate-400 font-mono block truncate",children:j||"---"})]})]})]})]}),i==="billing"&&e.jsxs("div",{className:"space-y-6 animate-in fade-in duration-300",children:[e.jsxs("div",{className:"glass rounded-xl p-8 relative overflow-hidden border border-primary/20 group",children:[e.jsx("div",{className:"absolute top-0 right-0 w-64 h-64 bg-primary/20 rounded-full blur-[80px] -mr-16 -mt-16 pointer-events-none opacity-60 group-hover:opacity-100 transition-opacity"}),e.jsxs("div",{className:"relative z-10 flex flex-col md:flex-row items-start md:items-center justify-between gap-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 rounded-xl bg-primary/20 text-primary shadow-glow",children:e.jsx(R,{size:24})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-[10px] font-bold text-slate-400 uppercase tracking-widest font-display",children:"Seu Plano"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xl font-bold text-slate-800 dark:text-slate-200 font-display",children:A}),e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-success/20 text-success text-[10px] font-bold uppercase",children:"Ativo"})]}),e.jsxs("p",{className:"text-xs text-slate-400 mt-1 font-display",children:["Renova em: ",B]})]})]}),e.jsxs("button",{onClick:q,className:"bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 text-slate-600 dark:text-slate-300 px-5 py-2.5 rounded-lg text-sm font-bold hover:bg-slate-50 dark:hover:bg-slate-700 transition-all shadow-sm flex items-center gap-2 font-display",children:["Gerenciar Assinatura",e.jsx(Q,{size:16})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"flex h-6 w-6 items-center justify-center rounded bg-primary/20 text-primary shadow-glow",children:e.jsx(W,{size:14})}),e.jsx("h3",{className:"text-lg font-bold text-slate-800 dark:text-slate-200 font-display",children:"Créditos de IA"})]}),e.jsxs(y,{className:"p-6 border border-slate-200/50 dark:border-white/5",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-300 font-bold font-display",children:"Uso no Período"}),e.jsx("p",{className:"text-[11px] text-slate-400 italic font-display",children:G})]}),e.jsx("button",{onClick:()=>u(),className:"p-2 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-800 text-slate-400 hover:text-primary transition-colors",children:e.jsx(ae,{size:16,className:b?"animate-spin":""})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-end justify-between",children:[e.jsxs("span",{className:"text-4xl font-black text-slate-800 dark:text-slate-200 tracking-tighter font-display",children:[T(z),e.jsx("span",{className:"text-lg font-normal text-slate-400 ml-1",children:"restantes"})]}),e.jsxs("span",{className:"text-xs font-bold text-slate-500 bg-slate-100 dark:bg-slate-800 px-2 py-1 rounded-md font-display",children:["Cota: ",T(S)]})]}),e.jsx("div",{className:"h-5 w-full bg-slate-200 dark:bg-slate-800 rounded-full overflow-hidden p-1 shadow-inner",children:e.jsx("div",{className:`h-full rounded-full transition-all duration-1000 ease-out ${E>40?"bg-gradient-to-r from-primary to-secondary":E>15?"bg-warning":"bg-error"}`,style:{width:`${E}%`}})})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(re,{size:16,className:"text-slate-500"}),e.jsx("h3",{className:"text-[10px] font-bold text-slate-600 dark:text-slate-400 uppercase tracking-widest font-display",children:"Histórico de Uso"})]}),e.jsx(I,{isLoading:f,error:null,isEmpty:o.length===0,emptyTitle:"Sem registros",emptyDescription:"Nenhum consumo de créditos registrado ainda.",children:e.jsx(y,{className:"p-0 overflow-hidden border border-slate-200/50 dark:border-white/5",children:e.jsxs("table",{className:"w-full text-xs",children:[e.jsx("thead",{className:"bg-slate-50 dark:bg-white/5 border-b border-slate-200 dark:border-white/5",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-[9px] font-bold uppercase text-slate-400 tracking-widest font-display",children:"Tipo"}),e.jsx("th",{className:"px-4 py-3 text-left text-[9px] font-bold uppercase text-slate-400 tracking-widest font-display",children:"Fonte"}),e.jsx("th",{className:"px-4 py-3 text-right text-[9px] font-bold uppercase text-slate-400 tracking-widest font-display",children:"Créditos"}),e.jsx("th",{className:"px-4 py-3 text-right text-[9px] font-bold uppercase text-slate-400 tracking-widest font-display",children:"Data"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-100 dark:divide-white/5",children:o.map(t=>e.jsxs("tr",{className:"hover:bg-primary/5 transition-colors",children:[e.jsx("td",{className:"px-4 py-3 font-bold text-slate-800 dark:text-slate-200 font-display",children:t.type}),e.jsx("td",{className:"px-4 py-3 text-slate-500 dark:text-slate-400 font-display",children:t.source}),e.jsxs("td",{className:"px-4 py-3 text-right font-black text-error font-display",children:["-",t.creditsConsumed]}),e.jsx("td",{className:"px-4 py-3 text-right text-slate-400 font-display",children:D(t.createdAt)})]},t.id))})]})})})]})]}),i==="team"&&e.jsx(oe,{})]})},de=({label:a,color:n="slate"})=>{const x={slate:"bg-white dark:bg-slate-800 border-slate-200 dark:border-slate-700 text-slate-500 dark:text-slate-400",success:"bg-emerald-50 dark:bg-emerald-900/20 border-emerald-100 dark:border-emerald-800 text-emerald-600 dark:text-emerald-400"};return e.jsxs("div",{className:`px-3 py-1 rounded-full border text-[11px] font-bold flex items-center gap-2 shadow-sm font-display ${x[n]}`,children:[e.jsx("span",{className:`w-1.5 h-1.5 rounded-full ${n==="success"?"bg-emerald-500":"bg-slate-400"}`}),a]})};export{we as default};
