import{c as v,r as s,j as e,e as H,x as z,f as P,d as V,G as g,g as _,C as O,a as $}from"./index-C63jyLGJ.js";import{u as q}from"./usePulseSummary-Dl1eMPNR.js";import{S as G}from"./SectionHeader-C2TnFOL1.js";import{S as f}from"./StatsCard-Kg20ELUT.js";import{B as j}from"./Badge-2Mx9tBsx.js";import{A as y}from"./AsyncPanel-Cppyl2El.js";import{g as W}from"./CfoApi-CUafQPaH.js";import{T as U}from"./triangle-alert-mIh8RNC7.js";import{C as M}from"./circle-check-CMCcfcFa.js";import{W as X}from"./wallet-uMAMIM4F.js";import{T as J}from"./trending-up-Cl60cU2W.js";import{S as K}from"./search-jS56ERFu.js";import{C as Q}from"./circle-check-big-7tsUO77e.js";const Y=[["path",{d:"m7 7 10 10",key:"1fmybs"}],["path",{d:"M17 7v10H7",key:"6fjiku"}]],Z=v("arrow-down-right",Y);const ee=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],te=v("arrow-left",ee);const ae=[["path",{d:"M7 7h10v10",key:"1tivn9"}],["path",{d:"M7 17 17 7",key:"1vkiza"}]],se=v("arrow-up-right",ae);const re=[["path",{d:"M12 16h.01",key:"1drbdi"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M15.312 2a2 2 0 0 1 1.414.586l4.688 4.688A2 2 0 0 1 22 8.688v6.624a2 2 0 0 1-.586 1.414l-4.688 4.688a2 2 0 0 1-1.414.586H8.688a2 2 0 0 1-1.414-.586l-4.688-4.688A2 2 0 0 1 2 15.312V8.688a2 2 0 0 1 .586-1.414l4.688-4.688A2 2 0 0 1 8.688 2z",key:"1fd625"}]],ne=v("octagon-alert",re);function oe(a){switch(a){case"EXCELLENT":return{label:"Excelente",level:"Nível 4 – CFO de Elite",badgeClass:"bg-emerald-50 text-emerald-700 border-emerald-200 dark:bg-emerald-950/40 dark:text-emerald-300 dark:border-emerald-500/40",icon:M};case"STABLE":return{label:"Estável",level:"Nível 3 – Estrutura saudável",badgeClass:"bg-sky-50 text-sky-700 border-sky-200 dark:bg-sky-950/40 dark:text-sky-300 dark:border-sky-500/40",icon:M};case"CRITICAL":return{label:"Crítico",level:"Nível 2 – Atenção máxima",badgeClass:"bg-amber-50 text-amber-800 border-amber-200 dark:bg-amber-950/40 dark:text-amber-300 dark:border-amber-500/40",icon:U};case"DANGER":default:return{label:"Perigo",level:"Nível 1 – Risco de sobrevivência",badgeClass:"bg-red-50 text-red-800 border-red-200 dark:bg-red-950/40 dark:text-red-300 dark:border-red-500/40",icon:ne}}}function le(){const[a,N]=s.useState(null),[k,p]=s.useState(!0),[o,h]=s.useState(null);if(s.useEffect(()=>{let l=!1;async function b(){p(!0),h(null);try{const c=await W();l||N(c)}catch(c){console.error("[CFO Health] Erro ao carregar:",c),l||h("Não consegui carregar o Health Score financeiro. Tente recarregar a página.")}finally{l||p(!1)}}return b(),()=>{l=!0}},[]),k)return e.jsxs("section",{className:"rounded-2xl border border-slate-200/70 bg-white/80 p-5 shadow-sm dark:border-slate-800 dark:bg-slate-900/70",children:[e.jsx("div",{className:"h-4 w-40 rounded bg-slate-200/70 dark:bg-slate-700 mb-4"}),e.jsx("div",{className:"h-10 w-24 rounded bg-slate-200/70 dark:bg-slate-700 mb-2"}),e.jsx("div",{className:"h-3 w-52 rounded bg-slate-200/70 dark:bg-slate-700"})]});if(o)return e.jsx("section",{className:"rounded-2xl border border-red-200 bg-red-50/90 p-5 text-sm text-red-800 dark:border-red-500/50 dark:bg-red-950/40 dark:text-red-200",children:o});if(!a)return e.jsx("section",{className:"rounded-2xl border border-slate-200/70 bg-white/80 p-5 text-sm text-slate-600 dark:border-slate-800 dark:bg-slate-900/70 dark:text-slate-200",children:"Ainda não há dados financeiros suficientes para calcular o Health Score do CFO. Importe algumas movimentações para que o sistema consiga analisar seu momento financeiro."});const r=oe(a.status),u=r.icon,i=a.status==="EXCELLENT"?"Maturidade Financeira: Nível 4 (Avançado)":a.status==="STABLE"?"Maturidade Financeira: Nível 3 (Intermediário)":a.status==="CRITICAL"?"Maturidade Financeira: Nível 2 (Em risco)":"Maturidade Financeira: Nível 1 (Crítico)";return e.jsxs("section",{className:"rounded-2xl border border-slate-200/70 bg-white/90 p-5 shadow-sm dark:border-slate-800 dark:bg-slate-900/80",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3 mb-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-sm font-semibold tracking-wide text-slate-700 dark:text-slate-100 uppercase",children:"Health Score Financeiro"}),e.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-300 mt-0.5",children:"Visão consolidada de caixa, margem e endividamento."})]}),e.jsxs("span",{className:`inline-flex items-center gap-1 rounded-full border px-3 py-1 text-xs font-medium ${r.badgeClass}`,children:[e.jsx(u,{className:"h-3.5 w-3.5"}),r.label]})]}),e.jsxs("div",{className:"flex flex-wrap items-end gap-6 mb-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-[32px] leading-none font-semibold text-slate-900 dark:text-white",children:a.score.toFixed(0)}),e.jsx("p",{className:"mt-1 text-xs text-slate-500 dark:text-slate-300",children:"Score calculado com base no fluxo de caixa, margem e estrutura de dívidas."})]}),e.jsxs("div",{className:"flex-1 min-w-[160px]",children:[e.jsx("p",{className:"text-xs font-semibold text-slate-700 dark:text-slate-100 mb-1",children:i}),e.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-300",children:r.level})]})]}),a.aiComment&&e.jsxs("div",{className:"mt-2 rounded-xl border border-slate-100 bg-slate-50/80 p-3 text-xs text-slate-700 dark:border-slate-700 dark:bg-slate-900/80 dark:text-slate-100",children:[e.jsx("p",{className:"font-medium mb-1 text-[11px] uppercase tracking-wide text-slate-500 dark:text-slate-300",children:"Comentário do CFO IA"}),e.jsx("p",{children:a.aiComment})]}),e.jsxs("div",{className:"mt-3 flex flex-wrap items-center justify-between gap-2 text-[11px] text-slate-500 dark:text-slate-400",children:[e.jsxs("span",{children:["Runway estimado:"," ",e.jsxs("strong",{className:"text-slate-700 dark:text-slate-100",children:[a.runwayMonths.toFixed(1)," meses"]})]}),e.jsxs("span",{children:["Atualizado em"," ",new Date(a.updatedAt).toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",year:"2-digit"})]})]})]})}function Ne(){const a=H(),N=z(),{user:k}=P(),{notify:p}=V(),[o,h]=s.useState(""),r=s.useMemo(()=>new Date,[]),u=s.useMemo(()=>{const t=new Date(r);return t.setDate(t.getDate()-30),t},[r]),i=t=>t.toISOString().slice(0,10),{data:l,loading:b,error:c,refetch:T}=q({tenantId:"vivare-oficial",periodStart:i(u),periodEnd:i(r)}),[m,B]=s.useState([]),[C,S]=s.useState(!0),[L,E]=s.useState(null),A=async()=>{S(!0),E(null);try{const t=await $.post("/portal/transactions/filter",{from:i(u),to:i(r),q:null});B(t.data?.transactions||[])}catch(t){console.error("Deep Dive Load Error",t),E(t),p({type:"error",message:"Erro ao carregar detalhes."})}finally{S(!1)}};s.useEffect(()=>{A()},[u,r]);const D=s.useMemo(()=>{if(!o.trim())return m;const t=o.toLowerCase();return m.filter(n=>n.description.toLowerCase().includes(t)||n.category.toLowerCase().includes(t)||n.amount.toString().includes(t)||n.date.includes(t))},[m,o]),F=l?.kpis,R=l?.alerts||[],x=s.useMemo(()=>{const t=m.filter(d=>d.type==="credit").reduce((d,w)=>d+w.amount,0),n=m.filter(d=>d.type==="debit").reduce((d,w)=>d+Math.abs(w.amount),0);return{inflow:t,outflow:n,net:t-n}},[m]),I=()=>{N.pathname.startsWith("/advisor")?a("/advisor"):a(-1)};return e.jsxs("div",{className:"space-y-8 pb-20 fade-in","aria-live":"polite",children:[e.jsx(G,{title:"Deep Dive Financeiro",subtitle:"Análise detalhada de performance, caixa e movimentações.",actions:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{onClick:I,className:"bg-white border border-momentum-border text-momentum-muted hover:text-momentum-text px-4 py-2 rounded-xl transition-all text-sm font-medium flex items-center gap-2 shadow-sm",children:[e.jsx(te,{size:16})," Voltar"]}),e.jsx(j,{variant:"neutral",className:"px-3 py-1 bg-white/50",children:"Últimos 30 dias"})]})}),e.jsx(y,{isLoading:b||C,error:c||L,onRetry:()=>{T(),A()},className:"border-none bg-transparent shadow-none",loadingVariant:"skeleton",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsx(f,{label:"Saldo Final (Real)",value:String(F?.cashBalance||"R$ 0,00"),icon:X,variant:"default"}),e.jsx(f,{label:"Entradas (Período)",value:x.inflow.toLocaleString("pt-BR",{style:"currency",currency:"BRL"}),icon:se,variant:"success"}),e.jsx(f,{label:"Saídas (Período)",value:x.outflow.toLocaleString("pt-BR",{style:"currency",currency:"BRL"}),icon:Z,variant:"danger"}),e.jsx(f,{label:"Resultado Líquido",value:x.net.toLocaleString("pt-BR",{style:"currency",currency:"BRL"}),icon:J,variant:x.net>=0?"success":"danger",trend:{value:x.net>=0?"Positivo":"Negativo",direction:x.net>=0?"up":"down"}})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-8",children:[e.jsxs(g,{className:"min-h-[320px] flex items-center justify-center relative overflow-hidden border-none shadow-xl bg-gradient-to-br from-white/40 to-white/10",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-momentum-accent/5 to-transparent z-0"}),e.jsxs("div",{className:"text-center z-10 p-6",children:[e.jsx("h3",{className:"text-lg font-bold text-momentum-text mb-2",children:"Fluxo de Caixa Diário"}),e.jsx("p",{className:"text-sm text-momentum-muted mb-4 max-w-xs mx-auto",children:"Visualização gráfica interativa em processamento. Disponível em breve para análise de tendência."}),e.jsx(j,{variant:"neutral",className:"animate-pulse",children:"Aguardando IA"})]})]}),e.jsxs(g,{className:"p-0 overflow-hidden border-none shadow-xl bg-white/50 backdrop-blur-xl",children:[e.jsxs("div",{className:"p-6 border-b border-momentum-border/50 flex flex-col sm:flex-row justify-between items-center gap-4 bg-white/20",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-lg text-momentum-text",children:"Movimentações Detalhadas"}),e.jsx("p",{className:"text-xs text-momentum-muted",children:"Cruzamento de dados bancários e categorias"})]}),e.jsxs("div",{className:"relative w-full sm:w-64",children:[e.jsx(K,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-momentum-muted"}),e.jsx("input",{type:"text",placeholder:"Buscar transações...",value:o,onChange:t=>h(t.target.value),className:"w-full bg-white/50 border border-momentum-border rounded-xl pl-10 pr-4 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-momentum-accent/20 focus:border-momentum-accent transition-all"})]})]}),e.jsx(y,{isLoading:C,error:L,isEmpty:D.length===0,emptyTitle:"Nenhuma transação",emptyDescription:o?"Nenhum resultado para sua busca.":"Sem movimentações no período.",className:"min-h-[400px]",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm text-left",children:[e.jsx("thead",{className:"bg-slate-50/50 text-momentum-muted font-bold uppercase text-[10px] tracking-widest border-b border-momentum-border/50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4",children:"Data"}),e.jsx("th",{className:"px-6 py-4",children:"Descrição"}),e.jsx("th",{className:"px-6 py-4",children:"Categoria"}),e.jsx("th",{className:"px-6 py-4 text-right",children:"Valor"})]})}),e.jsx("tbody",{className:"divide-y divide-momentum-border/30",children:D.map((t,n)=>e.jsxs("tr",{className:"hover:bg-momentum-accent/5 transition-colors group",children:[e.jsx("td",{className:"px-6 py-4 text-momentum-muted whitespace-nowrap",children:t.date}),e.jsx("td",{className:"px-6 py-4 font-medium text-momentum-text group-hover:text-momentum-accent transition-colors",children:t.description}),e.jsx("td",{className:"px-6 py-4",children:e.jsx(j,{variant:"neutral",className:"bg-white/50 border-momentum-border/50 text-[10px]",children:t.category})}),e.jsxs("td",{className:_("px-6 py-4 text-right font-bold",t.type==="credit"?"text-momentum-success":"text-momentum-text"),children:[t.type==="debit"?"-":"",Math.abs(t.amount).toLocaleString("pt-BR",{style:"currency",currency:"BRL"})]})]},n))})]})})})]})]}),e.jsxs("div",{className:"lg:col-span-1 space-y-8",children:[e.jsx(le,{}),e.jsxs(g,{className:"p-6 space-y-6 border-none shadow-lg bg-white/50",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-momentum-warn/10 text-momentum-warn",children:e.jsx(O,{size:20})}),e.jsx("h3",{className:"font-bold text-momentum-text",children:"Anomalias de Fluxo"})]}),e.jsx(y,{isLoading:b,error:c,loadingVariant:"skeleton",className:"border-none bg-transparent p-0 shadow-none",children:R.length>0?e.jsx("div",{className:"space-y-4",children:R.map(t=>e.jsxs("div",{className:"p-4 bg-momentum-warn/5 rounded-xl border border-momentum-warn/10 text-sm",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsx("span",{className:"text-[10px] font-bold uppercase tracking-wider text-momentum-warn",children:t.type}),e.jsx(j,{variant:"warn",className:"scale-75 origin-right",children:"Pendente"})]}),e.jsx("p",{className:"text-momentum-text font-medium leading-relaxed",children:t.message})]},t.id))}):e.jsxs("div",{className:"text-center py-6",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-momentum-success/10 flex items-center justify-center mx-auto mb-3",children:e.jsx(Q,{className:"w-6 h-6 text-momentum-success"})}),e.jsx("p",{className:"text-sm text-momentum-muted",children:"Nenhuma anomalia crítica detectada nos últimos 30 dias."})]})})]}),e.jsxs(g,{className:"p-6 space-y-4 border-none shadow-lg bg-momentum-accent/5 border-l-4 border-l-momentum-accent",children:[e.jsx("h3",{className:"text-sm font-bold text-momentum-accent uppercase tracking-widest",children:"Saúde Operacional"}),e.jsxs("p",{className:"text-sm text-momentum-text leading-relaxed",children:["Seu runway atual de ",e.jsxs("span",{className:"font-bold",children:[l?.kpis.runwayMonths||0," meses"]})," está dentro da meta saudável e seguro (mais de 6 meses)."]}),e.jsx("div",{className:"pt-2",children:e.jsx("button",{className:"text-[10px] font-bold text-momentum-accent hover:underline uppercase tracking-wider",children:"Ver plano de expansão"})})]})]})]})]})}export{Ne as default};
