import{c as j,p as B,r as i,m as $,n as z,q as D,s as G,o as H,j as e,g as O,G as q}from"./index-C63jyLGJ.js";import{S as V}from"./SectionHeader-C2TnFOL1.js";import{S as y}from"./StatsCard-Kg20ELUT.js";import{B as J}from"./Badge-2Mx9tBsx.js";import{A as U}from"./AsyncPanel-Cppyl2El.js";import{R as W}from"./refresh-cw-DM2LiFBK.js";import{T as K}from"./trending-up-Cl60cU2W.js";import{W as Q}from"./wallet-uMAMIM4F.js";import{C as X}from"./circle-dollar-sign-BQ808c_2.js";import{S as Y}from"./search-jS56ERFu.js";const Z=[["path",{d:"M10 12h4",key:"a56b0p"}],["path",{d:"M10 8h4",key:"1sr2af"}],["path",{d:"M14 21v-3a2 2 0 0 0-4 0v3",key:"1rgiei"}],["path",{d:"M6 10H4a2 2 0 0 0-2 2v7a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-2",key:"secmi2"}],["path",{d:"M6 21V5a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v16",key:"16ra0t"}]],A=j("building-2",Z);const ee=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],te=j("chevron-right",ee);const se=[["line",{x1:"19",x2:"5",y1:"5",y2:"19",key:"1x9vlm"}],["circle",{cx:"6.5",cy:"6.5",r:"2.5",key:"4mh3h7"}],["circle",{cx:"17.5",cy:"17.5",r:"2.5",key:"1mdrzq"}]],ae=j("percent",se),oe="realEstate_statements";function re(s){if(!s)return"Mês não definido";const[o,N]=s.split("-"),l=Number(N),h=["","Jan","Fev","Mar","Abr","Mai","Jun","Jul","Ago","Set","Out","Nov","Dez"];return!isNaN(l)&&l>=1&&l<=12?`${h[l]}/${o}`:s}function m(s){return s?s.toLocaleString("pt-BR",{style:"currency",currency:"BRL",minimumFractionDigits:2}):"R$ 0,00"}function fe(){const{tenantId:s}=B(),[o,N]=i.useState([]),[l,h]=i.useState(!0),[F,w]=i.useState(null),[p,T]=i.useState(""),v=i.useCallback(async()=>{h(!0),w(null);try{if(!s)throw new Error("tenantId ausente");const t=$(z,"tenants",s,oe),a=D(t,G("month","desc")),d=await H(a),u=[];d.docs.forEach(x=>{const r=x.data()||{},c=String(r.month??x.id),g=r.ownerId?String(r.ownerId):void 0,b=typeof r.ownerShareRate=="number"?Number(r.ownerShareRate):1;(Array.isArray(r.units)?r.units:[]).forEach((n,_)=>{const E=Number(n.grossRevenue??0),S=Number(n.cleaningFees??0),M=Number(n.platformFees??0),P=Number(n.otherCosts??0),k=typeof n.netRevenue=="number"?Number(n.netRevenue):E-(S+M+P),L=k*b,I=k-L;u.push({id:`${x.id}:${_}`,month:c,unitCode:n.unitCode,ownerName:g,ownerId:g,grossRevenue:E,cleaningFees:S,platformFees:M,otherCosts:P,ownerPayout:L,realEstatePayouts:I})})}),N(u)}catch(t){console.error("[RealEstate] erro ao carregar dados:",t),w(t?.message||"Não foi possível carregar os dados de Real Estate.")}finally{h(!1)}},[s]);i.useEffect(()=>{v()},[v]);const R=i.useMemo(()=>{if(!p.trim())return o;const t=p.toLowerCase();return o.filter(a=>a.unitCode?.toLowerCase().includes(t)||a.ownerName?.toLowerCase().includes(t)||a.month.includes(t))},[o,p]),f=i.useMemo(()=>{if(!o.length)return{totalGross:0,totalOwner:0,totalHouse:0,totalCosts:0,avgMargin:0};let t=0,a=0,d=0,u=0;for(const c of o){const g=c.grossRevenue??0,b=c.ownerPayout??0,C=c.realEstatePayouts??0,n=(c.cleaningFees??0)+(c.platformFees??0)+(c.otherCosts??0);t+=g,a+=b,d+=C,u+=n}const x=d,r=t>0?x/t:0;return{totalGross:t,totalOwner:a,totalHouse:d,totalCosts:u,avgMargin:r}},[o]);return e.jsxs("div",{className:"space-y-8 pb-24 fade-in",children:[e.jsx(V,{title:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(A,{size:24,className:"text-momentum-accent"}),e.jsx("span",{children:"Real Estate · Performance"})]}),subtitle:"Consolidado de repasses, receita bruta e payout Vivare por unidade.",actions:e.jsx("div",{className:"flex gap-2",children:e.jsxs("button",{onClick:v,className:"bg-momentum-bg/50 hover:bg-white text-momentum-text border border-momentum-border px-4 py-2 rounded-lg text-sm font-medium transition-all shadow-sm flex items-center gap-2",children:[e.jsx(W,{size:14,className:O(l&&"animate-spin")})," Atualizar"]})})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx(y,{label:"Receita Bruta",value:m(f.totalGross),icon:K,variant:"default"}),e.jsx(y,{label:"Repasses Proprietários",value:m(f.totalOwner),icon:Q,variant:"default"}),e.jsx(y,{label:"Payout Vivare",value:m(f.totalHouse),icon:X,variant:"success"}),e.jsx(y,{label:"Margem Média",value:`${(f.avgMargin*100).toFixed(1)}%`,icon:ae,variant:"default"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("h3",{className:"text-lg font-bold text-momentum-text font-display flex items-center gap-2",children:["Meses Consolidados",e.jsx(J,{variant:"neutral",children:R.length})]}),e.jsxs("div",{className:"relative group w-full md:w-80",children:[e.jsx(Y,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-momentum-muted group-focus-within:text-momentum-accent transition-colors"}),e.jsx("input",{type:"text",placeholder:"Buscar unidade ou proprietário...",value:p,onChange:t=>T(t.target.value),className:"w-full bg-white/50 dark:bg-slate-900/50 border border-momentum-border rounded-xl pl-10 pr-4 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-momentum-accent/20 focus:border-momentum-accent transition-all"})]})]}),e.jsx(U,{isLoading:l,error:F,isEmpty:o.length===0,emptyTitle:"Nenhum dado de Real Estate",emptyDescription:`Nenhum registro encontrado em tenants/${s}/realEstate_statements.`,children:e.jsx(q,{className:"p-0 overflow-hidden shadow-2xl",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left text-sm",children:[e.jsx("thead",{className:"bg-momentum-muted/5 text-momentum-muted font-bold uppercase tracking-widest text-[10px] border-b border-momentum-border",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4",children:"Mês"}),e.jsx("th",{className:"px-6 py-4",children:"Unidade"}),e.jsx("th",{className:"px-6 py-4",children:"Proprietário"}),e.jsx("th",{className:"px-6 py-4 text-right",children:"Receita Bruta"}),e.jsx("th",{className:"px-6 py-4 text-right",children:"Taxas / Gestão"}),e.jsx("th",{className:"px-6 py-4 text-right",children:"Repasse"}),e.jsx("th",{className:"px-6 py-4 text-right",children:"Payout Vivare"})]})}),e.jsx("tbody",{className:"divide-y divide-momentum-border",children:R.map(t=>{const a=(t.cleaningFees??0)+(t.platformFees??0)+(t.otherCosts??0);return e.jsxs("tr",{className:"group hover:bg-momentum-accent/5 transition-colors cursor-default",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"font-semibold text-momentum-text",children:re(t.month)})}),e.jsx("td",{className:"px-6 py-4 font-medium text-momentum-text",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(A,{size:14,className:"text-momentum-muted"}),t.unitCode||"N/A"]})}),e.jsx("td",{className:"px-6 py-4 text-momentum-muted",children:t.ownerName||"Não Informado"}),e.jsx("td",{className:"px-6 py-4 text-right font-medium text-momentum-text",children:m(t.grossRevenue)}),e.jsx("td",{className:"px-6 py-4 text-right text-momentum-muted",children:m(a)}),e.jsx("td",{className:"px-6 py-4 text-right font-semibold text-momentum-text",children:m(t.ownerPayout)}),e.jsx("td",{className:"px-6 py-4 text-right font-bold text-momentum-success",children:e.jsxs("div",{className:"flex items-center justify-end gap-1",children:[m(t.realEstatePayouts),e.jsx(te,{size:14,className:"opacity-0 group-hover:opacity-100 transition-opacity translate-x-1"})]})})]},t.id)})})]})})})})]})]})}export{fe as default};
