import{c as P,r as i,d as ee,a as te,j as e,h as se,G as v,S as ne,I as ae,b as U}from"./index-CKJzAf41.js";import{A as re}from"./AIAdvisorPanel-DpownHcL.js";import{C as M,L as oe,P as ie,a as ce,b as le,c as de,A as ue,p as me,d as pe,e as he,D as ge,i as fe}from"./chart-BJ99D5hM.js";import{S as be}from"./SectionHeader-SIoyBbZT.js";import{S as L}from"./StatsCard-DiSwUV3y.js";import{A as xe}from"./AsyncPanel-EKsCH61J.js";import{R as ye}from"./refresh-cw-Nie8VSPz.js";import{T as H}from"./trending-up-B1Z7i_Cj.js";import{W as je}from"./wallet-C5gH6bNt.js";import"./send-B-i043n5.js";import"./user-BZSMoRAh.js";const ve=[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"m19 9-5 5-4-4-3 3",key:"2osh9i"}]],Ce=P("chart-line",ve);const ke=[["path",{d:"M21 12c.552 0 1.005-.449.95-.998a10 10 0 0 0-8.953-8.951c-.55-.055-.998.398-.998.95v8a1 1 0 0 0 1 1z",key:"pzmjnu"}],["path",{d:"M21.21 15.89A10 10 0 1 1 8 2.83",key:"k2fpak"}]],Se=P("chart-pie",ke);const Ne=[["path",{d:"M16 17h6v-6",key:"t6n2it"}],["path",{d:"m22 17-8.5-8.5-5 5L2 7",key:"x473p"}]],Re=P("trending-down",Ne);function we(){const[I,p]=i.useState(()=>typeof document<"u"&&(document.body.classList.contains("dark")||document.body.getAttribute("data-theme")==="dark")?"dark":"light");return i.useEffect(()=>{const C=new MutationObserver(()=>{const h=document.body.classList.contains("dark")||document.body.getAttribute("data-theme")==="dark";p(h?"dark":"light")});return C.observe(document.body,{attributes:!0,attributeFilter:["class","data-theme"]}),()=>C.disconnect()},[]),I}M.register(oe,ie,ce,le,de,ue,me,pe,he,ge,fe);const _e=()=>{const p=we()==="dark";ee();const{notify:C}=te(),[h,J]=i.useState({balance:0,income:0,expense:0}),[Ae,K]=i.useState({categories:[],cards:[]}),[z,q]=i.useState([]),[y,B]=i.useState(!0),[Q,E]=i.useState(!1),D=i.useRef(null),T=i.useRef(null),V=i.useRef(null),W=i.useRef(null),b=getComputedStyle(document.documentElement),d=[b.getPropertyValue("--chart-1").trim()||"#10b981",b.getPropertyValue("--chart-2").trim()||"#f43f5e",b.getPropertyValue("--chart-3").trim()||"#8b5cf6",b.getPropertyValue("--chart-4").trim()||"#f59e0b",b.getPropertyValue("--chart-5").trim()||"#3b82f6"],j=p?"#94a3b8":"#64748b";function _(s,r,u=3){const t=s.filter(a=>a!==null&&a>0),n=t.length;let l,o;if(n<3)l=.4,o=.02;else if(n<6){l=.25;const a=t.slice(-3).reduce((m,f)=>m+f,0)/3,c=t.slice(0,Math.min(3,t.length)).reduce((m,f)=>m+f,0)/Math.min(3,t.length);o=c>0?(a-c)/c/n:.02}else{l=.15;const a=[.1,.15,.2,.25,.3],c=t.slice(-5);let m=0,f=0;c.forEach((w,A)=>{const O=a[A]||.3;m+=w*O,f+=O});const Z=m/f,R=t.slice(-6,-3).reduce((w,A)=>w+A,0)/3;o=R>0?(Z-R)/R/3:.01}o=Math.max(-.15,Math.min(.15,o));const g=t.length>0?t.slice(-3).reduce((a,c)=>a+c,0)/Math.min(3,t.length):5e3,x=[...s.map(()=>null)],S=[...s.map(()=>null)],N=[...s.map(()=>null)],F=[...r];if(t.length>0){const a=s.length-1;x[a]=t[t.length-1],S[a]=t[t.length-1],N[a]=t[t.length-1]}const G=["Jan","Fev","Mar","Abr","Mai","Jun","Jul","Ago","Set","Out","Nov","Dez"],Y=r.length>0?G.indexOf(r[r.length-1]?.substring(0,3)):new Date().getMonth();for(let a=1;a<=u;a++){const c=g*Math.pow(1+o,a),m=c*l*(1+a*.1);x.push(Math.round(c)),S.push(Math.round(c+m)),N.push(Math.round(Math.max(0,c-m)));const f=(Y+a)%12;F.push(`${G[f]} (Proj)`)}return{forecastValues:x,upper:S,lower:N,extendedMonths:F}}async function k(){B(!0);try{const r=(await U.get("/portal/forecast")).data,u=r?.kpis||{balance:0,income:0,expense:0};J(u),K(r?.meta||{categories:[],cards:[]});const t=r?.charts||{months:[],incomeSeries:[],expenseSeries:[],forecastIncome:[],forecastExpense:[],confidenceUpper:[],confidenceLower:[],categories:[]};let n;if(!t.forecastIncome||t.forecastIncome.length===0){const g=_(t.incomeSeries,t.months,3),x=_(t.expenseSeries,t.months,3);n={...t,months:g.extendedMonths,incomeSeries:[...t.incomeSeries,...Array(3).fill(null)],expenseSeries:[...t.expenseSeries,...Array(3).fill(null)],forecastIncome:g.forecastValues,forecastExpense:x.forecastValues,confidenceUpper:g.upper,confidenceLower:g.lower}}else n=t;X(n);const l=(u.balance||0)!==0||(u.income||0)!==0||(u.expense||0)!==0,o=(n.months?.length||0)>0||(n.categories?.length||0)>0;E(l||o)}catch(s){console.error("Analytics Load Error:",s),E(!1)}finally{B(!1)}}async function $(){try{const{data:s}=await U.get("/portal/insights/cache").catch(()=>({data:[]}));q(Array.isArray(s)?s:[])}catch{}}function X(s){const r=D.current?.getContext("2d"),u=T.current?.getContext("2d");if(!r||!u)return;V.current?.destroy(),W.current?.destroy();const t=r.createLinearGradient(0,0,0,280);t.addColorStop(0,p?"rgba(139, 92, 246, 0.15)":"rgba(139, 92, 246, 0.1)"),t.addColorStop(1,"rgba(139, 92, 246, 0)"),V.current=new M(r,{type:"line",data:{labels:s.months,datasets:[{label:"Limite Superior",data:s.confidenceUpper,borderColor:"transparent",backgroundColor:t,fill:"+1",pointRadius:0,tension:.4,order:3},{label:"Limite Inferior",data:s.confidenceLower,borderColor:"transparent",backgroundColor:"transparent",fill:!1,pointRadius:0,tension:.4,order:4},{label:"Receitas",data:s.incomeSeries,borderColor:d[0],backgroundColor:p?"rgba(16, 185, 129, 0.1)":"rgba(16, 185, 129, 0.05)",borderWidth:2.5,tension:.4,fill:!0,pointRadius:4,pointBackgroundColor:d[0],order:1},{label:"Despesas",data:s.expenseSeries,borderColor:d[1],backgroundColor:"transparent",borderWidth:2.5,tension:.4,pointRadius:4,pointBackgroundColor:d[1],order:2},{label:"Receitas (Proj)",data:s.forecastIncome,borderColor:d[0],backgroundColor:"transparent",borderWidth:2,borderDash:[6,4],tension:.4,pointRadius:3,pointStyle:"circle",pointBackgroundColor:p?"#1e293b":"#ffffff",pointBorderColor:d[0],pointBorderWidth:2,order:1},{label:"Despesas (Proj)",data:s.forecastExpense,borderColor:d[1],backgroundColor:"transparent",borderWidth:2,borderDash:[6,4],tension:.4,pointRadius:3,pointStyle:"circle",pointBackgroundColor:p?"#1e293b":"#ffffff",pointBorderColor:d[1],pointBorderWidth:2,order:2}]},options:{responsive:!0,maintainAspectRatio:!1,interaction:{mode:"index",intersect:!1},plugins:{legend:{display:!0,position:"top",align:"end",labels:{color:j,boxWidth:12,usePointStyle:!0,font:{size:10,weight:"bold"},filter:n=>!n.text?.includes("Limite")}},tooltip:{backgroundColor:"rgba(15, 23, 42, 0.95)",padding:14,cornerRadius:10,titleFont:{size:12,weight:"bold"},bodyFont:{size:11},callbacks:{label:n=>{const l=n.raw;if(l===null)return"";const o=l.toLocaleString("pt-BR",{style:"currency",currency:"BRL"}),g=n.dataset.label?.includes("Proj");return`${n.dataset.label}: ${o}${g?" ‚ö°":""}`}}}},scales:{y:{grid:{color:p?"rgba(226, 232, 240, 0.05)":"rgba(0, 0, 0, 0.05)"},ticks:{color:j,font:{size:10},callback:n=>`R$ ${(Number(n)/1e3).toFixed(0)}k`}},x:{grid:{display:!1},ticks:{color:j,font:{size:10,weight:"bold"},callback:function(n,l){const o=s.months[l];return o?.includes("(Proj)")?`üìà ${o.replace(" (Proj)","")}`:o}}}}}}),W.current=new M(u,{type:"doughnut",data:{labels:s.categories.map(n=>n.category),datasets:[{data:s.categories.map(n=>n.amount),backgroundColor:d,borderColor:"transparent",hoverOffset:4}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"bottom",labels:{color:j,usePointStyle:!0,pointStyle:"circle",font:{size:10}}}},cutout:"70%"}})}return i.useEffect(()=>{k()},[]),i.useEffect(()=>{y||$()},[y]),e.jsxs("div",{className:"space-y-8 pb-20 fade-in",children:[e.jsx(be,{title:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(H,{size:24,className:"text-momentum-accent"}),e.jsx("span",{children:"Analytics Financeiro"})]}),subtitle:"Vis√£o estrat√©gica de fluxos, categorias e sa√∫de do neg√≥cio.",actions:e.jsxs("button",{onClick:k,className:"flex items-center gap-2 px-3 py-1.5 rounded-lg border border-momentum-border hover:bg-white transition-all text-xs font-bold text-momentum-muted hover:text-momentum-text",children:[e.jsx(ye,{size:14,className:se(y&&"animate-spin")}),"Sincronizar"]})}),e.jsxs("div",{className:"grid gap-8 md:grid-cols-[1fr_360px]",children:[e.jsx("div",{className:"space-y-8",children:e.jsx(xe,{isLoading:y,isEmpty:!Q,emptyTitle:"Sem Dados",emptyDescription:"Conecte suas finan√ßas para gerar insights.",onRetry:k,children:e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-6 font-bold",children:[e.jsx(L,{label:"Saldo Projetado",value:h.balance.toLocaleString("pt-BR",{style:"currency",currency:"BRL"}),icon:je,trend:h.balanceTrend?{value:h.balanceTrend,direction:h.balanceTrend.includes("+")?"up":"down"}:void 0}),e.jsx(L,{label:"Receita Mensal",value:h.income.toLocaleString("pt-BR",{style:"currency",currency:"BRL"}),variant:"success",icon:H}),e.jsx(L,{label:"Despesa Mensal",value:h.expense.toLocaleString("pt-BR",{style:"currency",currency:"BRL"}),variant:"danger",icon:Re})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-8",children:[e.jsxs(v,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-6",children:[e.jsx(Ce,{size:18,className:"text-momentum-accent"}),e.jsx("h3",{className:"text-sm font-bold text-momentum-text uppercase tracking-widest",children:"Tend√™ncia (6 Meses)"})]}),e.jsx("div",{className:"h-[280px]",children:e.jsx("canvas",{ref:D})})]}),e.jsxs(v,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-6",children:[e.jsx(Se,{size:18,className:"text-momentum-accent"}),e.jsx("h3",{className:"text-sm font-bold text-momentum-text uppercase tracking-widest",children:"Categorias"})]}),e.jsx("div",{className:"h-[280px]",children:e.jsx("canvas",{ref:T})})]})]}),e.jsxs(v,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ne,{size:18,className:"text-momentum-accent"}),e.jsx("h3",{className:"text-sm font-bold text-momentum-text uppercase tracking-widest",children:"Insights Estrat√©gicos"})]}),e.jsx("button",{onClick:$,className:"text-[10px] font-bold text-momentum-accent uppercase hover:underline",children:"Atualizar IA"})]}),e.jsx("div",{className:"grid gap-4 sm:grid-cols-2",children:z.length?z.map((s,r)=>e.jsx(ae,{title:"An√°lise Relevante",description:s,severity:"info"},r)):e.jsx("div",{className:"col-span-full py-8 text-center text-sm text-momentum-muted italic border-2 border-dashed border-momentum-border rounded-2xl",children:"Nenhum insight dispon√≠vel no momento."})})]})]})})}),e.jsx("div",{className:"hidden md:block",children:e.jsx(v,{className:"p-0 overflow-hidden sticky top-8 border-none shadow-2xl",children:e.jsx(re,{})})})]})]})};export{_e as AnalyticsDashboard,_e as default};
