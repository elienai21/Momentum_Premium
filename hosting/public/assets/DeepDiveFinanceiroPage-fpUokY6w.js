import{a as s,j as e}from"./charts--kFkiaCp.js";import{c as H,d as O,a as V,B as g,G as f,f as q,b as G}from"./index-CETmOTzF.js";import{u as W}from"./usePulseSummary-DZgNtT5q.js";import{g as U}from"./errorMessages-BDQo1fJX.js";import{S as X}from"./SectionHeader-DkKv0CWh.js";import{S as y}from"./StatsCard-B55lZtJ5.js";import{A as E}from"./AsyncPanel-DLrco2Ud.js";import{g as $}from"./CfoApi-BjOO2Epg.js";import{a7 as J,u as K,a8 as F,a9 as Q,W as Y,aa as Z,ab as _,T as ee,k as ae,b as te,t as se}from"./icons-Bc7DOyy3.js";import{u as re,a as le}from"./vendor-DnLjH3oN.js";import"./query-BGhlxTj0.js";import"./firebase-dP-Dck55.js";function de(t){switch(t){case"EXCELLENT":return{label:"Excelente",level:"Nível 4 – CFO de Elite",badgeClass:"bg-emerald-50 text-emerald-700 border-emerald-200 dark:bg-emerald-950/40 dark:text-emerald-300 dark:border-emerald-500/40",icon:F};case"STABLE":return{label:"Estável",level:"Nível 3 – Estrutura saudável",badgeClass:"bg-sky-50 text-sky-700 border-sky-200 dark:bg-sky-950/40 dark:text-sky-300 dark:border-sky-500/40",icon:F};case"CRITICAL":return{label:"Crítico",level:"Nível 2 – Atenção máxima",badgeClass:"bg-amber-50 text-amber-800 border-amber-200 dark:bg-amber-950/40 dark:text-amber-300 dark:border-amber-500/40",icon:K};default:return{label:"Perigo",level:"Nível 1 – Risco de sobrevivência",badgeClass:"bg-red-50 text-red-800 border-red-200 dark:bg-red-950/40 dark:text-red-300 dark:border-red-500/40",icon:J}}}function ne(){const[t,j]=s.useState(null),[L,u]=s.useState(!0),[h,d]=s.useState(null);if(s.useEffect(()=>{let r=!1;async function m(){u(!0),d(null);try{const i=await $();r||j(i)}catch(i){console.error("[CFO Health] Erro ao carregar:",i),r||d("Não consegui carregar o Health Score financeiro. Tente recarregar a página.")}finally{r||u(!1)}}return m(),()=>{r=!0}},[]),L)return e.jsxs("section",{className:"rounded-2xl border border-slate-200/70 bg-white/80 p-5 shadow-sm dark:border-slate-800 dark:bg-slate-900/70",children:[e.jsx("div",{className:"h-4 w-40 rounded bg-slate-200/70 dark:bg-slate-700 mb-4"}),e.jsx("div",{className:"h-10 w-24 rounded bg-slate-200/70 dark:bg-slate-700 mb-2"}),e.jsx("div",{className:"h-3 w-52 rounded bg-slate-200/70 dark:bg-slate-700"})]});if(h)return e.jsx("section",{className:"rounded-2xl border border-red-200 bg-red-50/90 p-5 text-sm text-red-800 dark:border-red-500/50 dark:bg-red-950/40 dark:text-red-200",children:h});if(!t)return e.jsx("section",{className:"rounded-2xl border border-slate-200/70 bg-white/80 p-5 text-sm text-slate-600 dark:border-slate-800 dark:bg-slate-900/70 dark:text-slate-200",children:"Ainda não há dados financeiros suficientes para calcular o Health Score do CFO. Importe algumas movimentações para que o sistema consiga analisar seu momento financeiro."});const x=de(t.status),n=x.icon,b=t.status==="EXCELLENT"?"Maturidade Financeira: Nível 4 (Avançado)":t.status==="STABLE"?"Maturidade Financeira: Nível 3 (Intermediário)":t.status==="CRITICAL"?"Maturidade Financeira: Nível 2 (Em risco)":"Maturidade Financeira: Nível 1 (Crítico)";return e.jsxs("section",{className:"rounded-2xl border border-slate-200/70 bg-white/90 p-5 shadow-sm dark:border-slate-800 dark:bg-slate-900/80",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3 mb-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-sm font-semibold tracking-wide text-slate-700 dark:text-slate-100 uppercase",children:"Health Score Financeiro"}),e.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-300 mt-0.5",children:"Visão consolidada de caixa, margem e endividamento."})]}),e.jsxs("span",{className:`inline-flex items-center gap-1 rounded-full border px-3 py-1 text-xs font-medium ${x.badgeClass}`,children:[e.jsx(n,{className:"h-3.5 w-3.5"}),x.label]})]}),e.jsxs("div",{className:"flex flex-wrap items-end gap-6 mb-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-[32px] leading-none font-semibold text-slate-900 dark:text-white",children:t.score.toFixed(0)}),e.jsx("p",{className:"mt-1 text-xs text-slate-500 dark:text-slate-300",children:"Score calculado com base no fluxo de caixa, margem e estrutura de dívidas."})]}),e.jsxs("div",{className:"flex-1 min-w-[160px]",children:[e.jsx("p",{className:"text-xs font-semibold text-slate-700 dark:text-slate-100 mb-1",children:b}),e.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-300",children:x.level})]})]}),t.aiComment&&e.jsxs("div",{className:"mt-2 rounded-xl border border-slate-100 bg-slate-50/80 p-3 text-xs text-slate-700 dark:border-slate-700 dark:bg-slate-900/80 dark:text-slate-100",children:[e.jsx("p",{className:"font-medium mb-1 text-[11px] uppercase tracking-wide text-slate-500 dark:text-slate-300",children:"Comentário do CFO IA"}),e.jsx("p",{children:t.aiComment})]}),e.jsxs("div",{className:"mt-3 flex flex-wrap items-center justify-between gap-2 text-[11px] text-slate-500 dark:text-slate-400",children:[e.jsxs("span",{children:["Runway estimado:"," ",e.jsxs("strong",{className:"text-slate-700 dark:text-slate-100",children:[t.runwayMonths.toFixed(1)," meses"]})]}),e.jsxs("span",{children:["Atualizado em"," ",new Date(t.updatedAt).toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",year:"2-digit"})]})]})]})}function je(){const t=re(),j=le(),{user:L}=H(),{tenantId:u}=O(),{notify:h}=V(),[d,x]=s.useState(""),n=s.useMemo(()=>new Date,[]),b=s.useMemo(()=>{const a=new Date(n);return a.setDate(a.getDate()-30),a},[n]),r=a=>a.toISOString().slice(0,10),m=s.useMemo(()=>u??"",[u]),{data:i,loading:v,error:N,empty:I,refetch:M}=W({tenantId:m,periodStart:r(b),periodEnd:r(n)}),[o,A]=s.useState([]),[k,w]=s.useState(!0),[C,D]=s.useState(null),T=async()=>{w(!0),D(null);try{const a=await G.post("/portal/transactions/filter",{from:r(b),to:r(n),q:null});A(a.data?.transactions||[])}catch(a){console.error("Deep Dive Load Error",a),D(a),h({type:"error",message:"Erro ao carregar detalhes."})}finally{w(!1)}};s.useEffect(()=>{if(!m){A([]),w(!1);return}T()},[b,n,m]);const R=s.useMemo(()=>{if(!d.trim())return o;const a=d.toLowerCase();return o.filter(l=>l.description.toLowerCase().includes(a)||l.category.toLowerCase().includes(a)||l.amount.toString().includes(a)||l.date.includes(a))},[o,d]),P=i?.kpis,B=i?.alerts||[],p=s.useMemo(()=>{const a=o.filter(c=>c.type==="credit").reduce((c,S)=>c+S.amount,0),l=o.filter(c=>c.type==="debit").reduce((c,S)=>c+Math.abs(S.amount),0);return{inflow:a,outflow:l,net:a-l}},[o]),z=()=>{j.pathname.startsWith("/advisor")?t("/advisor"):t(-1)};return e.jsxs("div",{className:"pt-24 space-y-8 pb-20 fade-in","aria-live":"polite",children:[!m&&e.jsx("div",{className:"p-4 rounded-xl border border-amber-200 bg-amber-50 text-amber-700 text-sm font-display",children:"Selecione ou crie um tenant para visualizar os detalhes financeiros."}),e.jsx(X,{title:"Deep Dive Financeiro",subtitle:"Análise detalhada de performance, caixa e movimentações.",actions:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{onClick:z,className:"bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 text-slate-600 dark:text-slate-300 hover:text-slate-800 dark:hover:text-white px-4 py-2 rounded-xl transition-all text-sm font-medium flex items-center gap-2 shadow-sm font-display",children:[e.jsx(Q,{size:16})," Voltar"]}),e.jsx(g,{variant:"neutral",className:"px-3 py-1 bg-white/50 dark:bg-slate-800/50",children:"Últimos 30 dias"})]})}),e.jsx(E,{isLoading:v||k,error:N||C?U(N||C):null,isEmpty:!v&&!k&&(I||o.length===0),emptyTitle:"Sem dados",emptyDescription:"Não encontramos dados financeiros suficientes para gerar o Deep Dive. Importe/conecte transações e tente novamente.",onRetry:()=>{M(),T()},className:"border-none bg-transparent shadow-none",loadingVariant:"skeleton",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsx(y,{label:"Saldo Final (Real)",value:String(P?.cashBalance||"R$ 0,00"),icon:Y,variant:"default"}),e.jsx(y,{label:"Entradas (Período)",value:p.inflow.toLocaleString("pt-BR",{style:"currency",currency:"BRL"}),icon:Z,variant:"success"}),e.jsx(y,{label:"Saídas (Período)",value:p.outflow.toLocaleString("pt-BR",{style:"currency",currency:"BRL"}),icon:_,variant:"danger"}),e.jsx(y,{label:"Resultado Líquido",value:p.net.toLocaleString("pt-BR",{style:"currency",currency:"BRL"}),icon:ee,variant:p.net>=0?"success":"danger",trend:{value:p.net>=0?"Positivo":"Negativo",direction:p.net>=0?"up":"down"}})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-8",children:[e.jsxs(f,{className:"min-h-[320px] flex items-center justify-center relative overflow-hidden border border-slate-200/50 dark:border-white/5 shadow-xl bg-white/50 dark:bg-slate-900/80 backdrop-blur-xl",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-primary/5 to-transparent z-0"}),e.jsxs("div",{className:"text-center z-10 p-6",children:[e.jsx("h3",{className:"text-lg font-bold text-slate-800 dark:text-slate-200 mb-2 font-display",children:"Fluxo de Caixa Diário"}),e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400 mb-4 max-w-xs mx-auto font-display",children:"Visualização gráfica interativa em processamento. Disponível em breve para análise de tendência."}),e.jsx(g,{variant:"neutral",className:"animate-pulse",children:"Aguardando IA"})]})]}),e.jsxs(f,{className:"p-0 overflow-hidden border border-slate-200/50 dark:border-white/5 shadow-xl bg-white/50 dark:bg-slate-900/80 backdrop-blur-xl",children:[e.jsxs("div",{className:"p-6 border-b border-slate-200/50 dark:border-white/5 flex flex-col sm:flex-row justify-between items-center gap-4 bg-slate-50/50 dark:bg-slate-800/50",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-lg text-slate-800 dark:text-slate-200 font-display",children:"Movimentações Detalhadas"}),e.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400 font-display",children:"Cruzamento de dados bancários e categorias"})]}),e.jsxs("div",{className:"relative w-full sm:w-64",children:[e.jsx(ae,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400"}),e.jsx("input",{type:"text",placeholder:"Buscar transações...",value:d,onChange:a=>x(a.target.value),className:"w-full bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-xl pl-10 pr-4 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary transition-all font-display"})]})]}),e.jsx(E,{isLoading:k,error:C,isEmpty:R.length===0,emptyTitle:"Nenhuma transação",emptyDescription:d?"Nenhum resultado para sua busca.":"Sem movimentações no período.",className:"min-h-[400px]",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm text-left",children:[e.jsx("thead",{className:"bg-slate-50/50 dark:bg-slate-800/50 text-slate-500 dark:text-slate-400 font-bold uppercase text-[10px] tracking-widest border-b border-slate-200/50 dark:border-white/5",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4 font-display",children:"Data"}),e.jsx("th",{className:"px-6 py-4 font-display",children:"Descrição"}),e.jsx("th",{className:"px-6 py-4 font-display",children:"Categoria"}),e.jsx("th",{className:"px-6 py-4 text-right font-display",children:"Valor"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-100 dark:divide-white/5",children:R.map((a,l)=>e.jsxs("tr",{className:"hover:bg-primary/5 transition-colors group",children:[e.jsx("td",{className:"px-6 py-4 text-slate-500 dark:text-slate-400 whitespace-nowrap font-display",children:a.date}),e.jsx("td",{className:"px-6 py-4 font-medium text-slate-800 dark:text-slate-200 group-hover:text-primary transition-colors font-display",children:a.description}),e.jsx("td",{className:"px-6 py-4",children:e.jsx(g,{variant:"neutral",className:"bg-slate-100 dark:bg-slate-800 border-slate-200/50 dark:border-white/5 text-[10px]",children:a.category})}),e.jsxs("td",{className:q("px-6 py-4 text-right font-bold font-display",a.type==="credit"?"text-success":"text-slate-800 dark:text-slate-200"),children:[a.type==="debit"?"-":"",Math.abs(a.amount).toLocaleString("pt-BR",{style:"currency",currency:"BRL"})]})]},l))})]})})})]})]}),e.jsxs("div",{className:"lg:col-span-1 space-y-8",children:[e.jsx(ne,{}),e.jsxs(f,{className:"p-6 space-y-6 border border-slate-200/50 dark:border-white/5 shadow-lg bg-white/50 dark:bg-slate-900/80",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-warning/10 text-warning",children:e.jsx(te,{size:20})}),e.jsx("h3",{className:"font-bold text-slate-800 dark:text-slate-200 font-display",children:"Anomalias de Fluxo"})]}),e.jsx(E,{isLoading:v,error:N,loadingVariant:"skeleton",className:"border-none bg-transparent p-0 shadow-none",children:B.length>0?e.jsx("div",{className:"space-y-4",children:B.map(a=>e.jsxs("div",{className:"p-4 bg-warning/5 rounded-xl border border-warning/10 text-sm",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsx("span",{className:"text-[10px] font-bold uppercase tracking-wider text-warning font-display",children:a.type}),e.jsx(g,{variant:"warn",className:"scale-75 origin-right",children:"Pendente"})]}),e.jsx("p",{className:"text-slate-700 dark:text-slate-300 font-medium leading-relaxed font-display",children:a.message})]},a.id))}):e.jsxs("div",{className:"text-center py-6",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-success/10 flex items-center justify-center mx-auto mb-3",children:e.jsx(se,{className:"w-6 h-6 text-success"})}),e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400 font-display",children:"Nenhuma anomalia crítica detectada nos últimos 30 dias."})]})})]}),e.jsxs(f,{className:"p-6 space-y-4 border border-slate-200/50 dark:border-white/5 shadow-lg bg-primary/5 dark:bg-primary/10 border-l-4 border-l-primary",children:[e.jsx("h3",{className:"text-sm font-bold text-primary uppercase tracking-widest font-display",children:"Saúde Operacional"}),e.jsxs("p",{className:"text-sm text-slate-700 dark:text-slate-300 leading-relaxed font-display",children:["Seu runway atual de ",e.jsxs("span",{className:"font-bold",children:[i?.kpis.runwayMonths||0," meses"]})," está dentro da meta saudável e seguro (mais de 6 meses)."]}),e.jsx("div",{className:"pt-2",children:e.jsx("button",{className:"text-[10px] font-bold text-primary hover:underline uppercase tracking-wider font-display",children:"Ver plano de expansão"})})]})]})]})]})}export{je as default};
