import{c as f,r as s,d as _,a as I,j as e,g as B,G as m,S as V,I as W,b as A}from"./index-vVMH2w1Q.js";import{A as K}from"./AIAdvisorPanel-C8G5VOr8.js";import{C as x,L as F,P as G,a as H,b as O,c as $,A as U,p as q,d as J,e as Q,D as X}from"./chart-nOlIXl9_.js";import{S as Y}from"./SectionHeader-C9F8kzLA.js";import{S as g}from"./StatsCard-ClMHKoUE.js";import{A as Z}from"./AsyncPanel-eOZltgkh.js";import{R as ee}from"./refresh-cw-Deg9-xgS.js";import{T as L}from"./trending-up-CSF5TSol.js";import{W as te}from"./wallet-Dp6rPXmN.js";import"./send-D1YDvf5J.js";import"./user-DwLhwvGp.js";const se=[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"m19 9-5 5-4-4-3 3",key:"2osh9i"}]],ae=f("chart-line",se);const ne=[["path",{d:"M21 12c.552 0 1.005-.449.95-.998a10 10 0 0 0-8.953-8.951c-.55-.055-.998.398-.998.95v8a1 1 0 0 0 1 1z",key:"pzmjnu"}],["path",{d:"M21.21 15.89A10 10 0 1 1 8 2.83",key:"k2fpak"}]],re=f("chart-pie",ne);const oe=[["path",{d:"M16 17h6v-6",key:"t6n2it"}],["path",{d:"m22 17-8.5-8.5-5 5L2 7",key:"x473p"}]],ie=f("trending-down",oe);function ce(){const[b,c]=s.useState(()=>typeof document<"u"&&(document.body.classList.contains("dark")||document.body.getAttribute("data-theme")==="dark")?"dark":"light");return s.useEffect(()=>{const u=new MutationObserver(()=>{const a=document.body.classList.contains("dark")||document.body.getAttribute("data-theme")==="dark";c(a?"dark":"light")});return u.observe(document.body,{attributes:!0,attributeFilter:["class","data-theme"]}),()=>u.disconnect()},[]),b}x.register(F,G,H,O,$,U,q,J,Q,X);const ve=()=>{const c=ce()==="dark";_();const{notify:u}=I(),[a,w]=s.useState({balance:0,income:0,expense:0}),[le,P]=s.useState({categories:[],cards:[]}),[y,z]=s.useState([]),[l,j]=s.useState(!0),[D,v]=s.useState(!1),N=s.useRef(null),k=s.useRef(null),C=s.useRef(null),S=s.useRef(null),i=getComputedStyle(document.documentElement),p=[i.getPropertyValue("--chart-1").trim()||"#10b981",i.getPropertyValue("--chart-2").trim()||"#f43f5e",i.getPropertyValue("--chart-3").trim()||"#8b5cf6",i.getPropertyValue("--chart-4").trim()||"#f59e0b",i.getPropertyValue("--chart-5").trim()||"#3b82f6"],d=c?"#94a3b8":"#64748b";async function h(){j(!0);try{const n=(await A.get("/portal/forecast")).data,r=n?.kpis||{balance:0,income:0,expense:0};w(r),P(n?.meta||{categories:[],cards:[]});const o=n?.charts||{months:[],incomeSeries:[],expenseSeries:[],categories:[]};E(o);const T=(r.balance||0)!==0||(r.income||0)!==0||(r.expense||0)!==0,M=(o.months?.length||0)>0||(o.categories?.length||0)>0;v(T||M)}catch(t){console.error("Analytics Load Error:",t),v(!1)}finally{j(!1)}}async function R(){try{const{data:t}=await A.get("/portal/insights/cache").catch(()=>({data:[]}));z(Array.isArray(t)?t:[])}catch{}}function E(t){const n=N.current?.getContext("2d"),r=k.current?.getContext("2d");!n||!r||(C.current?.destroy(),S.current?.destroy(),C.current=new x(n,{type:"line",data:{labels:t.months,datasets:[{label:"Receitas",data:t.incomeSeries,borderColor:p[0],backgroundColor:c?"rgba(16, 185, 129, 0.1)":"rgba(16, 185, 129, 0.05)",borderWidth:2,tension:.4,fill:!0},{label:"Despesas",data:t.expenseSeries,borderColor:p[1],backgroundColor:"transparent",borderWidth:2,tension:.4}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!0,position:"top",align:"end",labels:{color:d,boxWidth:10,usePointStyle:!0,font:{size:10,weight:"bold"}}},tooltip:{backgroundColor:"rgba(15, 23, 42, 0.9)",padding:12,cornerRadius:8}},scales:{y:{grid:{color:"rgba(226, 232, 240, 0.05)"},ticks:{color:d,font:{size:10}}},x:{grid:{display:!1},ticks:{color:d,font:{size:10}}}}}}),S.current=new x(r,{type:"doughnut",data:{labels:t.categories.map(o=>o.category),datasets:[{data:t.categories.map(o=>o.amount),backgroundColor:p,borderColor:"transparent",hoverOffset:4}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"bottom",labels:{color:d,usePointStyle:!0,pointStyle:"circle",font:{size:10}}}},cutout:"70%"}}))}return s.useEffect(()=>{h()},[]),s.useEffect(()=>{l||R()},[l]),e.jsxs("div",{className:"space-y-8 pb-20 fade-in",children:[e.jsx(Y,{title:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(L,{size:24,className:"text-momentum-accent"}),e.jsx("span",{children:"Analytics Financeiro"})]}),subtitle:"Visão estratégica de fluxos, categorias e saúde do negócio.",actions:e.jsxs("button",{onClick:h,className:"flex items-center gap-2 px-3 py-1.5 rounded-lg border border-momentum-border hover:bg-white transition-all text-xs font-bold text-momentum-muted hover:text-momentum-text",children:[e.jsx(ee,{size:14,className:B(l&&"animate-spin")}),"Sincronizar"]})}),e.jsxs("div",{className:"grid gap-8 md:grid-cols-[1fr_360px]",children:[e.jsx("div",{className:"space-y-8",children:e.jsx(Z,{isLoading:l,isEmpty:!D,emptyTitle:"Sem Dados",emptyDescription:"Conecte suas finanças para gerar insights.",onRetry:h,children:e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-6 font-bold",children:[e.jsx(g,{label:"Saldo Projetado",value:a.balance.toLocaleString("pt-BR",{style:"currency",currency:"BRL"}),icon:te,trend:a.balanceTrend?{value:a.balanceTrend,direction:a.balanceTrend.includes("+")?"up":"down"}:void 0}),e.jsx(g,{label:"Receita Mensal",value:a.income.toLocaleString("pt-BR",{style:"currency",currency:"BRL"}),variant:"success",icon:L}),e.jsx(g,{label:"Despesa Mensal",value:a.expense.toLocaleString("pt-BR",{style:"currency",currency:"BRL"}),variant:"danger",icon:ie})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-8",children:[e.jsxs(m,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-6",children:[e.jsx(ae,{size:18,className:"text-momentum-accent"}),e.jsx("h3",{className:"text-sm font-bold text-momentum-text uppercase tracking-widest",children:"Tendência (6 Meses)"})]}),e.jsx("div",{className:"h-[280px]",children:e.jsx("canvas",{ref:N})})]}),e.jsxs(m,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-6",children:[e.jsx(re,{size:18,className:"text-momentum-accent"}),e.jsx("h3",{className:"text-sm font-bold text-momentum-text uppercase tracking-widest",children:"Categorias"})]}),e.jsx("div",{className:"h-[280px]",children:e.jsx("canvas",{ref:k})})]})]}),e.jsxs(m,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(V,{size:18,className:"text-momentum-accent"}),e.jsx("h3",{className:"text-sm font-bold text-momentum-text uppercase tracking-widest",children:"Insights Estratégicos"})]}),e.jsx("button",{onClick:R,className:"text-[10px] font-bold text-momentum-accent uppercase hover:underline",children:"Atualizar IA"})]}),e.jsx("div",{className:"grid gap-4 sm:grid-cols-2",children:y.length?y.map((t,n)=>e.jsx(W,{title:"Análise Relevante",description:t,severity:"info"},n)):e.jsx("div",{className:"col-span-full py-8 text-center text-sm text-momentum-muted italic border-2 border-dashed border-momentum-border rounded-2xl",children:"Nenhum insight disponível no momento."})})]})]})})}),e.jsx("div",{className:"hidden md:block",children:e.jsx(m,{className:"p-0 overflow-hidden sticky top-8 border-none shadow-2xl",children:e.jsx(K,{})})})]})]})};export{ve as AnalyticsDashboard,ve as default};
