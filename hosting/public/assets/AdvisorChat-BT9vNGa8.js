import{c as z,i as P,k as F,r,l as O,m as B,j as e,h as a,G as T,M as R,V as q,n as S,B as H,L as K,b as G}from"./index-CKJzAf41.js";import{S as U}from"./SectionHeader-SIoyBbZT.js";import{A as X}from"./AsyncPanel-EKsCH61J.js";import{T as $}from"./trash-2-CPjjxOzz.js";import{B as L,S as J}from"./send-B-i043n5.js";import{U as Q}from"./user-BZSMoRAh.js";const W=[["path",{d:"M12 19v3",key:"npa21l"}],["path",{d:"M15 9.34V5a3 3 0 0 0-5.68-1.33",key:"1gzdoj"}],["path",{d:"M16.95 16.95A7 7 0 0 1 5 12v-2",key:"cqa7eg"}],["path",{d:"M18.89 13.23A7 7 0 0 0 19 12v-2",key:"16hl24"}],["path",{d:"m2 2 20 20",key:"1ooewy"}],["path",{d:"M9 9v3a3 3 0 0 0 5.12 2.12",key:"r2i35w"}]],Y=z("mic-off",W);const Z=[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["line",{x1:"22",x2:"16",y1:"9",y2:"15",key:"1ewh16"}],["line",{x1:"16",x2:"22",y1:"9",y2:"15",key:"5ykzw1"}]],ee=z("volume-x",Z);async function te(c){return(await G.post("/advisor/session",{messages:c})).data}function le({onClose:c}){const{features:v,voiceProfiles:w}=P(),m=v||{advisor:!0,voiceTTS:!1,voiceSTT:!1},A=F(),[o,i]=r.useState([{role:"assistant",content:"Olá! Sou seu Advisor Momentum. Me conte o que está tirando o sono do seu caixa hoje.",timestamp:new Date().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}]),[u,x]=r.useState(""),[n,y]=r.useState(!1),[M]=r.useState(!1),p=r.useRef(null),{speak:j,stop:_,loading:g}=O(),{start:C,stop:D,transcript:h,recording:l}=B();r.useEffect(()=>{!h||h==="​"||x(h)},[h]),r.useEffect(()=>{p.current&&(p.current.scrollTop=p.current.scrollHeight)},[o]);const k=async()=>{const t=u.trim();if(!t||n)return;const b=new Date().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),N=[...o,{role:"user",content:t,timestamp:b}];i(N),x(""),y(!0);try{if(!A){i(s=>[...s,{role:"assistant",content:"Você precisa estar autenticado para usar o Advisor. Faça login e tente novamente.",timestamp:new Date().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}]);return}const d=await te(N.map(s=>({role:s.role,content:s.content}))),f={role:"assistant",content:d.reply,timestamp:new Date().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})};i(s=>[...s,f]),m.voiceTTS&&await j({text:d.reply,voice:S("neural",w,"advisor")})}catch(d){const f=d?.code==="NO_CREDITS"?"Você ficou sem créditos de IA neste plano. Atualize seu plano ou aguarde a renovação dos créditos.":d?.message||"Erro ao processar resposta.";i(s=>[...s,{role:"assistant",content:f,timestamp:new Date().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}])}finally{y(!1)}},E=t=>{t.key==="Enter"&&!t.shiftKey&&(t.preventDefault(),k())},I=()=>{m.voiceSTT&&(l?D():(x(""),C()))},V=()=>{i([{role:"assistant",content:"Chat reiniciado. Como posso ajudar agora?",timestamp:new Date().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}])};return e.jsxs("div",{className:"flex flex-col h-full overflow-hidden bg-transparent",children:[e.jsx("div",{className:"px-6 pt-2 pb-4",children:e.jsx(U,{title:"CFO Advisor",subtitle:"Insights em tempo real para sua gestão financeira.",actions:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:V,className:"p-2 rounded-lg hover:bg-momentum-accent/10 text-momentum-muted hover:text-momentum-accent transition-colors",title:"Limpar conversa","aria-label":"Limpar conversa",children:e.jsx($,{size:18})}),c&&e.jsx("button",{onClick:c,className:"px-3 py-1.5 rounded-lg border border-momentum-border text-xs font-medium hover:bg-white transition-all shadow-sm",children:"Fechar"})]})})}),e.jsxs("div",{ref:p,className:"flex-1 overflow-y-auto px-6 py-4 space-y-6 scroll-smooth scrollbar-none",children:[e.jsx(X,{isLoading:M,isEmpty:o.length===0,emptyTitle:"Sem mensagens",emptyDescription:"Inicie uma conversa com seu advisor.",emptyIcon:e.jsx(L,{}),className:"border-none bg-transparent shadow-none p-0",children:o.map((t,b)=>e.jsx("div",{className:a("flex w-full mb-6 last:mb-0 animate-in fade-in slide-in-from-bottom-2 duration-300",t.role==="assistant"?"justify-start":"justify-end"),children:e.jsxs("div",{className:a("flex gap-3 max-w-[85%] md:max-w-[75%]",t.role==="assistant"?"flex-row":"flex-row-reverse"),children:[e.jsx("div",{className:a("hidden sm:flex h-8 w-8 rounded-full items-center justify-center shrink-0 mt-1 shadow-sm",t.role==="assistant"?"bg-gradient-to-br from-momentum-accent to-blue-600 text-white":"bg-white border border-momentum-border text-momentum-text"),children:t.role==="assistant"?e.jsx(L,{size:16}):e.jsx(Q,{size:16})}),e.jsxs("div",{className:"flex flex-col gap-1.5",children:[t.role==="assistant"?e.jsx(T,{className:a("px-4 py-3 rounded-2xl text-[13px] leading-relaxed shadow-sm border-none backdrop-blur-md","bg-white/80 dark:bg-slate-900/40 rounded-tl-none ring-1 ring-momentum-border/30"),children:e.jsx("p",{className:"whitespace-pre-wrap text-slate-800 dark:text-slate-200",children:t.content})}):e.jsx("div",{className:a("px-4 py-3 rounded-2xl text-[13px] leading-relaxed shadow-sm border-none backdrop-blur-md","bg-primary text-white rounded-tr-none shadow-momentum-glow"),children:e.jsx("p",{className:"whitespace-pre-wrap",children:t.content})}),t.timestamp&&e.jsx("span",{className:a("text-[10px] opacity-40 font-semibold uppercase tracking-wider",t.role==="user"?"text-right":"text-left"),children:t.timestamp})]})]})},b))}),n&&e.jsx("div",{className:"flex justify-start animate-pulse",children:e.jsxs("div",{className:"flex gap-3 items-start",children:[e.jsx("div",{className:"h-8 w-8 rounded-full bg-slate-200 dark:bg-slate-800 shrink-0 shadow-sm"}),e.jsx(T,{className:"px-5 py-3 rounded-2xl rounded-tl-none bg-slate-100/50 dark:bg-slate-800/30 border-none shadow-none",children:e.jsxs("div",{className:"flex gap-1.5 items-center h-4",children:[e.jsx("span",{className:"w-1.5 h-1.5 bg-momentum-muted rounded-full animate-bounce [animation-delay:-0.3s]"}),e.jsx("span",{className:"w-1.5 h-1.5 bg-momentum-muted rounded-full animate-bounce [animation-delay:-0.15s]"}),e.jsx("span",{className:"w-1.5 h-1.5 bg-momentum-muted rounded-full animate-bounce"})]})})]})}),e.jsx("div",{className:"h-4"})," "]}),e.jsx("div",{className:"px-6 py-4 border-t border-slate-200 dark:border-white/10 bg-white/80 dark:bg-slate-950/80 backdrop-blur-xl sticky bottom-0 z-10 shadow-[0_-4px_20px_-10px_rgba(0,0,0,0.1)] dark:shadow-[0_-4px_20px_-10px_rgba(0,0,0,0.5)]",children:e.jsxs("div",{className:"max-w-4xl mx-auto space-y-4 pb-[env(safe-area-inset-bottom)]",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{onClick:I,disabled:!m.voiceSTT||n,className:a("flex items-center gap-2 px-3.5 py-1.5 rounded-full text-[10px] font-bold uppercase tracking-widest transition-all",l?"bg-red-500 text-white shadow-lg animate-pulse":"bg-primary/10 text-primary hover:bg-primary/20 border border-primary/20"),"aria-label":l?"Parar de ouvir":"Falar com advisor",children:[l?e.jsx(Y,{size:14,className:"animate-pulse"}):e.jsx(R,{size:14}),l?"Ouvindo...":"Voz"]}),m.voiceTTS&&e.jsx("button",{onClick:g?_:()=>j({text:o[o.length-1]?.content,voice:S("neural",w,"advisor")}),className:"p-2 rounded-full hover:bg-slate-100 dark:hover:bg-white/5 text-slate-400 hover:text-slate-600 dark:hover:text-white transition-colors",title:g?"Parar leitura":"Ouvir resposta",children:g?e.jsx(ee,{size:16,className:"text-red-500 animate-pulse"}):e.jsx(q,{size:16})}),e.jsx(H,{variant:"neutral",className:"ml-auto text-[9px] font-bold tracking-tighter bg-slate-100 dark:bg-slate-900 border-slate-200 dark:border-white/10 text-slate-500 dark:text-slate-400",children:"Advisor Premium v2"})]}),e.jsx("div",{className:"relative flex items-end gap-2",children:e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("textarea",{rows:1,value:u,onChange:t=>x(t.target.value),onKeyDown:E,placeholder:"Pergunte sobre seus saldos, categorias ou anomalias...","aria-label":"Mensagem para o Advisor",className:a("w-full bg-slate-100 dark:bg-slate-900/50 border border-slate-200 dark:border-white/10 rounded-2xl px-5 py-3.5 pr-14 text-sm leading-relaxed text-slate-900 dark:text-slate-100 placeholder:text-slate-500","focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary/50 transition-all","resize-none min-h-[52px] max-h-36 scrollbar-none shadow-inner")}),e.jsx("button",{onClick:k,disabled:n||!u.trim(),className:a("absolute right-2.5 bottom-2.5 h-9 w-9 rounded-xl flex items-center justify-center transition-all shadow-md",n||!u.trim()?"bg-slate-800 text-slate-600 shadow-none cursor-not-allowed":"bg-primary text-white shadow-glow hover:scale-105 active:scale-95"),"aria-label":"Enviar mensagem",children:n?e.jsx(K,{size:18,className:"animate-spin"}):e.jsx(J,{size:18})})]})}),e.jsx("p",{className:"text-[10px] text-momentum-muted text-center italic opacity-60",children:"Inteligência contextual baseada em seu histórico financeiro real."})]})})]})}export{le as A};
