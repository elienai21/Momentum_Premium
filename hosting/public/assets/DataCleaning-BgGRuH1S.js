import{c as k,a as f,b as D,r as l,j as e,L as m}from"./index-Cs_F5hSh.js";import{R as M,T as q}from"./triangle-alert-DSeOGwHz.js";const E=[["path",{d:"M13 5h8",key:"a7qcls"}],["path",{d:"M13 12h8",key:"h98zly"}],["path",{d:"M13 19h8",key:"c3s6r1"}],["path",{d:"m3 17 2 2 4-4",key:"1jhpwq"}],["path",{d:"m3 7 2 2 4-4",key:"1obspn"}]],G=k("list-checks",E);const V=[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]],$=k("trash-2",V);async function z(){const{data:r}=await f.get("/dedup/transactions/preview");return r}async function A(r){const{data:n}=await f.post("/dedup/transactions/cleanup",{deleteIds:r});return n}const I=()=>{const{notify:r}=D(),[n,p]=l.useState(!1),[h,u]=l.useState(null),[c,N]=l.useState([]),[y,w]=l.useState(0),[o,i]=l.useState(new Set),[g,b]=l.useState(!1);async function x(){p(!0),u(null);try{const a=await z();N(a.groups||[]),w(a.totalScanned||0),i(new Set)}catch(a){u(a?.message||"Não foi possível analisar duplicidades agora. Tente novamente.")}finally{p(!1)}}l.useEffect(()=>{x()},[]);const v=a=>{i(s=>{const t=new Set(s);return t.has(a)?t.delete(a):t.add(a),t})},S=(a,s)=>{i(t=>{const d=new Set(t);return a.ids.forEach(j=>{s?d.add(j):d.delete(j)}),d})},L=a=>a.ids.every(s=>o.has(s)),R=async()=>{const a=Array.from(o);if(!a.length){r({type:"warning",message:"Selecione pelo menos uma transação duplicada para remover."});return}if(window.confirm(`Você está prestes a remover ${a.length} transação(ões) marcada(s) como duplicadas.

Essa ação não pode ser desfeita. Deseja continuar?`))try{b(!0);const t=await A(a);r({type:"success",message:`Remoção concluída: ${t.deleted} transação(ões) excluída(s).`}),await x()}catch(t){r({type:"error",message:t?.message||"Não foi possível remover as duplicadas. Tente novamente."})}finally{b(!1)}},T=c.length,C=c.reduce((a,s)=>a+(s.docs?.length||0),0);return e.jsxs("main",{className:"p-6 space-y-6","aria-live":"polite",children:[e.jsxs("header",{className:"flex flex-col gap-2 md:flex-row md:items-center md:justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-semibold text-slate-900 dark:text-slate-50",children:"Auditoria & Limpeza de Transações"}),e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400 max-w-2xl",children:"Visualize e limpe transações potencialmente duplicadas. Agrupamos lançamentos com mesma data, valor e descrição para facilitar sua conferência."})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 mt-2 md:mt-0",children:[e.jsx("button",{type:"button",onClick:()=>void x(),disabled:n,className:"inline-flex items-center gap-2 rounded-xl border border-slate-200 bg-white/90 px-3 py-2 text-xs font-medium text-slate-700 hover:bg-slate-50 dark:border-slate-700 dark:bg-slate-900/80 dark:text-slate-100 dark:hover:bg-slate-800/80",children:n?e.jsxs(e.Fragment,{children:[e.jsx(m,{className:"h-4 w-4 animate-spin"}),"Recalculando…"]}):e.jsxs(e.Fragment,{children:[e.jsx(M,{className:"h-4 w-4"}),"Reanalisar duplicadas"]})}),e.jsx("button",{type:"button",onClick:R,disabled:g||o.size===0,className:"inline-flex items-center gap-2 rounded-xl border border-rose-200 bg-rose-500/90 px-3 py-2 text-xs font-medium text-white hover:bg-rose-600 disabled:opacity-40 dark:border-rose-500/60",children:g?e.jsxs(e.Fragment,{children:[e.jsx(m,{className:"h-4 w-4 animate-spin"}),"Removendo…"]}):e.jsxs(e.Fragment,{children:[e.jsx($,{className:"h-4 w-4"}),"Remover selecionadas (",o.size,")"]})})]})]}),e.jsxs("section",{className:"grid gap-3 sm:grid-cols-3",children:[e.jsxs("div",{className:"rounded-2xl border border-slate-200 bg-white/90 p-4 shadow-sm dark:border-slate-700 dark:bg-slate-900/80",children:[e.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-slate-500 dark:text-slate-400",children:"Lançamentos analisados"}),e.jsx("p",{className:"mt-1 text-2xl font-bold text-slate-900 dark:text-slate-50",children:y.toLocaleString("pt-BR")}),e.jsx("p",{className:"mt-1 text-[11px] text-slate-500 dark:text-slate-400",children:"Considerando os últimos lançamentos importados."})]}),e.jsxs("div",{className:"rounded-2xl border border-slate-200 bg-white/90 p-4 shadow-sm dark:border-slate-700 dark:bg-slate-900/80",children:[e.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-slate-500 dark:text-slate-400",children:"Grupos de duplicidade"}),e.jsx("p",{className:"mt-1 text-2xl font-bold text-slate-900 dark:text-slate-50",children:T}),e.jsx("p",{className:"mt-1 text-[11px] text-slate-500 dark:text-slate-400",children:"Cada grupo representa lançamentos com mesma impressão digital."})]}),e.jsxs("div",{className:"rounded-2xl border border-slate-200 bg-white/90 p-4 shadow-sm dark:border-slate-700 dark:bg-slate-900/80",children:[e.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-slate-500 dark:text-slate-400",children:"Transações duplicadas"}),e.jsx("p",{className:"mt-1 text-2xl font-bold text-slate-900 dark:text-slate-50",children:C}),e.jsx("p",{className:"mt-1 text-[11px] text-slate-500 dark:text-slate-400",children:"Selecione o que deseja remover, mantendo um registro por grupo."})]})]}),h&&e.jsxs("div",{className:"rounded-2xl border border-amber-300 bg-amber-50 px-4 py-3 text-xs text-amber-800 dark:border-amber-500/60 dark:bg-amber-900/30 dark:text-amber-100 flex items-start gap-2",children:[e.jsx(q,{className:"h-4 w-4 mt-0.5 flex-shrink-0"}),e.jsx("span",{children:h})]}),n?e.jsxs("div",{className:"flex items-center gap-2 text-sm text-slate-500 dark:text-slate-400",children:[e.jsx(m,{className:"h-4 w-4 animate-spin"}),"Analisando transações em busca de duplicadas…"]}):c.length===0?e.jsxs("section",{className:"rounded-2xl border border-slate-200 bg-white/90 p-6 text-sm text-slate-600 dark:border-slate-700 dark:bg-slate-900/80 dark:text-slate-300 flex items-start gap-3",children:[e.jsx(G,{className:"h-5 w-5 text-emerald-500 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-slate-800 dark:text-slate-100",children:"Nenhuma duplicidade relevante encontrada."}),e.jsx("p",{className:"mt-1 text-xs",children:"No momento não encontramos grupos com lançamentos repetidos. Sempre que você importar novos extratos, volte aqui para rodar uma nova análise."})]})]}):e.jsx("section",{className:"space-y-4",children:c.map((a,s)=>e.jsxs("div",{className:"rounded-2xl border border-slate-200 bg-white/95 p-4 shadow-sm dark:border-slate-700 dark:bg-slate-900/90",children:[e.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between mb-3",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-xs font-semibold uppercase tracking-wide text-slate-500 dark:text-slate-400",children:["Grupo #",s+1]}),e.jsx("p",{className:"text-sm font-medium text-slate-900 dark:text-slate-50",children:a.sample.description||"Sem descrição"}),e.jsxs("p",{className:"text-[11px] text-slate-500 dark:text-slate-400",children:[a.sample.date?`Data: ${a.sample.date} · `:"","Valor:"," ",a.sample.amount.toLocaleString("pt-BR",{style:"currency",currency:"BRL"})," ","· Tipo: ",a.sample.type||"—"]})]}),e.jsxs("div",{className:"flex flex-col items-start gap-1 sm:items-end",children:[e.jsxs("p",{className:"text-[11px] text-slate-500 dark:text-slate-400",children:[a.count," lançamentos com a mesma impressão digital"]}),e.jsxs("label",{className:"inline-flex items-center gap-2 text-[11px] text-slate-600 dark:text-slate-300 cursor-pointer",children:[e.jsx("input",{type:"checkbox",className:"h-3.5 w-3.5 rounded border-slate-300 text-emerald-500",checked:L(a),onChange:t=>S(a,t.target.checked)}),"Selecionar todo o grupo"]})]})]}),e.jsx("div",{className:"overflow-x-auto rounded-xl border border-slate-100 dark:border-slate-800",children:e.jsxs("table",{className:"min-w-full text-xs",children:[e.jsx("thead",{className:"bg-slate-50 dark:bg-slate-900/70 text-slate-500 dark:text-slate-300",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-2 text-left w-8"}),e.jsx("th",{className:"px-3 py-2 text-left",children:"Data"}),e.jsx("th",{className:"px-3 py-2 text-left",children:"Descrição"}),e.jsx("th",{className:"px-3 py-2 text-left",children:"Tipo"}),e.jsx("th",{className:"px-3 py-2 text-right",children:"Valor"}),e.jsx("th",{className:"px-3 py-2 text-left",children:"ID interno"})]})}),e.jsx("tbody",{children:a.docs.map(t=>{const d=o.has(t.id);return e.jsxs("tr",{className:`border-t border-slate-100 dark:border-slate-800 ${d?"bg-emerald-50/60 dark:bg-emerald-900/20":"bg-white dark:bg-slate-900/60"}`,children:[e.jsx("td",{className:"px-3 py-2 align-middle",children:e.jsx("input",{type:"checkbox",className:"h-3.5 w-3.5 rounded border-slate-300 text-emerald-500",checked:d,onChange:()=>v(t.id)})}),e.jsx("td",{className:"px-3 py-2 align-middle text-slate-700 dark:text-slate-200",children:t.date||"—"}),e.jsx("td",{className:"px-3 py-2 align-middle text-slate-700 dark:text-slate-200",children:t.description||"—"}),e.jsx("td",{className:"px-3 py-2 align-middle text-slate-700 dark:text-slate-200",children:t.type||"—"}),e.jsx("td",{className:`px-3 py-2 align-middle text-right font-medium ${t.amount>=0?"text-emerald-600 dark:text-emerald-400":"text-rose-600 dark:text-rose-400"}`,children:t.amount.toLocaleString("pt-BR",{style:"currency",currency:"BRL"})}),e.jsx("td",{className:"px-3 py-2 align-middle text-[10px] text-slate-400 dark:text-slate-500",children:t.id})]},t.id)})})]})}),e.jsx("p",{className:"mt-2 text-[11px] text-slate-500 dark:text-slate-400",children:"Sugestão: normalmente você mantém apenas 1 lançamento por grupo (o registro original) e apaga os demais. Use a seleção por grupo ou marque manualmente o que deseja remover."})]},a.fingerprint))})]})};export{I as default};
