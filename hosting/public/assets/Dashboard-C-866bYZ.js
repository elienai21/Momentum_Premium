import{c as E,r as c,j as e,u as W,X as z,a as I,b as B,t as $,d as J,e as Y,f as oe,C as U,L as ie,g as de}from"./index-Cs_F5hSh.js";import{A as ce}from"./AdvisorChat-BpLqgt2F.js";import{T as q,R}from"./triangle-alert-DSeOGwHz.js";const me=[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]],xe=E("activity",me);const ue=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],V=E("circle-check",ue);const pe=[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],G=E("clock",pe);const he=[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]],be=E("dollar-sign",he);const ge=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]],fe=E("file-text",ge);const je=[["path",{d:"M12 16h.01",key:"1drbdi"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M15.312 2a2 2 0 0 1 1.414.586l4.688 4.688A2 2 0 0 1 22 8.688v6.624a2 2 0 0 1-.586 1.414l-4.688 4.688a2 2 0 0 1-1.414.586H8.688a2 2 0 0 1-1.414-.586l-4.688-4.688A2 2 0 0 1 2 15.312V8.688a2 2 0 0 1 .586-1.414l4.688-4.688A2 2 0 0 1 8.688 2z",key:"1fd625"}]],Z=E("octagon-alert",je);const Ne=[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],_=E("settings",Ne);const ve=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],ye=E("shield-check",ve);const we=[["path",{d:"M16 17h6v-6",key:"t6n2it"}],["path",{d:"m22 17-8.5-8.5-5 5L2 7",key:"x473p"}]],ke=E("trending-down",we);const Ce=[["path",{d:"M16 7h6v6",key:"box55l"}],["path",{d:"m22 7-8.5 8.5-5-5L2 17",key:"1t1m79"}]],Se=E("trending-up",Ce);function O({label:s,value:a,suffix:r,variant:o="neutral",compact:t=!1,className:n="",precision:l=0,icon:d,helpText:i,ariaLabel:u}){const m=c.useId(),h=(...x)=>x.filter(Boolean).join(" "),b={neutral:{label:"text-slate-500 dark:text-slate-300",ring:"ring-slate-200 dark:ring-white/10",dot:"bg-slate-300 dark:bg-slate-500",value:"text-slate-900 dark:text-slate-100",help:"text-slate-500 dark:text-slate-400"},success:{label:"text-emerald-700 dark:text-emerald-300",ring:"ring-emerald-200/70 dark:ring-emerald-500/30",dot:"bg-emerald-400",value:"text-emerald-900 dark:text-emerald-200",help:"text-emerald-700/80 dark:text-emerald-300/80"},warning:{label:"text-amber-700 dark:text-amber-300",ring:"ring-amber-200/70 dark:ring-amber-500/30",dot:"bg-amber-400",value:"text-amber-900 dark:text-amber-200",help:"text-amber-700/80 dark:text-amber-300/80"},danger:{label:"text-rose-700 dark:text-rose-300",ring:"ring-rose-200/70 dark:ring-rose-500/30",dot:"bg-rose-400",value:"text-rose-900 dark:text-rose-200",help:"text-rose-700/80 dark:text-rose-300/80"},info:{label:"text-sky-700 dark:text-sky-300",ring:"ring-sky-200/70 dark:ring-sky-500/30",dot:"bg-sky-400",value:"text-sky-900 dark:text-sky-200",help:"text-sky-700/80 dark:text-sky-300/80"}},j=a.toLocaleString("pt-BR",{minimumFractionDigits:l,maximumFractionDigits:l});return e.jsxs("section",{role:"group","aria-labelledby":m,"aria-label":u,className:h("rounded-2xl border bg-white/80 backdrop-blur-xl shadow-sm","dark:bg-[rgba(14,18,28,0.65)] dark:border-white/10","ring-1 "+b[o].ring,t?"p-3":"p-4",n),children:[e.jsxs("div",{className:"flex items-center gap-2",children:[d&&e.jsx("div",{className:h("inline-flex h-6 w-6 items-center justify-center rounded-full","bg-white/70 dark:bg-white/10 shadow-sm"),"aria-hidden":"true",children:d}),e.jsx("h3",{id:m,className:h("text-sm font-medium tracking-wide",b[o].label),children:s})]}),e.jsxs("div",{className:"mt-1 flex items-baseline gap-1",children:[e.jsx("div",{className:h("text-2xl font-semibold",b[o].value),children:j}),r&&e.jsx("span",{className:"text-sm text-slate-500 dark:text-slate-400",children:r}),e.jsx("span",{className:h("ml-auto h-1.5 w-1.5 rounded-full",b[o].dot),"aria-hidden":"true"})]}),i&&e.jsx("p",{className:h("mt-1 text-xs",b[o].help),children:i})]})}function Ee(){return e.jsxs("div",{className:"p-4 bg-white rounded-xl border animate-pulse","data-testid":"kpi-skeleton",children:[e.jsx("div",{className:"h-3 w-20 bg-slate-200 rounded mb-3"}),e.jsx("div",{className:"h-7 w-24 bg-slate-200 rounded mb-1"}),e.jsx("div",{className:"h-3 w-16 bg-slate-100 rounded"})]})}const D=({title:s,description:a,icon:r,actionLabel:o,onActionClick:t,primaryActionLabel:n,onPrimaryAction:l,secondaryActionLabel:d,onSecondaryAction:i,className:u="",descriptionId:m})=>{const h=c.useRef(null),b=n??o,j=l??t,x=!!(b&&j),v=!!(d&&i);c.useEffect(()=>{if(x){const g=setTimeout(()=>h.current?.focus(),0);return()=>clearTimeout(g)}},[x]);const p=(...g)=>g.filter(Boolean).join(" "),N=m||"empty-desc";return e.jsxs("section",{className:p("relative z-0","flex flex-col items-center justify-center text-center","rounded-2xl border border-slate-200 bg-white/90 p-8 shadow-sm","dark:bg-[rgba(14,18,28,0.65)] dark:border-white/10",u),role:"region","aria-live":"polite","aria-describedby":a?N:void 0,children:[r&&e.jsx("div",{className:p("mb-3 flex h-12 w-12 items-center justify-center rounded-2xl","bg-slate-50 text-2xl shadow-inner","dark:bg-white/5"),"aria-hidden":"true",children:r}),e.jsx("h2",{className:"text-base font-semibold tracking-tight text-slate-900 dark:text-slate-100",children:s}),a&&e.jsx("p",{id:N,className:"mt-1 max-w-[60ch] text-sm text-slate-500 dark:text-slate-300",children:a}),(x||v)&&e.jsxs("div",{className:"mt-4 flex flex-wrap items-center justify-center gap-2",children:[x&&e.jsx("button",{ref:h,type:"button",onClick:j,className:"inline-flex items-center rounded-xl bg-slate-900 px-3 py-2 text-xs font-medium text-white shadow-sm transition hover:bg-black/90 focus:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-slate-500 dark:bg-emerald-600 dark:hover:bg-emerald-500",children:b}),v&&e.jsx("button",{type:"button",onClick:i,className:"inline-flex items-center rounded-xl border border-slate-300 bg-white px-3 py-2 text-xs font-medium text-slate-700 hover:bg-slate-50 dark:border-slate-700 dark:bg-slate-900 dark:text-slate-200 dark:hover:bg-slate-800",children:d})]})]})};function Ae(s){if(!s)return;const a=s?.response?.status??s?.status;if(typeof a=="number")return a}function ee(s){switch(Ae(s)){case 401:return{title:"Sua sessÃ£o expirou",message:"Entre novamente para continuar vendo seus dados financeiros.",ctaLabel:"Fazer login",ctaHref:"/login"};case 403:return{title:"Recurso nÃ£o disponÃ­vel no seu plano",message:"Este recurso faz parte de um plano superior do Momentum. Veja os planos disponÃ­veis.",ctaLabel:"Ver planos",ctaHref:"/planos"};case 404:return{title:"Nenhum dado encontrado",message:"NÃ£o encontramos dados para este perÃ­odo. Tente outro filtro ou importe seus dados financeiros."};case 500:return{title:"Erro inesperado",message:"Ocorreu um erro interno. JÃ¡ registramos isso. Tente novamente em alguns instantes."};default:return{title:"Algo nÃ£o saiu como esperado",message:"Tivemos um problema para carregar essas informaÃ§Ãµes. Tente novamente. Se persistir, fale com o suporte."}}}function Ie({data:s,loading:a,error:r,empty:o,onOpenAdvisor:t,onSimulate:n,onImportClick:l}){if(a)return e.jsx("section",{className:"space-y-4",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:Array.from({length:4}).map((i,u)=>e.jsx(Ee,{},u))})});if(r){const i=ee(r);return e.jsx("section",{className:"space-y-3",children:e.jsx(D,{title:i.title,description:i.message,actionLabel:i.ctaLabel,onActionClick:i.ctaHref?()=>window.location.href=i.ctaHref:void 0,icon:"âš ï¸",variant:"subtle"})})}if(o||!s)return e.jsxs("section",{className:"space-y-4",children:[e.jsx(D,{title:"Seu Pulse ainda estÃ¡ em branco",description:"Ainda nÃ£o temos dados financeiros suficientes para gerar seu Pulse. Importe suas transaÃ§Ãµes para comeÃ§ar a enxergar o momento da sua empresa.",actionLabel:"Importar agora",onActionClick:l,icon:"ðŸ“Š"}),e.jsx("div",{className:"mt-2 text-xs text-slate-500",children:"Assim que seus dados forem importados e processados, vocÃª verÃ¡ aqui KPIs, grÃ¡ficos de caixa, receita, despesas e runway."})]});const{kpis:d}=s;return e.jsxs("section",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(O,{label:"Saldo em caixa",value:d.cashBalance}),e.jsx(O,{label:"Receita do mÃªs",value:d.revenueMonth}),e.jsx(O,{label:"Despesas do mÃªs",value:d.expenseMonth}),e.jsx(O,{label:"Runway (meses)",value:d.runwayMonths,suffix:"m"})]}),e.jsxs("div",{className:"flex flex-wrap justify-end gap-2 text-xs",children:[n&&e.jsx("button",{type:"button",onClick:n,className:"rounded-xl border px-3 py-2 hover:bg-slate-50",children:"Simular cenÃ¡rio"}),t&&e.jsx("button",{type:"button",onClick:t,className:"rounded-xl border px-3 py-2 hover:bg-slate-50",children:"Perguntar ao Advisor"})]})]})}function Fe({open:s,onClose:a,title:r="Advisor"}){const o=c.useRef(null),t=c.useRef(null);return W(o,s),c.useEffect(()=>{function n(l){l.key==="Escape"&&s&&a()}return window.addEventListener("keydown",n),()=>window.removeEventListener("keydown",n)},[s,a]),c.useEffect(()=>{const n=document.body.style.overflow;return s&&(document.body.style.overflow="hidden"),()=>{document.body.style.overflow=n}},[s]),c.useEffect(()=>{s&&t.current?.focus()},[s]),e.jsxs(e.Fragment,{children:[e.jsx("div",{className:`fixed inset-0 z-[60] bg-black/20 backdrop-blur-sm transition-opacity ${s?"opacity-100 pointer-events-auto":"opacity-0 pointer-events-none"}`,"aria-hidden":!s,onClick:a}),e.jsxs("div",{ref:o,role:"dialog","aria-modal":"true","aria-labelledby":"advisor-dock-title",className:`fixed inset-y-0 right-0 z-[70] w-full max-w-lg bg-white border-l shadow-2xl transition-transform duration-300 ${s?"translate-x-0":"translate-x-full"}`,children:[e.jsxs("div",{className:"flex items-center justify-between border-b p-4",children:[e.jsx("h2",{id:"advisor-dock-title",className:"text-sm font-medium text-slate-700",children:r}),e.jsx("button",{ref:t,onClick:a,"aria-label":"Fechar chat do Advisor",className:"rounded-lg p-2 hover:bg-slate-50 focus:outline-none focus:ring-2 focus:ring-slate-300",children:e.jsx(z,{className:"h-5 w-5"})})]}),e.jsx("div",{className:"h-[calc(100%-56px)]",children:e.jsx(ce,{})})]})]})}function se({open:s,onClose:a,feature:r,plan:o}){if(!s)return null;const t=r==="cfo_simulation"?"SimulaÃ§Ãµes avanÃ§adas do CFO":r==="cfo_ai_report"?"RelatÃ³rios de IA do CFO":"Funcionalidade avanÃ§ada do CFO",n=o?o.toUpperCase():"atual",l=()=>{typeof window<"u"&&window.dispatchEvent(new Event("open-support-dock")),a()};return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm",role:"dialog","aria-modal":"true","aria-labelledby":"upgrade-title",children:e.jsxs("div",{className:"w-full max-w-md rounded-2xl border border-amber-400/40 bg-slate-950/95 p-5 shadow-xl shadow-black/70",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("h2",{id:"upgrade-title",className:"text-sm font-semibold text-amber-100",children:"Recurso disponÃ­vel em um plano superior"}),e.jsxs("p",{className:"mt-1 text-xs text-slate-200",children:["VocÃª tentou acessar:"," ",e.jsx("span",{className:"font-semibold text-amber-200",children:t}),"."]})]}),e.jsx("button",{type:"button",onClick:a,className:"inline-flex h-7 w-7 items-center justify-center rounded-full border border-slate-700 text-slate-400 hover:text-slate-100 hover:bg-slate-900","aria-label":"Fechar",children:e.jsx(z,{className:"h-3.5 w-3.5"})})]}),e.jsxs("div",{className:"mt-3 rounded-xl border border-slate-800 bg-slate-900/80 p-3 text-[11px] text-slate-200 space-y-1.5",children:[e.jsxs("p",{children:["No seu plano ",e.jsx("span",{className:"font-semibold",children:n}),", esse recurso ainda nÃ£o estÃ¡ liberado."]}),e.jsxs("p",{children:["Para desbloquear simulaÃ§Ãµes completas e relatÃ³rios estratÃ©gicos do CFO IA, vocÃª pode falar com o suporte e solicitar o plano"," ",e.jsx("span",{className:"font-semibold text-amber-200",children:"Momentum CFO Pro"}),"."]})]}),e.jsxs("div",{className:"mt-4 flex justify-end gap-2",children:[e.jsx("button",{type:"button",onClick:a,className:"rounded-xl border border-slate-700 bg-slate-900/80 px-3 py-1.5 text-xs text-slate-200 hover:bg-slate-800",children:"Agora nÃ£o"}),e.jsx("button",{type:"button",onClick:l,className:"rounded-xl bg-amber-500 px-4 py-1.5 text-xs font-semibold text-slate-950 shadow hover:bg-amber-400",children:"Falar com o suporte"})]})]})})}async function ae(){const{data:s}=await I.get("/cfo/health");if(!s.health)throw new Error("Resposta da API de CFO sem campo health.");return s.health}const te={getHealth:ae,simulate:async s=>{const{data:a}=await I.post("/cfo/simulate",s);return a},simulateAdvanced:async s=>{const{data:a}=await I.post("/cfo/simulate/advanced",s);return a},getAiReport:async s=>{const a=typeof s=="number"&&s>0?{periodDays:s}:{},{data:r}=await I.post("/cfo/ai-report",a);if(r.status!=="ok")throw new Error("Falha ao gerar relatÃ³rio do CFO IA.");return{report:r.report,meta:r.meta}}},K={incDeltaPct:0,expDeltaPct:0,oneOffIncome:0,oneOffExpense:0},Me=({open:s,onClose:a,baseline:r,onConfirm:o})=>{const t=c.useRef(null);W(t,s);const{notify:n}=B(),[l,d]=c.useState(K),[i,u]=c.useState(!1),[m,h]=c.useState(null),[b,j]=c.useState(!1),[x,v]=c.useState(null);if(c.useEffect(()=>{s&&(d(K),h(null),j(!1),v(null))},[s]),!s)return null;const p=w=>k=>{const S=k.target.value;d(A=>({...A,[w]:S===""?void 0:Number(S)}))},N=async w=>{w.preventDefault(),u(!0);try{const k={incDeltaPct:l.incDeltaPct??0,expDeltaPct:l.expDeltaPct??0,oneOffIncome:l.oneOffIncome??0,oneOffExpense:l.oneOffExpense??0};$("cfo_simulate_submit",k);const S=await te.simulate(k);h(S),o?.(k),n({type:"success",message:"SimulaÃ§Ã£o realizada com sucesso."})}catch(k){console.error("Erro na simulaÃ§Ã£o do CFO:",k);const S=k?.response?.status,A=k?.response?.data;S===403&&A?.code==="UPGRADE_REQUIRED"?(v({feature:A.feature,plan:A.plan}),j(!0),n({type:"warning",message:"Essa simulaÃ§Ã£o faz parte de um recurso avanÃ§ado do CFO. Fale com o suporte para ativar o plano ideal para sua empresa."})):n({type:"error",message:"NÃ£o foi possÃ­vel executar a simulaÃ§Ã£o agora. Tente novamente em alguns instantes."})}finally{u(!1)}},g=r.revenueMonth??0,f=r.expenseMonth??0,y=r.runwayMonths??0;return e.jsx("div",{className:"fixed inset-0 z-40 flex items-center justify-center bg-black/60 backdrop-blur-sm",role:"dialog","aria-modal":"true","aria-labelledby":"simulate-title",children:e.jsxs("div",{ref:t,className:"w-full max-w-lg rounded-2xl border border-slate-800 bg-slate-950/95 p-5 shadow-xl shadow-black/60",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("h2",{id:"simulate-title",className:"text-sm font-semibold text-slate-50",children:"Simular cenÃ¡rio financeiro"}),e.jsx("p",{className:"text-xs text-slate-400",children:"Ajuste receita, despesas e eventos pontuais para ver o impacto imediato no seu fluxo de caixa."})]}),e.jsx("button",{type:"button",onClick:a,className:"inline-flex h-7 w-7 items-center justify-center rounded-full border border-slate-700 text-slate-400 hover:text-slate-100 hover:bg-slate-900","aria-label":"Fechar simulaÃ§Ã£o",children:e.jsx(z,{className:"h-3.5 w-3.5"})})]}),e.jsxs("div",{className:"mb-4 grid grid-cols-3 gap-3 rounded-xl border border-slate-800 bg-slate-900/60 p-3 text-[11px] text-slate-300",children:[e.jsxs("div",{children:[e.jsx("p",{className:"uppercase tracking-wide text-slate-500 text-[10px]",children:"Receita mensal"}),e.jsxs("p",{className:"font-semibold text-slate-50",children:["R"," ",g.toLocaleString("pt-BR",{maximumFractionDigits:0})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"uppercase tracking-wide text-slate-500 text-[10px]",children:"Despesa mensal"}),e.jsxs("p",{className:"font-semibold text-slate-50",children:["R"," ",f.toLocaleString("pt-BR",{maximumFractionDigits:0})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"uppercase tracking-wide text-slate-500 text-[10px]",children:"Runway estimado"}),e.jsx("p",{className:"font-semibold text-slate-50",children:y?`${y.toFixed(1)} meses`:"â€”"})]})]}),e.jsxs("form",{onSubmit:N,className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-[11px] font-medium text-slate-300 mb-1",children:"Aumento de receita (%)"}),e.jsx("input",{type:"number",step:"1",min:-100,max:200,value:l.incDeltaPct??"",onChange:p("incDeltaPct"),className:"w-full rounded-lg border border-slate-700 bg-slate-900/80 px-2 py-1.5 text-xs text-slate-100 outline-none focus:ring-1 focus:ring-sky-500",placeholder:"ex: 10"}),e.jsx("p",{className:"mt-1 text-[10px] text-slate-500",children:"Ex.: 10 = crescer 10% na receita."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-[11px] font-medium text-slate-300 mb-1",children:"VariaÃ§Ã£o de despesas (%)"}),e.jsx("input",{type:"number",step:"1",min:-100,max:200,value:l.expDeltaPct??"",onChange:p("expDeltaPct"),className:"w-full rounded-lg border border-slate-700 bg-slate-900/80 px-2 py-1.5 text-xs text-slate-100 outline-none focus:ring-1 focus:ring-sky-500",placeholder:"ex: -5"}),e.jsx("p",{className:"mt-1 text-[10px] text-slate-500",children:"Ex.: -5 = reduzir gastos em 5%."})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-[11px] font-medium text-slate-300 mb-1",children:"Receita pontual (R$)"}),e.jsx("input",{type:"number",step:"100",min:0,value:l.oneOffIncome??"",onChange:p("oneOffIncome"),className:"w-full rounded-lg border border-slate-700 bg-slate-900/80 px-2 py-1.5 text-xs text-slate-100 outline-none focus:ring-1 focus:ring-sky-500",placeholder:"ex: 10000"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-[11px] font-medium text-slate-300 mb-1",children:"Despesa pontual (R$)"}),e.jsx("input",{type:"number",step:"100",min:0,value:l.oneOffExpense??"",onChange:p("oneOffExpense"),className:"w-full rounded-lg border border-slate-700 bg-slate-900/80 px-2 py-1.5 text-xs text-slate-100 outline-none focus:ring-1 focus:ring-sky-500",placeholder:"ex: 5000"})]})]}),m&&e.jsxs("div",{className:"mt-3 rounded-xl border border-slate-800 bg-slate-900/70 p-3 text-[11px] text-slate-200 space-y-1.5",children:[e.jsx("p",{className:"text-[10px] uppercase tracking-wide text-slate-500",children:"Resultado da simulaÃ§Ã£o"}),e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-400 text-[10px]",children:"Nova receita"}),e.jsxs("p",{className:"font-semibold text-slate-50",children:["R"," ",m.result.newIncome.toLocaleString("pt-BR",{maximumFractionDigits:0})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-400 text-[10px]",children:"Nova despesa"}),e.jsxs("p",{className:"font-semibold text-slate-50",children:["R"," ",m.result.newExpense.toLocaleString("pt-BR",{maximumFractionDigits:0})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-400 text-[10px]",children:"Fluxo lÃ­quido"}),e.jsxs("p",{className:`font-semibold ${m.result.net>=0?"text-emerald-400":"text-red-400"}`,children:["R"," ",m.result.net.toLocaleString("pt-BR",{maximumFractionDigits:0})]})]})]})]}),e.jsxs("div",{className:"mt-4 flex justify-end gap-2",children:[e.jsx("button",{type:"button",onClick:a,className:"rounded-xl border border-slate-700 bg-slate-900/80 px-3 py-1.5 text-xs text-slate-200 hover:bg-slate-800",disabled:i,children:"Fechar"}),e.jsx("button",{type:"submit",disabled:i,className:"rounded-xl bg-sky-500 px-4 py-1.5 text-xs font-semibold text-white shadow hover:bg-sky-400 disabled:opacity-60 disabled:cursor-not-allowed",children:i?"Simulando...":"Simular cenÃ¡rio"})]})]}),e.jsx(se,{open:b,onClose:()=>j(!1),feature:x?.feature,plan:x?.plan})]})})};function L(s,a){return a==="red"?"red":a==="yellow"&&s==="green"?"yellow":s}function Re(s){let a="green";const r=[];return s.runwayMonths<2?(a=L(a,"red"),r.push("Runway abaixo de 2 meses.")):s.runwayMonths<4&&(a=L(a,"yellow"),r.push("Runway entre 2 e 4 meses.")),typeof s.marginNet=="number"&&(s.marginNet<0?(a=L(a,"red"),r.push("Margem lÃ­quida negativa.")):s.marginNet<.1&&(a=L(a,"yellow"),r.push("Margem lÃ­quida abaixo do ideal."))),s.expenseMonth>s.revenueMonth&&(a=L(a,"yellow"),r.push("Despesas maiores que a receita no perÃ­odo.")),{status:a,reasons:r}}async function Le(s){const{tenantId:a,periodStart:r,periodEnd:o}=s,t={tenantId:a};r&&(t.start=r),o&&(t.end=o);const{data:n}=await I.get("/pulse/summary",{params:t});if(!n.ok){const k=new Error(n.error||"Erro ao carregar resumo financeiro (Pulse).");throw k.traceId=n.traceId,k}if(!n.hasData)return null;const{kpis:l,period:d,inflows:i,outflows:u,balanceSeries:m,accounts:h,alerts:b}=n,j=l.closing_balance,x=l.cash_in,v=l.cash_out,p=l.net_cash,N=typeof l.runway_days=="number"&&l.runway_days>0?l.runway_days/30:0,g=x>0?p/x:void 0,f={cashBalance:j,revenueMonth:x,expenseMonth:v,runwayMonths:N,marginNet:g},y=Re(f),w=[];return y.status==="red"?w.push("AtenÃ§Ã£o: saÃºde financeira crÃ­tica. Revise custos fixos e fluxo de caixa imediatamente."):y.status==="yellow"?w.push("Alerta: indicadores exigem atenÃ§Ã£o. Monitore de perto despesas e entradas de caixa."):w.push("SaÃºde financeira estÃ¡vel neste perÃ­odo analisado."),{tenantId:n.tenantId,periodStart:d.start,periodEnd:d.end,kpis:f,inflows:i,outflows:u,balanceSeries:m,accounts:h,alerts:b,projections:n.projections,insights:w,health:y,sources:n.meta?.sources,meta:{traceId:n.meta.traceId,latency_ms:n.meta.latency_ms}}}function De(s){if(!s||!s.kpis)return!0;const{cashBalance:a,revenueMonth:r,expenseMonth:o,runwayMonths:t}=s.kpis;return[a,r,o,t].every(l=>l==null||typeof l=="number"&&Math.abs(l)<1e-5)}function Oe(s){const{tenantId:a,periodStart:r,periodEnd:o}=s,{user:t}=J(),[n,l]=c.useState(null),[d,i]=c.useState(!0),[u,m]=c.useState(null),[h,b]=c.useState(!1),[j,x]=c.useState(0),v=c.useCallback(()=>{x(p=>p+1)},[]);return c.useEffect(()=>{if(!t)return;if(!a){l(null),b(!0),i(!1);return}let p=!0;async function N(){i(!0),m(null),b(!1);try{const g=await Le({tenantId:a,periodStart:r,periodEnd:o});if(!p)return;!g||De(g)?(l(null),b(!0)):(l(g),b(!1))}catch(g){if(!p)return;if((g?.response?.status??g?.status??g?.cause?.status??void 0)===404){l(null),m(null),b(!0);return}m(g),l(null),b(!1)}finally{if(!p)return;i(!1)}}return N(),()=>{p=!1}},[a,r,o,j,t]),{data:n,loading:d,error:u,empty:h,refetch:v}}function re(){const a=Y()?.token??null,[r,o]=c.useState(null),[t,n]=c.useState(!1),[l,d]=c.useState(null),i=c.useCallback(async()=>{if(a){n(!0),d(null);try{const m=await I.get("/billing/credits");o(m.data)}catch(m){d(m instanceof Error?m:new Error("Erro ao carregar crÃ©ditos"))}finally{n(!1)}}},[a]);c.useEffect(()=>{i()},[i]);const u=r?r.available<=0:!1;return{credits:r,isLoading:t,error:l,noCredits:u,refetch:i}}function P(s){return new Intl.NumberFormat("pt-BR").format(s)}function Pe(s){if(!s)return"";const a=new Date(s);return Number.isNaN(a.getTime())?"":a.toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric"})}const Te=()=>{const{credits:s,isLoading:a,error:r}=re();if(r)return null;if(a)return e.jsxs("div",{className:"w-full max-w-md rounded-xl border border-slate-200 bg-white px-4 py-2 animate-pulse",children:[e.jsx("div",{className:"flex items-center justify-between text-xs text-slate-400 mb-1",children:e.jsx("span",{children:"Carregando crÃ©ditosâ€¦"})}),e.jsx("div",{className:"h-2 rounded-full bg-slate-100 overflow-hidden",children:e.jsx("div",{className:"h-2 w-1/3 rounded-full bg-slate-200"})})]});if(!s)return null;const{available:o,monthlyQuota:t,used:n,renewsAt:l}=s,d=t||0,i=d>0?Math.min(100,Math.max(0,o/d*100)):0;let u="bg-emerald-500";i<10?u="bg-red-500":i<40&&(u="bg-amber-500");const m=Pe(l),h=m?`Renova em ${m} â€¢ Usados: ${P(n)}`:`Usados: ${P(n)}`;return e.jsxs("div",{className:"w-full max-w-md rounded-xl border border-slate-200 bg-white px-4 py-2 shadow-sm",title:h,children:[e.jsxs("div",{className:"flex items-center justify-between text-xs text-slate-500 mb-1",children:[e.jsx("span",{className:"font-medium text-slate-600",children:"CrÃ©ditos de IA & Voz"}),e.jsxs("span",{className:"font-semibold text-slate-700",children:[P(o)," / ",P(d)]})]}),e.jsx("div",{className:"h-2 rounded-full bg-slate-100 overflow-hidden",children:e.jsx("div",{className:`h-2 rounded-full transition-all ${u}`,style:{width:`${i}%`}})}),e.jsx("div",{className:"mt-1 text-[11px] text-slate-400",children:"Uso restante deste ciclo. Passe o mouse para ver detalhes."})]})},_e=({userName:s,companyName:a,periodLabel:r,lastImportLabel:o,lastUpdateLabel:t,isLoading:n=!1,className:l=""})=>{const d=(...i)=>i.filter(Boolean).join(" ");return n?e.jsx("header",{className:d("relative z-0","rounded-2xl border border-slate-200/80 bg-white/95 p-4 shadow-sm","dark:bg-slate-950/70 dark:border-white/10","animate-pulse",l),"aria-busy":"true","aria-live":"polite",children:e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("div",{className:"h-5 w-40 rounded bg-slate-200 dark:bg-white/10"}),e.jsx("div",{className:"h-4 w-56 rounded bg-slate-100 dark:bg-white/10"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-6 w-28 rounded-full bg-slate-100 dark:bg-white/10"}),e.jsx("div",{className:"h-6 w-32 rounded-full bg-slate-100 dark:bg-white/10"}),e.jsx("div",{className:"h-6 w-40 rounded-full bg-slate-100 dark:bg-white/10"})]})]})}):e.jsx("header",{className:d("relative z-0","rounded-2xl border border-slate-200/80 bg-white/95 p-4 shadow-sm","dark:bg-slate-950/75 dark:border-white/10",l),"aria-live":"polite",children:e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[e.jsxs("div",{className:"min-w-[240px]",children:[e.jsxs("h1",{className:"text-base font-semibold tracking-tight text-slate-900 dark:text-slate-50",children:["OlÃ¡,"," ",e.jsx("span",{className:"bg-gradient-to-r from-[var(--brand-1)] to-[var(--brand-2)] bg-clip-text text-transparent",children:s})]}),e.jsxs("p",{className:"mt-0.5 text-sm text-slate-500 dark:text-slate-300",children:["Empresa: ",e.jsx("span",{className:"font-medium",children:a})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsxs("span",{className:"inline-flex items-center gap-2 rounded-full border border-slate-200 bg-slate-50 px-3 py-1.5 text-xs font-medium text-slate-700 dark:border-white/10 dark:bg-white/5 dark:text-slate-100","aria-label":`PerÃ­odo atual: ${r}`,children:[e.jsx("span",{className:"h-1.5 w-1.5 rounded-full bg-slate-400","aria-hidden":"true"}),r]}),o&&e.jsxs("span",{className:"inline-flex items-center gap-2 rounded-full border border-emerald-200 bg-emerald-50 px-3 py-1.5 text-xs font-medium text-emerald-800 dark:border-emerald-400/40 dark:bg-emerald-500/15 dark:text-emerald-100","aria-label":`Ãšltima importaÃ§Ã£o: ${o}`,children:[e.jsx("span",{className:"h-1.5 w-1.5 rounded-full bg-emerald-400","aria-hidden":"true"}),"Ãšltima importaÃ§Ã£o: ",o]}),t&&e.jsxs("span",{className:"inline-flex items-center gap-2 rounded-full border border-sky-200 bg-sky-50 px-3 py-1.5 text-xs font-medium text-sky-800 dark:border-sky-400/40 dark:bg-sky-500/15 dark:text-sky-100","aria-label":`Atualizado: ${t}`,children:[e.jsx("span",{className:"h-1.5 w-1.5 rounded-full bg-sky-400","aria-hidden":"true"}),"Atualizado: ",t]})]})]})})},Q={EXCELLENT:{color:"text-emerald-600",bg:"bg-emerald-50",border:"border-emerald-200",icon:ye,label:"ExcelÃªncia Financeira"},STABLE:{color:"text-blue-600",bg:"bg-blue-50",border:"border-blue-200",icon:xe,label:"OperaÃ§Ã£o EstÃ¡vel"},CRITICAL:{color:"text-amber-600",bg:"bg-amber-50",border:"border-amber-200",icon:q,label:"AtenÃ§Ã£o NecessÃ¡ria"},DANGER:{color:"text-rose-600",bg:"bg-rose-50",border:"border-rose-200",icon:Z,label:"Risco Iminente"}};function $e({loading:s,error:a,data:r,onRetry:o}){if(s)return e.jsxs("div",{className:"rounded-2xl border border-slate-200 bg-white p-6 shadow-sm animate-pulse h-[280px]",children:[e.jsxs("div",{className:"flex justify-between items-start mb-6",children:[e.jsx("div",{className:"h-6 w-32 bg-slate-200 rounded"}),e.jsx("div",{className:"h-10 w-10 bg-slate-200 rounded-full"})]}),e.jsx("div",{className:"h-24 w-24 bg-slate-200 rounded-full mx-auto mb-6"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"h-4 w-full bg-slate-200 rounded"}),e.jsx("div",{className:"h-4 w-3/4 bg-slate-200 rounded"})]})]});if(a||!r)return e.jsxs("div",{className:"rounded-2xl border border-rose-200 bg-rose-50 p-6 flex flex-col items-center justify-center text-center h-full min-h-[200px]",children:[e.jsx(q,{className:"h-8 w-8 text-rose-500 mb-3"}),e.jsx("h3",{className:"text-sm font-semibold text-rose-900",children:"Falha no DiagnÃ³stico"}),e.jsx("p",{className:"text-xs text-rose-700 mt-1 mb-4",children:"NÃ£o foi possÃ­vel calcular a saÃºde financeira."}),o&&e.jsx("button",{onClick:o,className:"text-xs bg-white border border-rose-200 text-rose-700 px-3 py-2 rounded-lg hover:bg-rose-50 transition-colors",children:"Tentar Novamente"})]});const t=Q[r.status]||Q.CRITICAL,n=t.icon,l=()=>{const d=[];return r.runwayMonths<3?d.push({icon:G,label:"Runway Curto (< 3 meses)",type:"bad"}):r.runwayMonths>12&&d.push({icon:G,label:"Runway Estendido (> 12 meses)",type:"good"}),r.metrics.cashFlowRatio<0?d.push({icon:ke,label:"Queima de Caixa (Cash Negative)",type:"bad"}):d.push({icon:Se,label:"GeraÃ§Ã£o de Caixa (Cash Positive)",type:"good"}),r.metrics.marginRatio<.1&&d.push({icon:be,label:"Margem Apertada (< 10%)",type:"warn"}),d.map((i,u)=>e.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[e.jsx(i.icon,{className:`h-3.5 w-3.5 ${i.type==="good"?"text-emerald-500":i.type==="bad"?"text-rose-500":"text-amber-500"}`}),e.jsx("span",{className:"text-slate-600",children:i.label})]},u))};return e.jsxs("section",{className:"rounded-2xl border border-slate-200 bg-white shadow-sm overflow-hidden flex flex-col h-full",children:[e.jsxs("div",{className:`px-6 py-4 border-b ${t.border} ${t.bg} flex items-center justify-between`,children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold text-slate-900",children:"SaÃºde Financeira"}),e.jsx("p",{className:`text-xs font-medium mt-0.5 ${t.color}`,children:t.label})]}),e.jsx("div",{className:`p-2 rounded-full bg-white/60 ${t.color}`,children:e.jsx(n,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"p-6 flex-1 flex flex-col gap-6",children:[e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("div",{className:"relative h-20 w-20 flex-shrink-0 flex items-center justify-center",children:[e.jsxs("svg",{className:"h-full w-full -rotate-90 transform",viewBox:"0 0 36 36",children:[e.jsx("path",{className:"text-slate-100",d:"M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831",fill:"none",stroke:"currentColor",strokeWidth:"3"}),e.jsx("path",{className:t.color,strokeDasharray:`${r.score}, 100`,d:"M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831",fill:"none",stroke:"currentColor",strokeWidth:"3",strokeLinecap:"round"})]}),e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center",children:[e.jsx("span",{className:"text-2xl font-bold text-slate-900",children:r.score}),e.jsx("span",{className:"text-[10px] text-slate-400 font-medium",children:"/100"})]})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-xs text-slate-500 italic mb-1",children:"AnÃ¡lise do CFO:"}),e.jsxs("p",{className:"text-sm text-slate-700 leading-snug",children:['"',r.aiComment,'"']})]})]}),e.jsxs("div",{className:"space-y-2 pt-4 border-t border-slate-100",children:[e.jsx("p",{className:"text-[10px] uppercase tracking-wide text-slate-400 font-semibold mb-2",children:"Indicadores Chave"}),l()]})]})]})}function ze({loading:s,error:a,empty:r,actions:o}){return s?e.jsxs("div",{className:"p-6 bg-white rounded-xl shadow-sm border",children:[e.jsx("div",{className:"h-4 w-28 bg-gray-200 rounded mb-4 animate-pulse"}),e.jsx("div",{className:"space-y-3",children:[1,2,3].map(t=>e.jsx("div",{className:"h-10 bg-gray-200 rounded-lg animate-pulse"},t))})]}):a?e.jsx("div",{className:"p-6 bg-red-50 border border-red-200 rounded-xl text-red-700 text-sm",children:"NÃ£o consegui carregar o plano de aÃ§Ãµes. Recarregue a pÃ¡gina. Se persistir, fale com o suporte."}):r||!o||o.length===0?e.jsx("div",{className:"p-6 bg-white rounded-xl shadow-sm border text-sm text-gray-600",children:"Nenhum plano de aÃ§Ã£o financeiro definido ainda. Assim que o Advisor gerar recomendaÃ§Ãµes, elas aparecerÃ£o aqui."}):e.jsxs("div",{className:"p-6 bg-white rounded-xl shadow-sm border",children:[e.jsx("div",{className:"text-sm text-gray-500 mb-3",children:"Plano de AÃ§Ãµes"}),e.jsx("ul",{className:"space-y-2",children:o.map((t,n)=>e.jsxs("li",{className:"flex items-start justify-between gap-3 rounded-lg border px-3 py-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:t.title}),t.description&&e.jsx("div",{className:"text-xs text-gray-600 mt-1",children:t.description})]}),e.jsxs("div",{className:"flex flex-col items-end gap-1",children:[t.impact&&e.jsxs("span",{className:"text-[10px] px-2 py-1 rounded-full bg-amber-50 text-amber-700 border border-amber-100",children:["Impacto: ",t.impact]}),t.status&&e.jsx("span",{className:"text-[10px] px-2 py-1 rounded-full bg-slate-50 text-slate-700 border border-slate-200",children:t.status})]})]},t.id??n))})]})}function Be({loading:s,error:a,empty:r,kpis:o,scenarios:t}){return s?e.jsxs("div",{className:"p-6 bg-white rounded-xl shadow-sm border",children:[e.jsx("div",{className:"h-4 w-32 bg-gray-200 rounded mb-4 animate-pulse"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[1,2,3].map(n=>e.jsx("div",{className:"h-24 bg-gray-200 rounded-lg animate-pulse"},n))})]}):a?e.jsx("div",{className:"p-6 bg-red-50 border border-red-200 rounded-xl text-red-700 text-sm",children:"NÃ£o consegui carregar os cenÃ¡rios simulados. Tente novamente mais tarde."}):r||!t||t.length===0?e.jsx("div",{className:"p-6 bg-white rounded-xl shadow-sm border text-sm text-gray-600",children:"Nenhum cenÃ¡rio financeiro simulador disponÃ­vel ainda. Use o Advisor ou o simulador para gerar hipÃ³teses."}):e.jsxs("div",{className:"p-6 bg-white rounded-xl shadow-sm border space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-sm text-gray-500",children:"CenÃ¡rios simulados"}),o&&o.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2",children:o.slice(0,3).map((n,l)=>e.jsxs("span",{className:"text-[11px] px-2 py-1 rounded-full bg-slate-50 text-slate-700 border border-slate-200",children:[n.name,": ",n.value,n.unit&&e.jsx("span",{className:"ml-1",children:n.unit})]},n.id??l))})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:t.map((n,l)=>e.jsxs("div",{className:"rounded-lg border p-3 text-sm flex flex-col gap-2",children:[e.jsx("div",{className:"font-medium text-gray-900",children:n.title}),n.description&&e.jsx("div",{className:"text-xs text-gray-600",children:n.description}),n.impact&&e.jsxs("span",{className:"text-[11px] px-2 py-1 rounded-full bg-indigo-50 text-indigo-700 border border-indigo-100 self-start",children:["Impacto: ",n.impact]})]},n.id??l))})]})}function X({tenantId:s,plan:a}){return null}function qe({disabled:s}){const{notify:a}=B(),[r,o]=c.useState(!1),[t,n]=c.useState(null),[l,d]=c.useState(null),[i,u]=c.useState(!1),[m,h]=c.useState(null);async function b(v){if(!(s||r)){o(!0),d(null);try{const p=await te.getAiReport(v);n(p),a({type:"success",message:"RelatÃ³rio do CFO IA gerado com sucesso."})}catch(p){const N=p?.status,g=p?.message||"NÃ£o foi possÃ­vel gerar o relatÃ³rio agora. Tente novamente em alguns instantes.";N===403?(h({feature:"cfo_ai_report",plan:void 0}),u(!0),a({type:"warning",message:"Esse relatÃ³rio faz parte de um recurso avanÃ§ado do CFO. Fale com o suporte para ativar o plano ideal para sua empresa."})):(d(g),a({type:"error",message:g}))}finally{o(!1)}}}const j=t?.report?.length&&t.report.length>220?t.report.slice(0,220)+"...":t?.report??"",x=t?.meta?.periodDays?`Ãšltimos ${t.meta.periodDays} dias`:"PerÃ­odo padrÃ£o (30 dias)";return e.jsxs(e.Fragment,{children:[e.jsxs("section",{className:"rounded-2xl border border-slate-200 bg-white p-4 shadow-sm dark:border-slate-700 dark:bg-slate-900/80",children:[e.jsxs("header",{className:"mb-2 flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"inline-flex h-8 w-8 items-center justify-center rounded-xl bg-slate-900 text-slate-50 dark:bg-slate-50 dark:text-slate-900",children:e.jsx(fe,{className:"h-4 w-4"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold text-slate-900 dark:text-slate-50",children:"RelatÃ³rio do CFO IA"}),e.jsx("p",{className:"text-[11px] text-slate-500 dark:text-slate-300",children:"AnÃ¡lise executiva em texto, baseada nos seus nÃºmeros dos Ãºltimos dias."})]})]}),e.jsx("button",{type:"button",onClick:()=>b(),disabled:r||s,className:"inline-flex items-center gap-1.5 rounded-xl bg-slate-900 px-3 py-1.5 text-[11px] font-medium text-slate-50 shadow-sm hover:bg-slate-800 disabled:opacity-50 dark:bg-slate-50 dark:text-slate-900 dark:hover:bg-slate-200",children:r?e.jsxs(e.Fragment,{children:[e.jsx(R,{className:"h-3.5 w-3.5 animate-spin"}),"Gerando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(R,{className:"h-3.5 w-3.5"}),"Gerar agora"]})})]}),l&&e.jsx("p",{className:"mt-2 rounded px-2 py-1 text-[11px] text-amber-700 bg-amber-50 border border-amber-200 dark:bg-amber-950/40 dark:border-amber-500/40 dark:text-amber-200",children:l}),!t&&!l&&e.jsxs("p",{className:"mt-2 text-[11px] text-slate-500 dark:text-slate-300",children:["Clique em ",e.jsx("strong",{children:"Gerar agora"})," para receber uma leitura do CFO IA sobre sua saÃºde financeira, riscos e oportunidades mais urgentes."]}),t&&e.jsxs("div",{className:"mt-3 rounded-xl border border-slate-100 bg-slate-50/80 p-3 text-[11px] text-slate-800 dark:border-slate-700 dark:bg-slate-900/70 dark:text-slate-100",children:[e.jsxs("div",{className:"mb-1 flex items-center justify-between",children:[e.jsx("span",{className:"text-[10px] font-semibold uppercase tracking-wide text-slate-500 dark:text-slate-300",children:"VisÃ£o executiva do CFO IA"}),e.jsx("span",{className:"text-[10px] text-slate-400 dark:text-slate-500",children:x})]}),e.jsx("p",{className:"whitespace-pre-wrap",children:j})]})]}),e.jsx(se,{open:i,onClose:()=>u(!1),featureName:"RelatÃ³rio do CFO IA",featureKey:m?.feature,currentPlan:m?.plan})]})}function M({lines:s=3,compact:a}){return e.jsxs("div",{className:`bg-white rounded-xl border animate-pulse ${a?"p-3":"p-6"}`,children:[e.jsx("div",{className:"h-4 w-28 bg-slate-200 rounded mb-4"}),e.jsx("div",{className:"space-y-2",children:Array.from({length:s}).map((r,o)=>e.jsx("div",{className:"h-3 bg-slate-200 rounded",style:{width:`${70+o*10}%`}},o))})]})}function He(){const s=Y(),a=oe({queryKey:["cfoSummary"],enabled:!!s,queryFn:async()=>(await I.get("/cfo/summary")).data}),r=!a.isLoading&&!a.error&&(!a.data||!a.data.health&&(!a.data.actions||a.data.actions.length===0)&&(!a.data.scenarios||a.data.scenarios.length===0)&&(!a.data.kpis||a.data.kpis.length===0));return{data:a.data??null,error:a.error??null,isLoading:a.isLoading||a.isFetching,isEmpty:r}}function Ue(s){const{question:a,enabled:r=!0}=s||{},[o,t]=c.useState(null),[n,l]=c.useState(!1),[d,i]=c.useState(null),[u,m]=c.useState(!1),[h,b]=c.useState(!1),j=c.useRef(a),x=c.useRef(!0);c.useEffect(()=>()=>{x.current=!1},[]);async function v(N){if(!r)return;const g=N??j.current;j.current=g??void 0,l(!0),i(null),m(!1),b(!1);try{const f=await I.post("/market/advice",{question:g});if(!x.current)return;t(f.data)}catch(f){if(!x.current)return;const y=f?.response?.status,w=f?.response?.data?.code;y===402||w==="NO_CREDITS"?m(!0):y===403&&w==="MARKET_DISABLED"?b(!0):i(y===502||w==="AI_PROVIDER_ERROR"?new Error("ServiÃ§o de IA indisponÃ­vel no momento. Tente novamente mais tarde."):f instanceof Error?f:new Error("Erro ao obter anÃ¡lise de mercado"))}finally{x.current&&l(!1)}}return c.useEffect(()=>{r&&v(a)},[r,a]),{data:o,isLoading:n,error:d,refetch:()=>{v()},noCredits:u,marketDisabled:h}}function Ve({advice:s,isLoading:a,error:r,noCredits:o,onRefetch:t,marketDisabled:n,onOpenConfig:l}){const d=c.useId(),i=c.useId(),u=!n&&!!r&&/MARKET_DISABLED|market.*disabled|conselheiro.*desativado/i.test(r.message||""),m=n||u;if(a)return e.jsxs("section",{className:"rounded-2xl border bg-white p-4 shadow-sm animate-pulse space-y-3",role:"status","aria-busy":"true","aria-live":"polite","aria-labelledby":d,children:[e.jsx("div",{id:d,className:"h-4 w-40 bg-slate-200 rounded"}),e.jsx("div",{className:"h-3 w-72 bg-slate-100 rounded"}),e.jsx("div",{className:"h-3 w-full bg-slate-100 rounded"}),e.jsx("div",{className:"h-3 w-2/3 bg-slate-100 rounded"})]});if(m)return e.jsxs("section",{className:"rounded-2xl border border-sky-200 bg-sky-50 p-4 shadow-sm",role:"region","aria-labelledby":d,"aria-describedby":i,children:[e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(_,{className:"h-5 w-5 text-sky-700 mt-[2px]","aria-hidden":"true"}),e.jsxs("div",{className:"space-y-1 text-sm text-sky-900",children:[e.jsx("h3",{id:d,className:"font-semibold",children:"Conselheiro de mercado desativado para este tenant"}),e.jsx("p",{children:"Ative o conselheiro de mercado nas configuraÃ§Ãµes do tenant para gerar a anÃ¡lise com base no seu setor, regiÃ£o e porte."}),e.jsxs("div",{className:"flex gap-2 mt-1",children:[l?e.jsxs("button",{onClick:l,className:"inline-flex items-center gap-1 rounded-xl border border-sky-300 bg-white px-3 py-1.5 text-xs font-medium text-sky-800 hover:bg-sky-100",children:[e.jsx(_,{className:"h-3 w-3","aria-hidden":"true"}),"Abrir configuraÃ§Ã£o"]}):e.jsxs("a",{href:"/admin/market",className:"inline-flex items-center gap-1 rounded-xl border border-sky-300 bg-white px-3 py-1.5 text-xs font-medium text-sky-800 hover:bg-sky-100",children:[e.jsx(_,{className:"h-3 w-3","aria-hidden":"true"}),"Abrir configuraÃ§Ã£o"]}),t&&e.jsxs("button",{onClick:t,className:"inline-flex items-center gap-1 rounded-xl border border-sky-200 bg-sky-50 px-3 py-1.5 text-xs font-medium text-sky-800 hover:bg-sky-100",children:[e.jsx(R,{className:"h-3 w-3","aria-hidden":"true"}),"Tentar novamente"]})]})]})]}),e.jsx("p",{id:i,className:"mt-3 text-[11px] text-sky-800/80",children:"Esta anÃ¡lise usa padrÃµes histÃ³ricos e sinais de mercado com base no seu perfil."})]});if(o)return e.jsxs("section",{className:"rounded-2xl border border-amber-200 bg-amber-50 p-4 shadow-sm",role:"region","aria-labelledby":d,"aria-describedby":i,children:[e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(U,{className:"h-5 w-5 text-amber-700 mt-[2px]","aria-hidden":"true"}),e.jsxs("div",{className:"space-y-1 text-sm text-amber-900",children:[e.jsx("h3",{id:d,className:"font-semibold",children:"CrÃ©ditos de IA para anÃ¡lises de mercado esgotados"}),e.jsx("p",{children:"VocÃª atingiu o limite de crÃ©ditos de IA para anÃ¡lises de mercado neste plano. Atualize seu plano ou aguarde a renovaÃ§Ã£o dos crÃ©ditos para continuar usando este recurso."}),t&&e.jsxs("button",{onClick:t,className:"inline-flex items-center gap-1 rounded-xl border border-amber-300 bg-white px-3 py-1.5 text-xs font-medium text-amber-800 hover:bg-amber-100 mt-1",children:[e.jsx(R,{className:"h-3 w-3","aria-hidden":"true"}),"Tentar novamente depois"]})]})]}),e.jsx("p",{id:i,className:"mt-3 text-[11px] text-amber-800/80",children:"Esta anÃ¡lise Ã© baseada em padrÃµes histÃ³ricos de mercado e comportamento do consumidor. NÃ£o constitui garantia de resultados futuros."})]});if(r)return e.jsxs("section",{className:"rounded-2xl border border-red-200 bg-red-50 p-4 shadow-sm",role:"region","aria-labelledby":d,"aria-describedby":i,children:[e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(U,{className:"h-5 w-5 text-red-700 mt-[2px]","aria-hidden":"true"}),e.jsxs("div",{className:"space-y-1 text-sm text-red-900",children:[e.jsx("h3",{id:d,className:"font-semibold",children:"NÃ£o foi possÃ­vel obter a anÃ¡lise de mercado"}),e.jsx("p",{children:"NÃ£o foi possÃ­vel obter a anÃ¡lise de mercado agora. Tente novamente mais tarde."}),t&&e.jsxs("button",{onClick:t,className:"inline-flex items-center gap-1 rounded-xl border border-red-200 bg-white px-3 py-1.5 text-xs font-medium text-red-800 hover:bg-red-100 mt-1","aria-label":"Tentar atualizar a anÃ¡lise de mercado",children:[e.jsx(R,{className:"h-3 w-3","aria-hidden":"true"}),"Tentar novamente"]})]})]}),e.jsx("p",{id:i,className:"mt-3 text-[11px] text-red-800/80",children:"Esta anÃ¡lise Ã© baseada em padrÃµes histÃ³ricos de mercado e comportamento do consumidor. NÃ£o constitui garantia de resultados futuros."})]});if(!s)return e.jsxs("section",{className:"rounded-2xl border border-slate-200 bg-slate-50 p-4 shadow-sm",role:"region","aria-labelledby":d,"aria-describedby":i,children:[e.jsx("h3",{id:d,className:"text-sm font-semibold text-slate-800 mb-1",children:"VisÃ£o EstratÃ©gica de Mercado"}),e.jsx("p",{className:"text-xs text-slate-600 mb-3",children:"PeÃ§a ao seu CFO virtual uma visÃ£o de mercado com base no seu segmento. Isso ajuda a tomar decisÃµes mais alinhadas com o cenÃ¡rio real, usando padrÃµes histÃ³ricos e comportamento de consumidor."}),t&&e.jsxs("button",{onClick:t,className:"inline-flex items-center gap-1 rounded-xl bg-slate-900 px-3 py-1.5 text-xs font-medium text-white hover:bg-black","aria-label":"Gerar anÃ¡lise de mercado",children:[e.jsx(ie,{className:"h-3 w-3","aria-hidden":"true"}),"Gerar anÃ¡lise de mercado"]}),e.jsx("p",{id:i,className:"mt-3 text-[11px] text-slate-500",children:"Esta anÃ¡lise Ã© baseada em padrÃµes histÃ³ricos de mercado e comportamento do consumidor. NÃ£o constitui garantia de resultados futuros."})]});const{summary:h,marketFacts:b,historicalPatterns:j,risks:x,opportunities:v,consumerBehaviorInsights:p,recommendedActions:N}=s,g=p?.length>0;return e.jsxs("section",{className:"rounded-2xl border bg-white p-4 shadow-sm space-y-3",role:"region","aria-labelledby":d,"aria-describedby":i,children:[e.jsxs("div",{children:[e.jsx("h3",{id:d,className:"text-sm font-semibold text-slate-800",children:"VisÃ£o EstratÃ©gica de Mercado"}),h&&e.jsx("p",{className:"mt-1 text-xs text-slate-600 leading-relaxed",children:h})]}),e.jsxs("div",{className:"grid gap-3 md:grid-cols-2",children:[b?.length>0&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("h4",{className:"text-xs font-semibold text-slate-700",children:"Fatos de mercado relevantes"}),e.jsx("ul",{className:"space-y-1 text-xs text-slate-600",children:b.map((f,y)=>e.jsxs("li",{className:"flex gap-2",children:[e.jsx("span",{className:"mt-0.5 h-1.5 w-1.5 rounded-full bg-slate-300"}),e.jsx("span",{children:f})]},y))})]}),j?.length>0&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("h4",{className:"text-xs font-semibold text-slate-700",children:"PadrÃµes histÃ³ricos observados"}),e.jsx("ul",{className:"space-y-1 text-xs text-slate-600",children:j.map((f,y)=>e.jsxs("li",{className:"flex gap-2",children:[e.jsx("span",{className:"mt-0.5 h-1.5 w-1.5 rounded-full bg-slate-300"}),e.jsx("span",{children:f})]},y))})]}),x?.length>0&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("h4",{className:"text-xs font-semibold text-rose-700",children:"Riscos suportados por dados"}),e.jsx("ul",{className:"space-y-1 text-xs text-rose-800",children:x.map((f,y)=>e.jsxs("li",{className:"flex gap-2",children:[e.jsx("span",{className:"mt-0.5 h-1.5 w-1.5 rounded-full bg-rose-300"}),e.jsx("span",{children:f})]},y))})]}),v?.length>0&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("h4",{className:"text-xs font-semibold text-emerald-700",children:"Oportunidades identificadas"}),e.jsx("ul",{className:"space-y-1 text-xs text-emerald-800",children:v.map((f,y)=>e.jsxs("li",{className:"flex gap-2",children:[e.jsx("span",{className:"mt-0.5 h-1.5 w-1.5 rounded-full bg-emerald-300"}),e.jsx("span",{children:f})]},y))})]}),g&&e.jsxs("div",{className:"space-y-1 md:col-span-2",children:[e.jsx("h4",{className:"text-xs font-semibold text-slate-700",children:"Insights de comportamento de massa"}),e.jsx("ul",{className:"space-y-1 text-xs text-slate-600",children:p.map((f,y)=>e.jsxs("li",{className:"flex gap-2",children:[e.jsx("span",{className:"mt-0.5 h-1.5 w-1.5 rounded-full bg-slate-300"}),e.jsx("span",{children:f})]},y))})]}),N?.length>0&&e.jsxs("div",{className:"space-y-1 md:col-span-2",children:[e.jsx("h4",{className:"text-xs font-semibold text-slate-900",children:"AÃ§Ãµes recomendadas (baseadas em padrÃµes histÃ³ricos)"}),e.jsx("ul",{className:"space-y-1 text-xs text-slate-700",children:N.map((f,y)=>e.jsxs("li",{className:"flex gap-2",children:[e.jsx("span",{className:"mt-0.5 h-1.5 w-1.5 rounded-full bg-slate-900"}),e.jsx("span",{children:f})]},y))})]})]}),e.jsxs("div",{className:"flex items-center justify-between pt-1",children:[e.jsx("p",{id:i,className:"text-[11px] text-slate-500",children:"Esta anÃ¡lise Ã© baseada em padrÃµes histÃ³ricos de mercado e comportamento do consumidor. NÃ£o constitui garantia de resultados futuros."}),t&&e.jsxs("button",{onClick:t,className:"inline-flex items-center gap-1 rounded-xl border border-slate-200 bg-slate-50 px-2.5 py-1 text-[11px] font-medium text-slate-700 hover:bg-slate-100","aria-label":"Atualizar anÃ¡lise de mercado",children:[e.jsx(R,{className:"h-3 w-3","aria-hidden":"true"}),"Atualizar anÃ¡lise"]})]})]})}function Ge({onImportClick:s,tenantId:a,plan:r="CFO",sector:o,region:t,companySize:n}){const{data:l,isLoading:d,error:i,isEmpty:u}=He(),m=!!l&&(!!l.healthScore||l.actionPlan&&l.actionPlan.length>0),[h,b]=c.useState(""),j=c.useId(),x=`${j}-help`,{data:v,isLoading:p,error:N,noCredits:g,refetch:f}=Ue({question:h.trim()||void 0,enabled:m}),y=l?.kpis||[],w=l?.actionPlan||[],k=[o?{label:"Setor",value:o}:null,t?{label:"RegiÃ£o",value:t}:null,n?{label:"Porte",value:n}:null].filter(Boolean);function S(){f()}function A(C){C.key==="Enter"&&(C.preventDefault(),S())}if(d)return e.jsxs("section",{className:"mt-8 space-y-6","aria-busy":"true","aria-live":"polite",children:[e.jsxs("div",{className:"grid gap-6 lg:grid-cols-3",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"mb-2 h-5 w-48 rounded bg-slate-200"}),e.jsx("div",{className:"h-4 w-64 rounded bg-slate-100"})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[e.jsx(M,{className:"md:col-span-1 h-40"}),e.jsx(M,{className:"md:col-span-2 h-40"})]}),e.jsx(M,{className:"h-40"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(M,{className:"h-20"}),e.jsx(M,{className:"h-64"})]})]}),e.jsx(M,{className:"h-40"})]});if(i){const C=ee(i);return e.jsx("section",{className:"mt-8","aria-live":"polite",children:e.jsx(D,{title:"N?o foi poss?vel carregar o painel do CFO",description:C.message,primaryActionLabel:"Tentar novamente",onPrimaryAction:s})})}return u||!m?e.jsxs("section",{className:"mt-8 space-y-6","aria-live":"polite",children:[e.jsx(D,{title:"Seu painel do CFO ainda estÃ¡ vazio",description:"Importe seus dados financeiros para ver saÃºde da empresa, plano de aÃ§Ã£o e simulaÃ§Ãµes inteligentes.",primaryActionLabel:"Importar dados agora",onPrimaryAction:s}),e.jsx(X,{tenantId:a,plan:r})]}):e.jsxs("section",{className:"mt-8 space-y-6","aria-labelledby":"cfo-heading","aria-describedby":"cfo-subheading",children:[e.jsxs("div",{className:"grid gap-6 lg:grid-cols-3",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-4",children:[e.jsxs("header",{className:"space-y-1",children:[e.jsx("h2",{id:"cfo-heading",className:"text-lg font-semibold text-slate-900",children:"SaÃºde financeira da sua empresa"}),e.jsx("p",{id:"cfo-subheading",className:"text-sm text-slate-500",children:"Acompanhe a fotografia interna do negÃ³cio: saÃºde, prioridades e impacto financeiro das aÃ§Ãµes sugeridas."})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[e.jsx("div",{className:"md:col-span-1",children:e.jsx($e,{healthScore:l?.healthScore})}),e.jsx("div",{className:"md:col-span-2",children:e.jsx(ze,{actionPlan:w})})]}),e.jsxs("div",{className:"rounded-2xl border border-slate-200 bg-white p-4 shadow-sm",role:"region","aria-label":"Impacto financeiro das prÃ³ximas aÃ§Ãµes",children:[e.jsx("h3",{className:"mb-2 text-sm font-semibold text-slate-900",children:"Impacto financeiro das prÃ³ximas aÃ§Ãµes"}),e.jsx("p",{className:"mb-3 text-xs text-slate-500",children:"Veja como o plano recomendado pelo CFO virtual afeta caixa, lucro e margem num cenÃ¡rio base."}),e.jsx(Be,{kpis:y})]}),e.jsx(qe,{})]}),e.jsxs("aside",{className:"space-y-3",role:"complementary","aria-label":"CenÃ¡rio de mercado para o seu setor","aria-live":"polite",children:[e.jsxs("header",{className:"space-y-1",children:[e.jsx("h2",{className:"text-lg font-semibold text-slate-900",children:"CenÃ¡rio de mercado para o seu setor"}),e.jsx("p",{className:"text-sm text-slate-500",children:"Seu CFO virtual conecta os nÃºmeros internos com fatos de mercado e padrÃµes de comportamento do consumidor."}),k.length>0&&e.jsx("dl",{className:"mt-2 flex flex-wrap gap-2 text-[11px] text-slate-600",children:k.map(C=>e.jsxs("div",{className:"flex items-center gap-1 rounded-full bg-slate-100 px-2 py-0.5",children:[e.jsxs("dt",{className:"font-medium",children:[C.label,":"]}),e.jsx("dd",{children:C.value})]},C.label))})]}),e.jsxs("div",{className:"space-y-1 rounded-2xl border border-slate-200 bg-white p-3 shadow-sm",role:"group","aria-labelledby":`${j}-label`,"aria-describedby":x,children:[e.jsx("label",{id:`${j}-label`,htmlFor:j,className:"block text-[11px] font-medium uppercase tracking-wide text-slate-500",children:"Pergunta opcional sobre o mercado"}),e.jsxs("div",{className:"mt-1 flex gap-2",children:[e.jsx("input",{id:j,type:"text",placeholder:"Ex.: Vale a pena expandir para outra cidade?",className:"flex-1 rounded-lg border border-slate-200 bg-slate-50 px-3 py-2 text-xs text-slate-900 outline-none ring-0 transition focus:border-sky-400 focus:bg-white focus:ring-1 focus:ring-sky-400",value:h,onChange:C=>b(C.target.value),onKeyDown:A,"aria-invalid":!1,"aria-describedby":x}),e.jsx("button",{type:"button",onClick:S,className:"inline-flex items-center rounded-lg bg-sky-600 px-3 py-2 text-xs font-medium text-white shadow-sm transition hover:bg-sky-700 disabled:cursor-not-allowed disabled:bg-slate-300 focus:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-sky-500",disabled:p,"aria-disabled":p,"aria-busy":p,title:"Gerar/atualizar anÃ¡lise de mercado",children:p?"Atualizando...":"Perguntar"})]}),e.jsx("p",{id:x,className:"mt-1 text-[11px] text-slate-400",children:"Use este campo para contextualizar a anÃ¡lise com dÃºvidas como expansÃ£o, novos canais ou mudanÃ§as de preÃ§o. Pressione Enter para enviar rapidamente."})]}),e.jsx(Ve,{advice:v,isLoading:p,error:N,noCredits:g,onRefetch:f})]})]}),e.jsx(X,{tenantId:a,plan:r})]})}function Ke({open:s,onClose:a,onImported:r}){const[o,t]=c.useState(""),[n,l]=c.useState(!1),[d,i]=c.useState(null),[u,m]=c.useState(null);if(!s)return null;function h(x){return x.match(/\/d\/([^/]+)/)?.[1]??x.trim()}async function b(){const x=o.trim();if(x){l(!0),i(null),m(null);try{const v=h(x),{data:p}=await I.post("/sync/import",{sheetId:v}),N=p.importedCount??0,g=p.message??`ImportaÃ§Ã£o concluÃ­da com sucesso. Foram importados ${N} registros.`;i(g),$?.("import_success",{importedCount:N}),r&&r({importedCount:N})}catch(v){console.error("[ImportModal] Erro ao importar:",v);const p=v?.message||"NÃ£o foi possÃ­vel importar a planilha. Verifique a URL e tente novamente.";m(p),$?.("import_error",{status:v?.status})}finally{l(!1)}}}function j(){t(""),i(null),m(null),l(!1),a()}return e.jsx("div",{className:"fixed inset-0 z-40 flex items-center justify-center bg-black/40 backdrop-blur-sm",children:e.jsxs("div",{className:"glass max-w-md w-full rounded-2xl p-4 shadow-xl border border-white/10",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2 mb-3",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-base md:text-lg font-semibold",children:"Importar dados do Google Sheets"}),e.jsx("p",{className:"text-xs md:text-sm text-slate-500 mt-1",children:"Cole a URL da planilha com seus dados financeiros. O Momentum vai importar as transaÃ§Ãµes para o seu tenant atual."})]}),e.jsx("button",{type:"button",onClick:j,className:"text-slate-400 hover:text-slate-200 text-sm px-2","aria-label":"Fechar",children:"âœ•"})]}),e.jsx("label",{className:"block text-xs font-medium text-slate-600 mb-1",children:"URL da planilha"}),e.jsx("input",{type:"url",value:o,onChange:x=>t(x.target.value),placeholder:"https://docs.google.com/spreadsheets/d/...",className:"w-full rounded-lg border border-slate-200 px-3 py-2 text-sm mb-3 focus:outline-none focus:ring-2 focus:ring-emerald-500/60 focus:border-emerald-500/60 bg-white/60"}),e.jsx("p",{className:"text-[11px] text-slate-400 mb-3",children:"Dica: verifique se a planilha estÃ¡ compartilhada com permissÃ£o de leitura para o serviÃ§o conectado, ou se o token do Google foi configurado corretamente."}),e.jsxs("div",{className:"flex justify-end gap-2 mb-2",children:[e.jsx("button",{type:"button",onClick:j,className:"text-xs md:text-sm px-3 py-1.5 rounded-lg border border-slate-200 bg-white hover:bg-slate-50",disabled:n,children:"Cancelar"}),e.jsx("button",{type:"button",onClick:b,className:"text-xs md:text-sm px-3 py-1.5 rounded-lg bg-emerald-600 text-white hover:bg-emerald-500 disabled:opacity-60 disabled:cursor-not-allowed",disabled:n||!o.trim(),children:n?"Importando...":"Importar"})]}),u&&e.jsx("div",{className:"mt-2 text-xs text-red-500 bg-red-50 border border-red-100 rounded-lg px-3 py-2",children:u}),d&&e.jsx("div",{className:"mt-2 text-xs text-emerald-700 bg-emerald-50 border border-emerald-100 rounded-lg px-3 py-2",children:d})]})})}function Qe(s){switch(s){case"EXCELLENT":return{label:"Excelente",level:"NÃ­vel 4 â€“ CFO de Elite",badgeClass:"bg-emerald-50 text-emerald-700 border-emerald-200 dark:bg-emerald-950/40 dark:text-emerald-300 dark:border-emerald-500/40",icon:V};case"STABLE":return{label:"EstÃ¡vel",level:"NÃ­vel 3 â€“ Estrutura saudÃ¡vel",badgeClass:"bg-sky-50 text-sky-700 border-sky-200 dark:bg-sky-950/40 dark:text-sky-300 dark:border-sky-500/40",icon:V};case"CRITICAL":return{label:"CrÃ­tico",level:"NÃ­vel 2 â€“ AtenÃ§Ã£o mÃ¡xima",badgeClass:"bg-amber-50 text-amber-800 border-amber-200 dark:bg-amber-950/40 dark:text-amber-300 dark:border-amber-500/40",icon:q};case"DANGER":default:return{label:"Perigo",level:"NÃ­vel 1 â€“ Risco de sobrevivÃªncia",badgeClass:"bg-red-50 text-red-800 border-red-200 dark:bg-red-950/40 dark:text-red-300 dark:border-red-500/40",icon:Z}}}function Xe(){const[s,a]=c.useState(null),[r,o]=c.useState(!0),[t,n]=c.useState(null);if(c.useEffect(()=>{let u=!1;async function m(){o(!0),n(null);try{const h=await ae();u||a(h)}catch(h){console.error("[CFO Health] Erro ao carregar:",h),u||n("NÃ£o consegui carregar o Health Score financeiro. Tente recarregar a pÃ¡gina.")}finally{u||o(!1)}}return m(),()=>{u=!0}},[]),r)return e.jsxs("section",{className:"rounded-2xl border border-slate-200/70 bg-white/80 p-5 shadow-sm dark:border-slate-800 dark:bg-slate-900/70",children:[e.jsx("div",{className:"h-4 w-40 rounded bg-slate-200/70 dark:bg-slate-700 mb-4"}),e.jsx("div",{className:"h-10 w-24 rounded bg-slate-200/70 dark:bg-slate-700 mb-2"}),e.jsx("div",{className:"h-3 w-52 rounded bg-slate-200/70 dark:bg-slate-700"})]});if(t)return e.jsx("section",{className:"rounded-2xl border border-red-200 bg-red-50/90 p-5 text-sm text-red-800 dark:border-red-500/50 dark:bg-red-950/40 dark:text-red-200",children:t});if(!s)return e.jsx("section",{className:"rounded-2xl border border-slate-200/70 bg-white/80 p-5 text-sm text-slate-600 dark:border-slate-800 dark:bg-slate-900/70 dark:text-slate-200",children:"Ainda nÃ£o hÃ¡ dados financeiros suficientes para calcular o Health Score do CFO. Importe algumas movimentaÃ§Ãµes para que o sistema consiga analisar seu momento financeiro."});const l=Qe(s.status),d=l.icon,i=s.status==="EXCELLENT"?"Maturidade Financeira: NÃ­vel 4 (AvanÃ§ado)":s.status==="STABLE"?"Maturidade Financeira: NÃ­vel 3 (IntermediÃ¡rio)":s.status==="CRITICAL"?"Maturidade Financeira: NÃ­vel 2 (Em risco)":"Maturidade Financeira: NÃ­vel 1 (CrÃ­tico)";return e.jsxs("section",{className:"rounded-2xl border border-slate-200/70 bg-white/90 p-5 shadow-sm dark:border-slate-800 dark:bg-slate-900/80",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3 mb-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-sm font-semibold tracking-wide text-slate-700 dark:text-slate-100 uppercase",children:"Health Score Financeiro"}),e.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-300 mt-0.5",children:"VisÃ£o consolidada de caixa, margem e endividamento."})]}),e.jsxs("span",{className:`inline-flex items-center gap-1 rounded-full border px-3 py-1 text-xs font-medium ${l.badgeClass}`,children:[e.jsx(d,{className:"h-3.5 w-3.5"}),l.label]})]}),e.jsxs("div",{className:"flex flex-wrap items-end gap-6 mb-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-[32px] leading-none font-semibold text-slate-900 dark:text-white",children:s.score.toFixed(0)}),e.jsx("p",{className:"mt-1 text-xs text-slate-500 dark:text-slate-300",children:"Score calculado com base no fluxo de caixa, margem e estrutura de dÃ­vidas."})]}),e.jsxs("div",{className:"flex-1 min-w-[160px]",children:[e.jsx("p",{className:"text-xs font-semibold text-slate-700 dark:text-slate-100 mb-1",children:i}),e.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-300",children:l.level})]})]}),s.aiComment&&e.jsxs("div",{className:"mt-2 rounded-xl border border-slate-100 bg-slate-50/80 p-3 text-xs text-slate-700 dark:border-slate-700 dark:bg-slate-900/80 dark:text-slate-100",children:[e.jsx("p",{className:"font-medium mb-1 text-[11px] uppercase tracking-wide text-slate-500 dark:text-slate-300",children:"ComentÃ¡rio do CFO IA"}),e.jsx("p",{children:s.aiComment})]}),e.jsxs("div",{className:"mt-3 flex flex-wrap items-center justify-between gap-2 text-[11px] text-slate-500 dark:text-slate-400",children:[e.jsxs("span",{children:["Runway estimado:"," ",e.jsxs("strong",{className:"text-slate-700 dark:text-slate-100",children:[s.runwayMonths.toFixed(1)," meses"]})]}),e.jsxs("span",{children:["Atualizado em"," ",new Date(s.updatedAt).toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",year:"2-digit"})]})]})]})}function Ze(){const s=de(),{user:a,loading:r}=J();if(r)return e.jsx("div",{className:"p-6 text-sm text-slate-400",children:"Carregando seu ambiente financeiro..."});if(!a)return e.jsx("div",{className:"p-6 text-sm text-slate-400",children:"Sua sessÃ£o expirou. FaÃ§a login novamente para ver seus dados."});const[o,t]=c.useState(!1),[n,l]=c.useState(!1),[d,i]=c.useState(!1),u="vivare-oficial".trim?.()||"demo-tenant-001",m=a.displayName||(a.email?a.email.split("@")[0]:"VocÃª"),h="Sua empresa",b="Ãšltimos 7 dias",j="CFO",x=new Date,v=c.useMemo(()=>{const F=new Date(x);return F.setDate(F.getDate()-7),F},[x]),p=F=>F.toISOString().slice(0,10),{data:N,loading:g,error:f}=Oe({tenantId:u,periodStart:p(v),periodEnd:p(x)}),{credits:y,isLoading:w,error:k}=re(),{notify:S}=B(),A=N?{cashBalance:N.kpis.cashBalance,revenueMonth:N.kpis.revenueMonth,expenseMonth:N.kpis.expenseMonth,runwayMonths:N.kpis.runwayMonths}:null,C=!g&&!f&&!N,H=g||w;c.useEffect(()=>{f&&S({type:"error",message:"Ocorreu um erro ao carregar seus dados financeiros. Tente novamente. Se persistir, fale com o suporte."})},[f,S]),c.useEffect(()=>{},[k]);const T=()=>{i(!0)},le=()=>{s("/onboarding")},ne=()=>{typeof window<"u"&&window.dispatchEvent(new Event("open-support-dock"))};return e.jsxs("main",{className:"pt-16 p-6 space-y-6","aria-live":"polite",children:[H&&e.jsx("div",{className:"fixed top-14 left-0 md:left-60 right-0 h-0.5 bg-gradient-to-r from-brand-1 via-brand-2 to-brand-1 animate-pulse z-50",role:"status","aria-label":"Carregando painel"}),e.jsx(_e,{userName:m,companyName:h,periodLabel:b,lastImportLabel:"hÃ¡ 2 dias",lastUpdateLabel:"hÃ¡ poucos minutos",isLoading:H}),e.jsx(Te,{credits:y,isLoading:w}),e.jsx("div",{className:"mt-2 max-w-md",children:e.jsx(Xe,{})}),!C&&e.jsx("div",{className:"flex justify-end gap-2",children:e.jsx("button",{type:"button",onClick:T,className:"inline-flex items-center gap-2 rounded-xl border border-slate-200 bg-white/90 px-3 py-2 text-xs font-medium text-slate-700 hover:bg-slate-50 dark:border-white/10 dark:bg-slate-900/70 dark:text-slate-100 dark:hover:bg-slate-800/80",children:"Nova importaÃ§Ã£o"})}),e.jsxs("div",{className:"flex flex-col gap-3 md:flex-row md:items-start md:justify-between",children:[!1,e.jsxs("div",{className:"flex justify-end gap-2 md:self-start",children:[e.jsx("button",{type:"button",onClick:ne,className:"rounded-xl border border-slate-200 bg-white/90 px-3 py-2 text-sm text-slate-700 hover:bg-slate-50 dark:border-white/10 dark:bg-slate-900/70 dark:text-slate-100 dark:hover:bg-slate-800/80","aria-label":"Abrir Suporte",children:"Abrir Suporte"}),e.jsx("button",{type:"button",onClick:()=>{t(!0)},className:"rounded-xl border border-slate-200 bg-white/90 px-3 py-2 text-sm text-slate-700 hover:bg-slate-50 dark:border-white/10 dark:bg-slate-900/70 dark:text-slate-100 dark:hover:bg-slate-800/80","aria-label":"Abrir Advisor",children:"Abrir Advisor"})]})]}),C?e.jsx(D,{title:"Seu Pulse ainda estÃ¡ em branco",description:"Ainda nÃ£o temos dados financeiros suficientes para gerar seu Pulse. Importe suas transaÃ§Ãµes ou conecte suas contas para comeÃ§ar a ver seus grÃ¡ficos aqui.",primaryActionLabel:"Importar agora",onPrimaryAction:T,secondaryActionLabel:"Configurar perfil de mercado",onSecondaryAction:le}):e.jsx(Ie,{data:N,loading:g,error:f,onOpenAdvisor:()=>t(!0),onSimulate:()=>l(!0)}),e.jsx(Ge,{onImportClick:T,tenantId:u,plan:j}),e.jsx(Fe,{open:o,onClose:()=>t(!1)}),e.jsx(Me,{open:n,onClose:()=>l(!1),baseline:A||{},onConfirm:F=>{}}),e.jsx(Ke,{open:d,onClose:()=>i(!1)})]})}export{Ze as default};
