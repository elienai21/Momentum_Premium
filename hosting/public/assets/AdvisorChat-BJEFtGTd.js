import{c as A,o as F,m as O,r,p as B,z as R,j as e,h as a,G as S,D as q,V as H,s as z,B as K,L as G,b as U}from"./index-yBjCuyq5.js";import{S as X}from"./SectionHeader-MSrAe8iw.js";import{A as $}from"./AsyncPanel-OzLCl5j3.js";import{T as J}from"./trash-2-B738TgPz.js";import{B as L,S as Q}from"./send-BjKxuDE5.js";import{U as W}from"./user-B28uMnpN.js";const Y=[["path",{d:"M12 19v3",key:"npa21l"}],["path",{d:"M15 9.34V5a3 3 0 0 0-5.68-1.33",key:"1gzdoj"}],["path",{d:"M16.95 16.95A7 7 0 0 1 5 12v-2",key:"cqa7eg"}],["path",{d:"M18.89 13.23A7 7 0 0 0 19 12v-2",key:"16hl24"}],["path",{d:"m2 2 20 20",key:"1ooewy"}],["path",{d:"M9 9v3a3 3 0 0 0 5.12 2.12",key:"r2i35w"}]],Z=A("mic-off",Y);const ee=[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["line",{x1:"22",x2:"16",y1:"9",y2:"15",key:"1ewh16"}],["line",{x1:"16",x2:"22",y1:"9",y2:"15",key:"5ykzw1"}]],te=A("volume-x",ee);async function ae(c,m){return(await U.post("/advisor/session",{messages:c},m?{headers:{"x-tenant-id":m}}:void 0)).data}function de({onClose:c,tenantId:m}){const{features:w,voiceProfiles:y}=F(),u=w||{advisor:!0,voiceTTS:!1,voiceSTT:!1},M=O(),[o,n]=r.useState([{role:"assistant",content:"Olá! Sou seu Advisor Momentum. Me conte o que está tirando o sono do seu caixa hoje.",timestamp:new Date().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}]),[x,p]=r.useState(""),[i,j]=r.useState(!1),[_]=r.useState(!1),h=r.useRef(null),{speak:k,stop:C,loading:b}=B(),{start:D,stop:E,transcript:g,recording:l}=R();r.useEffect(()=>{!g||g==="​"||p(g)},[g]),r.useEffect(()=>{h.current&&(h.current.scrollTop=h.current.scrollHeight)},[o]);const N=async()=>{const t=x.trim();if(!t||i)return;const f=new Date().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),T=[...o,{role:"user",content:t,timestamp:f}];n(T),p(""),j(!0);try{if(!M){n(s=>[...s,{role:"assistant",content:"Você precisa estar autenticado para usar o Advisor. Faça login e tente novamente.",timestamp:new Date().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}]);return}const d=await ae(T.map(s=>({role:s.role,content:s.content})),m),v={role:"assistant",content:d.reply,timestamp:new Date().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})};n(s=>[...s,v]),u.voiceTTS&&await k({text:d.reply,voice:z("neural",y,"advisor")})}catch(d){const v=d?.code==="NO_CREDITS"?"Você ficou sem créditos de IA neste plano. Atualize seu plano ou aguarde a renovação dos créditos.":d?.message||"Erro ao processar resposta.";n(s=>[...s,{role:"assistant",content:v,timestamp:new Date().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}])}finally{j(!1)}},I=t=>{t.key==="Enter"&&!t.shiftKey&&(t.preventDefault(),N())},V=()=>{u.voiceSTT&&(l?E():(p(""),D()))},P=()=>{n([{role:"assistant",content:"Chat reiniciado. Como posso ajudar agora?",timestamp:new Date().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}])};return e.jsxs("div",{className:"flex flex-col h-full overflow-hidden bg-transparent",children:[e.jsx("div",{className:"px-6 pt-2 pb-4",children:e.jsx(X,{title:"CFO Advisor",subtitle:"Insights em tempo real para sua gestão financeira.",actions:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:P,className:"p-2 rounded-lg hover:bg-momentum-accent/10 text-momentum-muted hover:text-momentum-accent transition-colors",title:"Limpar conversa","aria-label":"Limpar conversa",children:e.jsx(J,{size:18})}),c&&e.jsx("button",{onClick:c,className:"px-3 py-1.5 rounded-lg border border-momentum-border text-xs font-medium hover:bg-white transition-all shadow-sm",children:"Fechar"})]})})}),e.jsxs("div",{ref:h,className:"flex-1 overflow-y-auto px-6 py-4 space-y-6 scroll-smooth scrollbar-none",children:[e.jsx($,{isLoading:_,isEmpty:o.length===0,emptyTitle:"Sem mensagens",emptyDescription:"Inicie uma conversa com seu advisor.",emptyIcon:e.jsx(L,{}),className:"border-none bg-transparent shadow-none p-0",children:o.map((t,f)=>e.jsx("div",{className:a("flex w-full mb-6 last:mb-0 animate-in fade-in slide-in-from-bottom-2 duration-300",t.role==="assistant"?"justify-start":"justify-end"),children:e.jsxs("div",{className:a("flex gap-3 max-w-[85%] md:max-w-[75%]",t.role==="assistant"?"flex-row":"flex-row-reverse"),children:[e.jsx("div",{className:a("hidden sm:flex h-8 w-8 rounded-full items-center justify-center shrink-0 mt-1 shadow-sm",t.role==="assistant"?"bg-gradient-to-br from-momentum-accent to-blue-600 text-white":"bg-white border border-momentum-border text-momentum-text"),children:t.role==="assistant"?e.jsx(L,{size:16}):e.jsx(W,{size:16})}),e.jsxs("div",{className:"flex flex-col gap-1.5",children:[t.role==="assistant"?e.jsx(S,{className:a("px-4 py-3 rounded-2xl text-[13px] leading-relaxed shadow-sm border-none backdrop-blur-md","bg-white/80 dark:bg-slate-900/40 rounded-tl-none ring-1 ring-momentum-border/30"),children:e.jsx("p",{className:"whitespace-pre-wrap text-slate-800 dark:text-slate-200",children:t.content})}):e.jsx("div",{className:a("px-4 py-3 rounded-2xl text-[13px] leading-relaxed shadow-sm border-none backdrop-blur-md","bg-primary text-white rounded-tr-none shadow-momentum-glow"),children:e.jsx("p",{className:"whitespace-pre-wrap",children:t.content})}),t.timestamp&&e.jsx("span",{className:a("text-[10px] opacity-40 font-semibold uppercase tracking-wider",t.role==="user"?"text-right":"text-left"),children:t.timestamp})]})]})},f))}),i&&e.jsx("div",{className:"flex justify-start animate-pulse",children:e.jsxs("div",{className:"flex gap-3 items-start",children:[e.jsx("div",{className:"h-8 w-8 rounded-full bg-slate-200 dark:bg-slate-800 shrink-0 shadow-sm"}),e.jsx(S,{className:"px-5 py-3 rounded-2xl rounded-tl-none bg-slate-100/50 dark:bg-slate-800/30 border-none shadow-none",children:e.jsxs("div",{className:"flex gap-1.5 items-center h-4",children:[e.jsx("span",{className:"w-1.5 h-1.5 bg-momentum-muted rounded-full animate-bounce [animation-delay:-0.3s]"}),e.jsx("span",{className:"w-1.5 h-1.5 bg-momentum-muted rounded-full animate-bounce [animation-delay:-0.15s]"}),e.jsx("span",{className:"w-1.5 h-1.5 bg-momentum-muted rounded-full animate-bounce"})]})})]})}),e.jsx("div",{className:"h-4"})," "]}),e.jsx("div",{className:"px-6 py-4 border-t border-slate-200 dark:border-white/10 bg-white/80 dark:bg-slate-950/80 backdrop-blur-xl sticky bottom-0 z-10 shadow-[0_-4px_20px_-10px_rgba(0,0,0,0.1)] dark:shadow-[0_-4px_20px_-10px_rgba(0,0,0,0.5)]",children:e.jsxs("div",{className:"max-w-4xl mx-auto space-y-4 pb-[env(safe-area-inset-bottom)]",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{onClick:V,disabled:!u.voiceSTT||i,className:a("flex items-center gap-2 px-3.5 py-1.5 rounded-full text-[10px] font-bold uppercase tracking-widest transition-all",l?"bg-red-500 text-white shadow-lg animate-pulse":"bg-primary/10 text-primary hover:bg-primary/20 border border-primary/20"),"aria-label":l?"Parar de ouvir":"Falar com advisor",children:[l?e.jsx(Z,{size:14,className:"animate-pulse"}):e.jsx(q,{size:14}),l?"Ouvindo...":"Voz"]}),u.voiceTTS&&e.jsx("button",{onClick:b?C:()=>k({text:o[o.length-1]?.content,voice:z("neural",y,"advisor")}),className:"p-2 rounded-full hover:bg-slate-100 dark:hover:bg-white/5 text-slate-400 hover:text-slate-600 dark:hover:text-white transition-colors",title:b?"Parar leitura":"Ouvir resposta",children:b?e.jsx(te,{size:16,className:"text-red-500 animate-pulse"}):e.jsx(H,{size:16})}),e.jsx(K,{variant:"neutral",className:"ml-auto text-[9px] font-bold tracking-tighter bg-slate-100 dark:bg-slate-900 border-slate-200 dark:border-white/10 text-slate-500 dark:text-slate-400",children:"Advisor Premium v2"})]}),e.jsx("div",{className:"relative flex items-end gap-2",children:e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("textarea",{rows:1,value:x,onChange:t=>p(t.target.value),onKeyDown:I,placeholder:"Pergunte sobre seus saldos, categorias ou anomalias...","aria-label":"Mensagem para o Advisor",className:a("w-full bg-slate-100 dark:bg-slate-900/50 border border-slate-200 dark:border-white/10 rounded-2xl px-5 py-3.5 pr-14 text-sm leading-relaxed text-slate-900 dark:text-slate-100 placeholder:text-slate-500","focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary/50 transition-all","resize-none min-h-[52px] max-h-36 scrollbar-none shadow-inner")}),e.jsx("button",{onClick:N,disabled:i||!x.trim(),className:a("absolute right-2.5 bottom-2.5 h-9 w-9 rounded-xl flex items-center justify-center transition-all shadow-md",i||!x.trim()?"bg-slate-800 text-slate-600 shadow-none cursor-not-allowed":"bg-primary text-white shadow-glow hover:scale-105 active:scale-95"),"aria-label":"Enviar mensagem",children:i?e.jsx(G,{size:18,className:"animate-spin"}):e.jsx(Q,{size:18})})]})}),e.jsx("p",{className:"text-[10px] text-momentum-muted text-center italic opacity-60",children:"Inteligência contextual baseada em seu histórico financeiro real."})]})})]})}export{de as A};
