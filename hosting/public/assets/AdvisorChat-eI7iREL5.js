import{c as z,g as P,h as F,r as o,i as O,k as B,j as e,f as a,G as T,M as R,V as q,l as S,L as H,b as K}from"./index-CnecHh6o.js";import{S as G}from"./SectionHeader-DUnCG6vt.js";import{B as U}from"./Badge-BfV7Ne6X.js";import{A as X}from"./AsyncPanel-C3U6zNBS.js";import{T as $}from"./trash-2-qfX7EfnP.js";import{B as L,S as J}from"./send-CgEOYm1v.js";import{U as Q}from"./user-QyTa_Opp.js";const W=[["path",{d:"M12 19v3",key:"npa21l"}],["path",{d:"M15 9.34V5a3 3 0 0 0-5.68-1.33",key:"1gzdoj"}],["path",{d:"M16.95 16.95A7 7 0 0 1 5 12v-2",key:"cqa7eg"}],["path",{d:"M18.89 13.23A7 7 0 0 0 19 12v-2",key:"16hl24"}],["path",{d:"m2 2 20 20",key:"1ooewy"}],["path",{d:"M9 9v3a3 3 0 0 0 5.12 2.12",key:"r2i35w"}]],Y=z("mic-off",W);const Z=[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["line",{x1:"22",x2:"16",y1:"9",y2:"15",key:"1ewh16"}],["line",{x1:"16",x2:"22",y1:"9",y2:"15",key:"5ykzw1"}]],ee=z("volume-x",Z);async function te(m){return(await K.post("/advisor/session",{messages:m})).data}function ce({onClose:m}){const{features:v,voiceProfiles:w}=P(),d=v||{advisor:!0,voiceTTS:!1,voiceSTT:!1},A=F(),[n,i]=o.useState([{role:"assistant",content:"Olá! Sou seu Advisor Momentum. Me conte o que está tirando o sono do seu caixa hoje.",timestamp:new Date().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}]),[u,x]=o.useState(""),[r,j]=o.useState(!1),[M]=o.useState(!1),p=o.useRef(null),{speak:y,stop:C,loading:g}=O(),{start:D,stop:E,transcript:h,recording:l}=B();o.useEffect(()=>{!h||h==="​"||x(h)},[h]),o.useEffect(()=>{p.current&&(p.current.scrollTop=p.current.scrollHeight)},[n]);const N=async()=>{const t=u.trim();if(!t||r)return;const f=new Date().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),k=[...n,{role:"user",content:t,timestamp:f}];i(k),x(""),j(!0);try{if(!A){i(s=>[...s,{role:"assistant",content:"Você precisa estar autenticado para usar o Advisor. Faça login e tente novamente.",timestamp:new Date().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}]);return}const c=await te(k.map(s=>({role:s.role,content:s.content}))),b={role:"assistant",content:c.reply,timestamp:new Date().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})};i(s=>[...s,b]),d.voiceTTS&&await y({text:c.reply,voice:S(w,"advisor")})}catch(c){const b=c?.code==="NO_CREDITS"?"Você ficou sem créditos de IA neste plano. Atualize seu plano ou aguarde a renovação dos créditos.":c?.message||"Erro ao processar resposta.";i(s=>[...s,{role:"assistant",content:b,timestamp:new Date().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}])}finally{j(!1)}},I=t=>{t.key==="Enter"&&!t.shiftKey&&(t.preventDefault(),N())},_=()=>{d.voiceSTT&&(l?E():(x(""),D()))},V=()=>{i([{role:"assistant",content:"Chat reiniciado. Como posso ajudar agora?",timestamp:new Date().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}])};return e.jsxs("div",{className:"flex flex-col h-full overflow-hidden bg-transparent",children:[e.jsx("div",{className:"px-6 pt-2 pb-4",children:e.jsx(G,{title:"CFO Advisor",subtitle:"Insights em tempo real para sua gestão financeira.",actions:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:V,className:"p-2 rounded-lg hover:bg-momentum-accent/10 text-momentum-muted hover:text-momentum-accent transition-colors",title:"Limpar conversa","aria-label":"Limpar conversa",children:e.jsx($,{size:18})}),m&&e.jsx("button",{onClick:m,className:"px-3 py-1.5 rounded-lg border border-momentum-border text-xs font-medium hover:bg-white transition-all shadow-sm",children:"Fechar"})]})})}),e.jsxs("div",{ref:p,className:"flex-1 overflow-y-auto px-6 py-4 space-y-6 scroll-smooth scrollbar-none",children:[e.jsx(X,{isLoading:M,isEmpty:n.length===0,emptyTitle:"Sem mensagens",emptyDescription:"Inicie uma conversa com seu advisor.",emptyIcon:e.jsx(L,{}),className:"border-none bg-transparent shadow-none p-0",children:n.map((t,f)=>e.jsx("div",{className:a("flex w-full mb-6 last:mb-0 animate-in fade-in slide-in-from-bottom-2 duration-300",t.role==="assistant"?"justify-start":"justify-end"),children:e.jsxs("div",{className:a("flex gap-3 max-w-[85%] md:max-w-[75%]",t.role==="assistant"?"flex-row":"flex-row-reverse"),children:[e.jsx("div",{className:a("hidden sm:flex h-8 w-8 rounded-full items-center justify-center shrink-0 mt-1 shadow-sm",t.role==="assistant"?"bg-gradient-to-br from-momentum-accent to-blue-600 text-white":"bg-white border border-momentum-border text-momentum-text"),children:t.role==="assistant"?e.jsx(L,{size:16}):e.jsx(Q,{size:16})}),e.jsxs("div",{className:"flex flex-col gap-1.5",children:[e.jsx(T,{className:a("px-4 py-3 rounded-2xl text-[13px] leading-relaxed shadow-sm border-none backdrop-blur-md",t.role==="assistant"?"bg-white/80 dark:bg-slate-900/40 rounded-tl-none ring-1 ring-momentum-border/30":"bg-momentum-accent text-white rounded-tr-none shadow-momentum-glow"),children:e.jsx("p",{className:"whitespace-pre-wrap",children:t.content})}),t.timestamp&&e.jsx("span",{className:a("text-[10px] opacity-40 font-semibold uppercase tracking-wider",t.role==="user"?"text-right":"text-left"),children:t.timestamp})]})]})},f))}),r&&e.jsx("div",{className:"flex justify-start animate-pulse",children:e.jsxs("div",{className:"flex gap-3 items-start",children:[e.jsx("div",{className:"h-8 w-8 rounded-full bg-slate-200 dark:bg-slate-800 shrink-0 shadow-sm"}),e.jsx(T,{className:"px-5 py-3 rounded-2xl rounded-tl-none bg-slate-100/50 dark:bg-slate-800/30 border-none shadow-none",children:e.jsxs("div",{className:"flex gap-1.5 items-center h-4",children:[e.jsx("span",{className:"w-1.5 h-1.5 bg-momentum-muted rounded-full animate-bounce [animation-delay:-0.3s]"}),e.jsx("span",{className:"w-1.5 h-1.5 bg-momentum-muted rounded-full animate-bounce [animation-delay:-0.15s]"}),e.jsx("span",{className:"w-1.5 h-1.5 bg-momentum-muted rounded-full animate-bounce"})]})})]})}),e.jsx("div",{className:"h-4"})," "]}),e.jsx("div",{className:"px-6 py-4 border-t border-momentum-border/50 bg-white/30 backdrop-blur-xl sticky bottom-0 z-10 shadow-[0_-4px_20px_-10px_rgba(0,0,0,0.1)]",children:e.jsxs("div",{className:"max-w-4xl mx-auto space-y-4 pb-[env(safe-area-inset-bottom)]",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{onClick:_,disabled:!d.voiceSTT||r,className:a("flex items-center gap-2 px-3.5 py-1.5 rounded-full text-[10px] font-bold uppercase tracking-widest transition-all",l?"bg-red-500 text-white shadow-lg animate-pulse":"bg-momentum-accent/10 text-momentum-accent hover:bg-momentum-accent/20"),"aria-label":l?"Parar de ouvir":"Falar com advisor",children:[l?e.jsx(Y,{size:14,className:"animate-pulse"}):e.jsx(R,{size:14}),l?"Ouvindo...":"Voz"]}),d.voiceTTS&&e.jsx("button",{onClick:g?C:()=>y({text:n[n.length-1]?.content,voice:S(w,"advisor")}),className:"p-2 rounded-full hover:bg-momentum-accent/10 text-momentum-muted transition-colors",title:g?"Parar leitura":"Ouvir resposta",children:g?e.jsx(ee,{size:16,className:"text-red-500 animate-pulse"}):e.jsx(q,{size:16})}),e.jsx(U,{variant:"neutral",className:"ml-auto text-[9px] font-bold tracking-tighter bg-white/50 border-momentum-border/30",children:"Advisor Premium v2"})]}),e.jsx("div",{className:"relative flex items-end gap-2",children:e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("textarea",{rows:1,value:u,onChange:t=>x(t.target.value),onKeyDown:I,placeholder:"Pergunte sobre seus saldos, categorias ou anomalias...","aria-label":"Mensagem para o Advisor",className:a("w-full bg-white/80 dark:bg-slate-900/50 border border-momentum-border rounded-2xl px-5 py-3.5 pr-14 text-sm leading-relaxed","focus:outline-none focus:ring-4 focus:ring-momentum-accent/10 focus:border-momentum-accent transition-all","resize-none min-h-[52px] max-h-36 scrollbar-none shadow-inner")}),e.jsx("button",{onClick:N,disabled:r||!u.trim(),className:a("absolute right-2.5 bottom-2.5 h-9 w-9 rounded-xl flex items-center justify-center transition-all shadow-md",r||!u.trim()?"bg-slate-100 text-slate-400 dark:bg-slate-800 shadow-none cursor-not-allowed":"bg-momentum-accent text-white shadow-momentum-glow hover:scale-105 active:scale-95"),"aria-label":"Enviar mensagem",children:r?e.jsx(H,{size:18,className:"animate-spin"}):e.jsx(J,{size:18})})]})}),e.jsx("p",{className:"text-[10px] text-momentum-muted text-center italic opacity-60",children:"Inteligência contextual baseada em seu histórico financeiro real."})]})})]})}export{ce as A};
